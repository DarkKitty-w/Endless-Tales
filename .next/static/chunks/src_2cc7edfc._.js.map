{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/lib/gameUtils.ts"],"sourcesContent":["\n// src/lib/gameUtils.ts\n\nimport type { CharacterStats, Skill } from \"../types/character-types\";\n\n/**\n * Calculates the maximum Health Points (HP) based on character's Stamina stat.\n * @param stats - Character's core stats.\n * @returns The maximum HP.\n */\nexport const calculateMaxHealth = (stats: CharacterStats): number => {\n    // Example: Base HP + Stamina stat * multiplier\n    return Math.max(10, 20 + stats.stamina * 10);\n};\n\n/**\n * Calculates the maximum Action Stamina (for physical actions) based on character's Strength stat.\n * @param stats - Character's core stats.\n * @returns The maximum action stamina points.\n */\nexport const calculateMaxActionStamina = (stats: CharacterStats): number => {\n    // Example: Base Action Stamina + Strength stat * multiplier\n    return Math.max(10, 30 + stats.strength * 5);\n};\n\n/**\n * Calculates the maximum mana based on character's Wisdom stat and knowledge.\n * @param stats - Character's core stats.\n * @param knowledge - List of character's knowledge areas.\n * @returns The maximum mana points.\n */\nexport const calculateMaxMana = (stats: CharacterStats, knowledge: string[]): number => {\n    const baseMana = 10;\n    // Wisdom is now the primary stat for mana\n    const wisdomBonus = stats.wisdom * 10;\n    const knowledgeBonus = knowledge.some(k => [\"Magic\", \"Arcana\", \"Healing\", \"Mysticism\", \"Lore\"].includes(k)) ? 20 : 0;\n    return baseMana + wisdomBonus + knowledgeBonus;\n};\n\n\n/** Represents a universally available starter skill. */\nexport const COMMON_STARTER_SKILL: Skill = { name: \"Observe\", description: \"Carefully examine your surroundings.\", type: 'Starter' };\n\n/** Defines starter skills for different character classes. */\nexport const CLASS_STARTER_SKILLS: Record<string, Skill[]> = {\n    \"Warrior\": [\n        { name: \"Power Strike\", description: \"A forceful attack consuming action stamina.\", type: 'Starter', staminaCost: 10 },\n        { name: \"Brace\", description: \"Prepare for an incoming blow, temporarily increasing resilience.\", type: 'Starter', staminaCost: 5 }\n    ],\n    \"Mage\": [\n        { name: \"Arcane Bolt\", description: \"Launch a bolt of magical energy.\", type: 'Starter', manaCost: 10 },\n        { name: \"Meditate\", description: \"Focus to slowly recover mana.\", type: 'Starter' }\n    ],\n    \"Rogue\": [\n        { name: \"Swift Strike\", description: \"A quick attack that costs less action stamina.\", type: 'Starter', staminaCost: 5 },\n        { name: \"Stealth\", description: \"Attempt to become less conspicuous.\", type: 'Starter', staminaCost: 5 }\n    ],\n    \"Scholar\": [ // Wisdom-based class\n        { name: \"Insightful Analysis\", description: \"Use wisdom to uncover hidden details or weaknesses.\", type: 'Starter', manaCost: 5 },\n        { name: \"Recall Lore\", description: \"Tap into your knowledge on a subject.\", type: 'Starter' }\n    ],\n     \"Adventurer\": [ \n        { name: \"Basic Strike\", description: \"A simple physical attack.\", type: 'Starter', staminaCost: 5 },\n        { name: \"First Aid\", description: \"Attempt to patch up minor wounds.\", type: 'Starter', staminaCost: 10 }\n    ],\n     \"admin000\": [ \n        { name: \"Dev Power\", description: \"Access developer abilities.\", type: 'Starter' },\n    ],\n    // Add more classes and their Wisdom/Strength/Stamina based skills\n};\n\n/**\n * Retrieves the list of starter skills for a given character class.\n * @param className - The name of the character class.\n * @returns An array of Skill objects, including the common 'Observe' skill.\n */\nexport function getStarterSkillsForClass(className: string): Skill[] {\n    const classSkills = CLASS_STARTER_SKILLS[className] || CLASS_STARTER_SKILLS[\"Adventurer\"]; \n    const skills = [COMMON_STARTER_SKILL, ...classSkills];\n    return Array.from(new Map(skills.map(skill => [skill.name, skill])).values());\n}\n\n/**\n * Calculates the amount of XP required to reach the next level.\n * @param currentLevel - The character's current level.\n * @returns The total XP needed for the next level.\n */\nexport const calculateXpToNextLevel = (currentLevel: number): number => {\n  const baseXP = 100;\n  return Math.floor(baseXP + (currentLevel -1) * 50 + Math.pow(currentLevel -1, 2.2) * 10);\n};\n\n/**\n * Generates a unique ID for new adventures.\n * @returns A unique string identifier.\n */\nexport function generateAdventureId(): string {\n    return `adv_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n}\n"],"names":[],"mappings":"AACA,uBAAuB;;;;;;;;;;;AAShB,MAAM,qBAAqB,CAAC;IAC/B,+CAA+C;IAC/C,OAAO,KAAK,GAAG,CAAC,IAAI,KAAK,MAAM,OAAO,GAAG;AAC7C;AAOO,MAAM,4BAA4B,CAAC;IACtC,4DAA4D;IAC5D,OAAO,KAAK,GAAG,CAAC,IAAI,KAAK,MAAM,QAAQ,GAAG;AAC9C;AAQO,MAAM,mBAAmB,CAAC,OAAuB;IACpD,MAAM,WAAW;IACjB,0CAA0C;IAC1C,MAAM,cAAc,MAAM,MAAM,GAAG;IACnC,MAAM,iBAAiB,UAAU,IAAI,CAAC,CAAA,IAAK;YAAC;YAAS;YAAU;YAAW;YAAa;SAAO,CAAC,QAAQ,CAAC,MAAM,KAAK;IACnH,OAAO,WAAW,cAAc;AACpC;AAIO,MAAM,uBAA8B;IAAE,MAAM;IAAW,aAAa;IAAwC,MAAM;AAAU;AAG5H,MAAM,uBAAgD;IACzD,WAAW;QACP;YAAE,MAAM;YAAgB,aAAa;YAA+C,MAAM;YAAW,aAAa;QAAG;QACrH;YAAE,MAAM;YAAS,aAAa;YAAoE,MAAM;YAAW,aAAa;QAAE;KACrI;IACD,QAAQ;QACJ;YAAE,MAAM;YAAe,aAAa;YAAoC,MAAM;YAAW,UAAU;QAAG;QACtG;YAAE,MAAM;YAAY,aAAa;YAAiC,MAAM;QAAU;KACrF;IACD,SAAS;QACL;YAAE,MAAM;YAAgB,aAAa;YAAkD,MAAM;YAAW,aAAa;QAAE;QACvH;YAAE,MAAM;YAAW,aAAa;YAAuC,MAAM;YAAW,aAAa;QAAE;KAC1G;IACD,WAAW;QACP;YAAE,MAAM;YAAuB,aAAa;YAAuD,MAAM;YAAW,UAAU;QAAE;QAChI;YAAE,MAAM;YAAe,aAAa;YAAyC,MAAM;QAAU;KAChG;IACA,cAAc;QACX;YAAE,MAAM;YAAgB,aAAa;YAA6B,MAAM;YAAW,aAAa;QAAE;QAClG;YAAE,MAAM;YAAa,aAAa;YAAqC,MAAM;YAAW,aAAa;QAAG;KAC3G;IACA,YAAY;QACT;YAAE,MAAM;YAAa,aAAa;YAA+B,MAAM;QAAU;KACpF;AAEL;AAOO,SAAS,yBAAyB,SAAiB;IACtD,MAAM,cAAc,oBAAoB,CAAC,UAAU,IAAI,oBAAoB,CAAC,aAAa;IACzF,MAAM,SAAS;QAAC;WAAyB;KAAY;IACrD,OAAO,MAAM,IAAI,CAAC,IAAI,IAAI,OAAO,GAAG,CAAC,CAAA,QAAS;YAAC,MAAM,IAAI;YAAE;SAAM,GAAG,MAAM;AAC9E;AAOO,MAAM,yBAAyB,CAAC;IACrC,MAAM,SAAS;IACf,OAAO,KAAK,KAAK,CAAC,SAAS,CAAC,eAAc,CAAC,IAAI,KAAK,KAAK,GAAG,CAAC,eAAc,GAAG,OAAO;AACvF;AAMO,SAAS;IACZ,OAAO,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,IAAI;AAC5E","debugId":null}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/lib/constants.ts"],"sourcesContent":["\n// src/lib/constants.ts\nimport type { DifficultyLevel as AdventureDifficultyLevel } from \"../types/adventure-types\"; // Import DifficultyLevel type\nimport type { DifficultyLevel as AssessmentDifficultyLevel } from \"../types/game-types\"; // Corrected import\n\n\n/** The total number of points available for character stats. */\nexport const TOTAL_STAT_POINTS = 15;\n\n/** The minimum value allowed for a single character stat. */\nexport const MIN_STAT_VALUE = 1;\n\n/** The maximum value allowed for a single character stat. */\nexport const MAX_STAT_VALUE = 10;\n\n/** Valid difficulty levels for adventure settings. */\nexport const VALID_ADVENTURE_DIFFICULTY_LEVELS: AdventureDifficultyLevel[] = [\"Easy\", \"Normal\", \"Hard\", \"Nightmare\"];\n\n/** Valid difficulty levels for AI action assessment. */\nexport const VALID_ASSESSMENT_DIFFICULTY_LEVELS: AssessmentDifficultyLevel[] = [\"Trivial\", \"Easy\", \"Normal\", \"Hard\", \"Very Hard\", \"Impossible\"];\n\n\n/** LocalStorage key for saving adventures. */\nexport const SAVED_ADVENTURES_KEY = \"endlessTalesSavedAdventures\";\n\n/** LocalStorage key for saving the selected theme ID. */\nexport const THEME_ID_KEY = \"colorTheme\";\n\n/** LocalStorage key for saving the theme mode (light/dark). */\nexport const THEME_MODE_KEY = \"themeMode\";\n\n/** LocalStorage key for saving the user's Google AI API key. */\nexport const USER_API_KEY_KEY = \"userGoogleAiApiKey\";\n"],"names":[],"mappings":"AACA,uBAAuB;;;;;;;;;;;;AAMhB,MAAM,oBAAoB;AAG1B,MAAM,iBAAiB;AAGvB,MAAM,iBAAiB;AAGvB,MAAM,oCAAgE;IAAC;IAAQ;IAAU;IAAQ;CAAY;AAG7G,MAAM,qCAAkE;IAAC;IAAW;IAAQ;IAAU;IAAQ;IAAa;CAAa;AAIxI,MAAM,uBAAuB;AAG7B,MAAM,eAAe;AAGrB,MAAM,iBAAiB;AAGvB,MAAM,mBAAmB","debugId":null}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/context/game-initial-state.ts"],"sourcesContent":["\n// src/context/game-initial-state.ts\n\nimport type { GameState } from \"../types/game-types\";\nimport type { Character, CharacterStats } from \"../types/character-types\";\nimport type { InventoryItem, ItemQuality } from \"../types/inventory-types\";\nimport type { AdventureSettings, DifficultyLevel } from \"../types/adventure-types\";\nimport {\n    calculateMaxHealth,\n    calculateMaxActionStamina,\n    calculateMaxMana,\n    calculateXpToNextLevel,\n    getStarterSkillsForClass\n} from \"../lib/gameUtils\";\nimport { TOTAL_STAT_POINTS } from \"../lib/constants\";\n\nconst pointsPerStat = Math.floor(TOTAL_STAT_POINTS / 3);\nconst remainderPoints = TOTAL_STAT_POINTS % 3;\n\nexport const initialCharacterStats: CharacterStats = {\n    strength: pointsPerStat + (remainderPoints > 0 ? 1 : 0),\n    stamina: pointsPerStat + (remainderPoints > 1 ? 1 : 0),\n    wisdom: pointsPerStat,\n};\n\nexport const initialCharacterState: Character = {\n  name: \"\",\n  description: \"\",\n  class: \"Adventurer\",\n  traits: [],\n  knowledge: [],\n  background: \"\",\n  stats: { ...initialCharacterStats },\n  aiGeneratedDescription: undefined,\n  maxHealth: calculateMaxHealth(initialCharacterStats),\n  currentHealth: calculateMaxHealth(initialCharacterStats),\n  maxStamina: calculateMaxActionStamina(initialCharacterStats),\n  currentStamina: calculateMaxActionStamina(initialCharacterStats),\n  maxMana: calculateMaxMana(initialCharacterStats, []),\n  currentMana: calculateMaxMana(initialCharacterStats, []),\n  level: 1,\n  xp: 0,\n  xpToNextLevel: calculateXpToNextLevel(1),\n  reputation: {},\n  npcRelationships: {},\n  skillTree: null,\n  skillTreeStage: 0,\n  learnedSkills: getStarterSkillsForClass(\"Adventurer\"),\n};\n\nexport const initialInventory: InventoryItem[] = [\n    { name: \"Basic Clothes\", description: \"Simple, slightly worn clothes.\", quality: \"Poor\" as ItemQuality, weight: 1 },\n    { name: \"Crusty Bread\", description: \"A piece of somewhat stale bread.\", quality: \"Poor\" as ItemQuality, weight: 0.5 }\n];\n\nexport const initialAdventureSettings: AdventureSettings = {\n    adventureType: null,\n    permanentDeath: true,\n    difficulty: \"Normal\" as DifficultyLevel,\n    worldType: \"\",\n    mainQuestline: \"\",\n    genreTheme: \"\",\n    magicSystem: \"\",\n    techLevel: \"\",\n    dominantTone: \"\",\n    startingSituation: \"\",\n    combatFrequency: \"Medium\",\n    puzzleFrequency: \"Medium\",\n    socialFocus: \"Medium\",\n    universeName: \"\",\n    playerCharacterConcept: \"\",\n    characterOriginType: 'original',\n};\n\nexport const initialState: GameState = {\n  status: \"MainMenu\",\n  character: null,\n  // Multiplayer specific state\n  sessionId: null,\n  players: [],\n  currentPlayerUid: null,\n  isHost: false,\n\n  adventureSettings: { ...initialAdventureSettings },\n  currentNarration: null,\n  storyLog: [],\n  adventureSummary: null,\n  currentGameStateString: \"The adventure is about to begin...\",\n  inventory: [],\n  savedAdventures: [],\n  currentAdventureId: null,\n  isGeneratingSkillTree: false,\n  turnCount: 0,\n  selectedThemeId: 'cardboard',\n  isDarkMode: false,\n  userGoogleAiApiKey: null,\n};\n"],"names":[],"mappings":"AACA,oCAAoC;;;;;;;;AAMpC;AAOA;;;AAEA,MAAM,gBAAgB,KAAK,KAAK,CAAC,0HAAA,CAAA,oBAAiB,GAAG;AACrD,MAAM,kBAAkB,0HAAA,CAAA,oBAAiB,GAAG;AAErC,MAAM,wBAAwC;IACjD,UAAU,gBAAgB,CAAC,kBAAkB,IAAI,IAAI,CAAC;IACtD,SAAS,gBAAgB,CAAC,kBAAkB,IAAI,IAAI,CAAC;IACrD,QAAQ;AACZ;AAEO,MAAM,wBAAmC;IAC9C,MAAM;IACN,aAAa;IACb,OAAO;IACP,QAAQ,EAAE;IACV,WAAW,EAAE;IACb,YAAY;IACZ,OAAO;QAAE,GAAG,qBAAqB;IAAC;IAClC,wBAAwB;IACxB,WAAW,CAAA,GAAA,0HAAA,CAAA,qBAAkB,AAAD,EAAE;IAC9B,eAAe,CAAA,GAAA,0HAAA,CAAA,qBAAkB,AAAD,EAAE;IAClC,YAAY,CAAA,GAAA,0HAAA,CAAA,4BAAyB,AAAD,EAAE;IACtC,gBAAgB,CAAA,GAAA,0HAAA,CAAA,4BAAyB,AAAD,EAAE;IAC1C,SAAS,CAAA,GAAA,0HAAA,CAAA,mBAAgB,AAAD,EAAE,uBAAuB,EAAE;IACnD,aAAa,CAAA,GAAA,0HAAA,CAAA,mBAAgB,AAAD,EAAE,uBAAuB,EAAE;IACvD,OAAO;IACP,IAAI;IACJ,eAAe,CAAA,GAAA,0HAAA,CAAA,yBAAsB,AAAD,EAAE;IACtC,YAAY,CAAC;IACb,kBAAkB,CAAC;IACnB,WAAW;IACX,gBAAgB;IAChB,eAAe,CAAA,GAAA,0HAAA,CAAA,2BAAwB,AAAD,EAAE;AAC1C;AAEO,MAAM,mBAAoC;IAC7C;QAAE,MAAM;QAAiB,aAAa;QAAkC,SAAS;QAAuB,QAAQ;IAAE;IAClH;QAAE,MAAM;QAAgB,aAAa;QAAoC,SAAS;QAAuB,QAAQ;IAAI;CACxH;AAEM,MAAM,2BAA8C;IACvD,eAAe;IACf,gBAAgB;IAChB,YAAY;IACZ,WAAW;IACX,eAAe;IACf,YAAY;IACZ,aAAa;IACb,WAAW;IACX,cAAc;IACd,mBAAmB;IACnB,iBAAiB;IACjB,iBAAiB;IACjB,aAAa;IACb,cAAc;IACd,wBAAwB;IACxB,qBAAqB;AACzB;AAEO,MAAM,eAA0B;IACrC,QAAQ;IACR,WAAW;IACX,6BAA6B;IAC7B,WAAW;IACX,SAAS,EAAE;IACX,kBAAkB;IAClB,QAAQ;IAER,mBAAmB;QAAE,GAAG,wBAAwB;IAAC;IACjD,kBAAkB;IAClB,UAAU,EAAE;IACZ,kBAAkB;IAClB,wBAAwB;IACxB,WAAW,EAAE;IACb,iBAAiB,EAAE;IACnB,oBAAoB;IACpB,uBAAuB;IACvB,WAAW;IACX,iBAAiB;IACjB,YAAY;IACZ,oBAAoB;AACtB","debugId":null}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/context/reducers/characterReducer.ts"],"sourcesContent":["\n// src/context/reducers/characterReducer.ts\nimport type { Character, CharacterStats, SkillTreeStage } from \"../../types/character-types\";\nimport type { Action } from \"../game-actions\";\nimport { initialCharacterState, initialCharacterStats } from \"../game-initial-state\";\nimport { calculateMaxHealth, calculateMaxActionStamina, calculateMaxMana, calculateXpToNextLevel, getStarterSkillsForClass } from \"../../lib/gameUtils\";\n\nexport function characterReducer(state: Character | null, action: Action): Character | null {\n    switch (action.type) {\n        case \"CREATE_CHARACTER\": {\n            const baseStats: CharacterStats = action.payload.stats\n                ? { ...initialCharacterStats, ...action.payload.stats }\n                : { ...initialCharacterStats };\n            const baseKnowledge = action.payload.knowledge ?? [];\n            const maxHealth = calculateMaxHealth(baseStats);\n            const maxActionStamina = calculateMaxActionStamina(baseStats);\n            const maxMana = calculateMaxMana(baseStats, baseKnowledge);\n            const characterClass = action.payload.class ?? initialCharacterState.class;\n            const starterSkills = getStarterSkillsForClass(characterClass);\n            const initialLevel = 1;\n            const initialXpToNext = calculateXpToNextLevel(initialLevel);\n\n            const newCharacter: Character = {\n                ...initialCharacterState,\n                name: action.payload.name ?? \"\",\n                description: action.payload.description ?? \"\",\n                class: characterClass,\n                traits: action.payload.traits ?? [],\n                knowledge: baseKnowledge,\n                background: action.payload.background ?? \"\",\n                stats: baseStats,\n                aiGeneratedDescription: action.payload.aiGeneratedDescription ?? undefined,\n                maxHealth: maxHealth,\n                currentHealth: maxHealth,\n                maxStamina: maxActionStamina,\n                currentStamina: maxActionStamina,\n                maxMana: maxMana,\n                currentMana: maxMana,\n                level: initialLevel,\n                xp: 0,\n                xpToNextLevel: initialXpToNext,\n                reputation: {},\n                npcRelationships: {},\n                skillTree: null,\n                skillTreeStage: 0,\n                learnedSkills: starterSkills,\n            };\n            return newCharacter;\n        }\n        case \"UPDATE_CHARACTER\": {\n            if (!state) return null;\n            const updatedStats = action.payload.stats ? { ...state.stats, ...action.payload.stats } : state.stats;\n            const updatedKnowledge = action.payload.knowledge ?? state.knowledge;\n            \n            const newMaxHealth = calculateMaxHealth(updatedStats);\n            const newMaxActionStamina = calculateMaxActionStamina(updatedStats);\n            const newMaxMana = calculateMaxMana(updatedStats, updatedKnowledge);\n\n            return {\n                ...state,\n                ...action.payload,\n                stats: updatedStats,\n                knowledge: updatedKnowledge,\n                maxHealth: newMaxHealth,\n                currentHealth: Math.min(action.payload.currentHealth ?? state.currentHealth, newMaxHealth),\n                maxStamina: newMaxActionStamina,\n                currentStamina: Math.min(action.payload.currentStamina ?? state.currentStamina, newMaxActionStamina),\n                maxMana: newMaxMana,\n                currentMana: Math.min(action.payload.currentMana ?? state.currentMana, newMaxMana),\n                traits: action.payload.traits ?? state.traits,\n                skillTree: action.payload.skillTree !== undefined ? action.payload.skillTree : state.skillTree,\n                skillTreeStage: action.payload.skillTreeStage !== undefined ? action.payload.skillTreeStage : state.skillTreeStage,\n                aiGeneratedDescription: action.payload.aiGeneratedDescription !== undefined ? action.payload.aiGeneratedDescription : state.aiGeneratedDescription,\n                learnedSkills: action.payload.learnedSkills ?? state.learnedSkills,\n                level: action.payload.level ?? state.level,\n                xp: action.payload.xp ?? state.xp,\n                xpToNextLevel: action.payload.xpToNextLevel ?? state.xpToNextLevel,\n                reputation: action.payload.reputation ?? state.reputation,\n                npcRelationships: action.payload.npcRelationships ?? state.npcRelationships,\n            };\n        }\n         case \"SET_AI_DESCRIPTION\":\n             if (!state) return null;\n             return { ...state, aiGeneratedDescription: action.payload };\n        case \"GRANT_XP\": {\n            if (!state) return null;\n            const newXp = state.xp + action.payload;\n            return { ...state, xp: newXp };\n        }\n        case \"LEVEL_UP\": {\n            if (!state) return null;\n            if (action.payload.newLevel <= state.level) return state;\n            const remainingXp = Math.max(0, state.xp - state.xpToNextLevel);\n            // Full heal on level up\n            const newMaxHealth = calculateMaxHealth(state.stats);\n            const newMaxActionStamina = calculateMaxActionStamina(state.stats);\n            const newMaxMana = calculateMaxMana(state.stats, state.knowledge);\n\n            return {\n                ...state,\n                level: action.payload.newLevel,\n                xp: remainingXp,\n                xpToNextLevel: action.payload.newXpToNextLevel,\n                maxHealth: newMaxHealth,\n                currentHealth: newMaxHealth,\n                maxStamina: newMaxActionStamina,\n                currentStamina: newMaxActionStamina,\n                maxMana: newMaxMana,\n                currentMana: newMaxMana,\n            };\n        }\n        case \"UPDATE_REPUTATION\": {\n            if (!state) return null;\n            const { faction, change } = action.payload;\n            const currentScore = state.reputation[faction] ?? 0;\n            const newScore = Math.max(-100, Math.min(100, currentScore + change));\n            return { ...state, reputation: { ...state.reputation, [faction]: newScore } };\n        }\n        case \"UPDATE_NPC_RELATIONSHIP\": {\n            if (!state) return null;\n            const { npcName, change } = action.payload;\n            const currentScore = state.npcRelationships[npcName] ?? 0;\n            const newScore = Math.max(-100, Math.min(100, currentScore + change));\n            return { ...state, npcRelationships: { ...state.npcRelationships, [npcName]: newScore } };\n        }\n        case \"SET_SKILL_TREE\": {\n            if (!state || state.class !== action.payload.class) return state;\n            const stages = action.payload.skillTree.stages || [];\n             if (stages.length !== 5) {\n                 console.error(`Reducer: Received skill tree with ${stages.length} stages, expected 5. Discarding.`);\n                 return state;\n             }\n             const validatedStages: SkillTreeStage[] = Array.from({ length: 5 }, (_, i) => {\n                const foundStage = stages.find(s => s.stage === i);\n                return { stage: i, stageName: foundStage?.stageName || (i === 0 ? \"Potential\" : `Stage ${i}`),\n                     skills: (Array.isArray(foundStage?.skills) ? foundStage.skills : []).map(skill => ({\n                         name: skill.name || \"Unnamed Skill\", description: skill.description || \"No description.\", type: skill.type || 'Learned',\n                         manaCost: typeof skill.manaCost === 'number' ? skill.manaCost : undefined,\n                         staminaCost: typeof skill.staminaCost === 'number' ? skill.staminaCost : undefined,\n                     })),\n                };\n             });\n             const validatedSkillTree = { className: action.payload.class, stages: validatedStages };\n            return { ...state, skillTree: validatedSkillTree };\n        }\n         case \"CHANGE_CLASS_AND_RESET_SKILLS\": {\n             if (!state) return null;\n             const stages = action.payload.newSkillTree.stages || [];\n              if (stages.length !== 5) {\n                 console.error(`Reducer: Received new skill tree with ${stages.length} stages, expected 5. Aborting class change.`);\n                 return state;\n             }\n             const validatedStages: SkillTreeStage[] = Array.from({ length: 5 }, (_, i) => {\n                 const foundStage = stages.find(s => s.stage === i);\n                 return { stage: i, stageName: foundStage?.stageName || (i === 0 ? \"Potential\" : `Stage ${i}`),\n                     skills: (Array.isArray(foundStage?.skills) ? foundStage.skills : []).map(skill => ({\n                         name: skill.name || \"Unnamed Skill\", description: skill.description || \"No description.\", type: skill.type || 'Learned',\n                         manaCost: typeof skill.manaCost === 'number' ? skill.manaCost : undefined,\n                         staminaCost: typeof skill.staminaCost === 'number' ? skill.staminaCost : undefined,\n                     })),\n                 };\n             });\n             const newValidatedSkillTree = { className: action.payload.newClass, stages: validatedStages };\n             const starterSkills = getStarterSkillsForClass(action.payload.newClass);\n             return { ...state, class: action.payload.newClass, skillTree: newValidatedSkillTree, skillTreeStage: 0, learnedSkills: starterSkills };\n         }\n        case \"PROGRESS_SKILL_STAGE\": {\n             if (!state || !state.skillTree) return state;\n             const newStage = Math.max(0, Math.min(4, action.payload));\n             if (newStage > state.skillTreeStage) return { ...state, skillTreeStage: newStage };\n             return state;\n         }\n         case \"UPDATE_NARRATION\": {\n             if (!state) return null;\n             const { updatedStats, updatedTraits, updatedKnowledge, healthChange, staminaChange, manaChange, gainedSkill, xpGained, reputationChange, npcRelationshipChange, progressedToStage } = action.payload;\n             let newState = { ...state };\n             if (updatedStats) newState.stats = { ...newState.stats, ...updatedStats };\n             if (updatedTraits) newState.traits = updatedTraits;\n             if (updatedKnowledge) newState.knowledge = updatedKnowledge;\n\n             // Recalculate max values if stats or knowledge changed\n             if (updatedStats || updatedKnowledge) {\n                newState.maxHealth = calculateMaxHealth(newState.stats);\n                newState.maxStamina = calculateMaxActionStamina(newState.stats);\n                newState.maxMana = calculateMaxMana(newState.stats, newState.knowledge);\n             }\n             \n             if (healthChange) newState.currentHealth = Math.max(0, Math.min(newState.maxHealth, newState.currentHealth + healthChange));\n             if (staminaChange) newState.currentStamina = Math.max(0, Math.min(newState.maxStamina, newState.currentStamina + staminaChange));\n             if (manaChange) newState.currentMana = Math.max(0, Math.min(newState.maxMana, newState.currentMana + manaChange));\n\n             if (gainedSkill && !newState.learnedSkills.some(s => s.name === gainedSkill.name)) {\n                 newState.learnedSkills = [...newState.learnedSkills, { ...gainedSkill, type: 'Learned' }];\n             }\n             if (xpGained) newState.xp += xpGained;\n             if (reputationChange) {\n                 const { faction, change } = reputationChange;\n                 const currentScore = newState.reputation[faction] ?? 0;\n                 newState.reputation[faction] = Math.max(-100, Math.min(100, currentScore + change));\n             }\n             if (npcRelationshipChange) {\n                 const { npcName, change } = npcRelationshipChange;\n                 const currentScore = newState.npcRelationships[npcName] ?? 0;\n                 newState.npcRelationships[npcName] = Math.max(-100, Math.min(100, currentScore + change));\n             }\n             if (progressedToStage !== undefined && progressedToStage > newState.skillTreeStage) {\n                 newState.skillTreeStage = progressedToStage;\n             }\n             return newState;\n         }\n        case \"RESPAWN_CHARACTER\": {\n            if (!state) return null;\n            // TODO: Implement more nuanced respawn penalties (e.g., XP loss) if desired.\n            return {\n                ...state,\n                currentHealth: state.maxHealth, // Restore health\n                currentStamina: state.maxStamina, // Restore action stamina\n                currentMana: state.maxMana, // Restore mana\n            };\n        }\n         case \"RESET_GAME\": return null;\n         case \"LOAD_ADVENTURE\":\n             const savedChar = action.payload.character;\n             const validatedStats = savedChar?.stats ? { ...initialCharacterStats, ...savedChar.stats } : { ...initialCharacterStats };\n             const validatedKnowledge = Array.isArray(savedChar?.knowledge) ? savedChar.knowledge : [];\n             const loadedCharClass = savedChar?.class || \"Adventurer\";\n             return {\n                 ...initialCharacterState, \n                 ...(savedChar || {}), \n                 name: savedChar?.name || \"Recovered Adventurer\",\n                 class: loadedCharClass,\n                 knowledge: validatedKnowledge,\n                 stats: validatedStats,\n                 maxHealth: typeof savedChar?.maxHealth === 'number' ? savedChar.maxHealth : calculateMaxHealth(validatedStats),\n                 currentHealth: typeof savedChar?.currentHealth === 'number' ? savedChar.currentHealth : (savedChar?.maxHealth ?? calculateMaxHealth(validatedStats)),\n                 maxStamina: typeof savedChar?.maxStamina === 'number' ? savedChar.maxStamina : calculateMaxActionStamina(validatedStats),\n                 currentStamina: typeof savedChar?.currentStamina === 'number' ? savedChar.currentStamina : (savedChar?.maxStamina ?? calculateMaxActionStamina(validatedStats)),\n                 maxMana: typeof savedChar?.maxMana === 'number' ? savedChar.maxMana : calculateMaxMana(validatedStats, validatedKnowledge),\n                 currentMana: typeof savedChar?.currentMana === 'number' ? savedChar.currentMana : (savedChar?.maxMana ?? calculateMaxMana(validatedStats, validatedKnowledge)),\n                 level: typeof savedChar?.level === 'number' ? savedChar.level : 1,\n                 xpToNextLevel: typeof savedChar?.xpToNextLevel === 'number' ? savedChar.xpToNextLevel : calculateXpToNextLevel(savedChar?.level ?? 1),\n                 skillTree: savedChar?.skillTree ? { \n                     className: savedChar.skillTree.className || loadedCharClass,\n                     stages: (Array.isArray(savedChar.skillTree.stages) ? savedChar.skillTree.stages : []).map((stage, index) => ({\n                          stage: typeof stage.stage === 'number' ? stage.stage : index,\n                          stageName: stage.stageName || (index === 0 ? \"Potential\" : `Stage ${stage.stage ?? index}`), \n                          skills: (Array.isArray(stage.skills) ? stage.skills : []).map(skill => ({\n                             name: skill.name || \"Unknown Skill\", description: skill.description || \"\", type: skill.type || 'Learned',\n                             manaCost: typeof skill.manaCost === 'number' ? skill.manaCost : undefined,\n                             staminaCost: typeof skill.staminaCost === 'number' ? skill.staminaCost : undefined,\n                         })),\n                    })).slice(0, 5) \n                 } : null,\n                 learnedSkills: (Array.isArray(savedChar?.learnedSkills) && savedChar.learnedSkills.length > 0) \n                      ? savedChar.learnedSkills.map(skill => ({\n                          name: skill.name || \"Unknown Skill\", description: skill.description || \"\", type: skill.type || 'Learned',\n                          manaCost: typeof skill.manaCost === 'number' ? skill.manaCost : undefined,\n                          staminaCost: typeof skill.staminaCost === 'number' ? skill.staminaCost : undefined,\n                       }))\n                     : getStarterSkillsForClass(loadedCharClass), \n             };\n        default:\n            return state;\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 652, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/context/reducers/inventoryReducer.ts"],"sourcesContent":["\n// src/context/reducers/inventoryReducer.ts\nimport type { InventoryItem, ItemQuality } from \"../../types/inventory-types\";\nimport type { Action } from \"../game-actions\";\nimport { initialInventory } from \"../game-initial-state\";\n\nexport function inventoryReducer(state: InventoryItem[], action: Action): InventoryItem[] {\n    switch (action.type) {\n        case \"ADD_ITEM\": {\n            const newItem: InventoryItem = {\n                name: action.payload.name || \"Mysterious Item\",\n                description: action.payload.description || \"An item of unclear origin.\",\n                quality: action.payload.quality || \"Common\",\n                weight: typeof action.payload.weight === 'number' ? action.payload.weight : 1,\n                durability: typeof action.payload.durability === 'number' ? action.payload.durability : undefined,\n                magicalEffect: action.payload.magicalEffect || undefined,\n            };\n            console.log(\"Adding validated item:\", newItem.name);\n            return [...state, newItem];\n        }\n        case \"REMOVE_ITEM\": {\n            const { itemName, quantity = 1 } = action.payload;\n            console.log(`Attempting to remove ${quantity} of item:`, itemName);\n            const updatedInventory = [...state];\n            let removedCount = 0;\n            for (let i = updatedInventory.length - 1; i >= 0 && removedCount < quantity; i--) {\n                if (updatedInventory[i].name === itemName) {\n                    updatedInventory.splice(i, 1);\n                    removedCount++;\n                }\n            }\n            if (removedCount < quantity) {\n                console.warn(`Tried to remove ${quantity} of ${itemName}, but only found ${removedCount}.`);\n            }\n            return updatedInventory;\n        }\n        case \"UPDATE_ITEM\": {\n            const { itemName, updates } = action.payload;\n            console.log(\"Updating item:\", itemName, \"with\", updates);\n            return state.map(item =>\n                item.name === itemName ? { ...item, ...updates } : item\n            );\n        }\n        case \"UPDATE_INVENTORY\": {\n            const validatedNewInventory = action.payload.map(item => ({\n                name: item.name || \"Unknown Item\",\n                description: item.description || \"An item of unclear origin.\",\n                weight: typeof item.weight === 'number' ? item.weight : 1,\n                quality: item.quality || \"Common\" as ItemQuality,\n                durability: typeof item.durability === 'number' ? item.durability : undefined,\n                magicalEffect: item.magicalEffect || undefined,\n            }));\n            console.log(\"Replacing inventory with new list:\", validatedNewInventory.map(i => i.name));\n            return validatedNewInventory;\n        }\n        case \"UPDATE_CRAFTING_RESULT\": {\n            const { consumedItems, craftedItem } = action.payload;\n            let updatedInventory = [...state];\n\n            // Consume items\n            consumedItems.forEach(itemName => {\n                const indexToRemove = updatedInventory.findIndex(item => item.name === itemName);\n                if (indexToRemove > -1) {\n                    updatedInventory.splice(indexToRemove, 1);\n                } else {\n                    console.warn(`Attempted to consume non-existent item: ${itemName}`);\n                }\n            });\n\n            // Add crafted item if successful\n            if (craftedItem) {\n                updatedInventory.push(craftedItem);\n            }\n            return updatedInventory;\n        }\n         case \"START_GAMEPLAY\": // Initialize inventory on new game start\n            // Only initialize if not loading a save (reducer handles loading separately)\n             // Check if currentAdventureId exists in the *previous* state or passed somehow\n             // If not resuming, return initialInventory\n             // This logic might need adjustment depending on how START_GAMEPLAY interacts with LOAD_ADVENTURE\n             // For now, assume START_GAMEPLAY implies a new game unless LOAD_ADVENTURE happened before.\n            // A better approach might be to handle inventory init within the CREATE_CHARACTER or LOAD_ADVENTURE reducers.\n            // Let's return initialInventory for now, LOAD_ADVENTURE will overwrite it if needed.\n            return [...initialInventory]; // Return a copy\n        case \"RESET_GAME\":\n            return []; // Clear inventory on reset\n        case \"LOAD_ADVENTURE\":\n             // Validate inventory data from loaded adventure\n             return (Array.isArray(action.payload.inventory) ? action.payload.inventory : []).map(item => ({\n                 name: item.name || \"Unknown Item\",\n                 description: item.description || \"An item of unclear origin.\",\n                 weight: typeof item.weight === 'number' ? item.weight : 1,\n                 quality: item.quality || \"Common\" as ItemQuality,\n                 durability: typeof item.durability === 'number' ? item.durability : undefined,\n                 magicalEffect: item.magicalEffect || undefined,\n             }));\n        default:\n            return state;\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 774, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/context/reducers/settingsReducer.ts"],"sourcesContent":["\n// src/context/reducers/settingsReducer.ts\nimport type { AdventureSettings, DifficultyLevel } from \"../../types/adventure-types\";\nimport type { GameState } from \"../../types/game-types\";\nimport type { Action } from \"../game-actions\";\nimport { initialAdventureSettings } from \"../game-initial-state\";\nimport { VALID_ADVENTURE_DIFFICULTY_LEVELS } from \"../../lib/constants\";\n\n// Define the part of the state this reducer handles\ntype SettingsState = Pick<GameState, 'adventureSettings' | 'selectedThemeId' | 'isDarkMode' | 'userGoogleAiApiKey'>;\n\n// Combined reducer for settings (adventure settings + appearance + API key)\nexport function settingsReducer(state: SettingsState, action: Action): SettingsState {\n    switch (action.type) {\n        case \"SET_ADVENTURE_SETTINGS\": {\n            const incomingPayload = action.payload;\n            const currentAdventureTypeInState = state.adventureSettings.adventureType;\n            // Prioritize adventureType from payload if available, otherwise keep existing.\n            // This is crucial because AdventureSetup dispatches this with the type already determined.\n            const finalAdventureType = incomingPayload.adventureType ?? currentAdventureTypeInState;\n\n            if (!finalAdventureType) {\n                console.error(\"SettingsReducer: SET_ADVENTURE_SETTINGS - finalAdventureType is unexpectedly null/undefined. This could lead to issues.\", \"Incoming Payload:\", incomingPayload, \"Current state type:\", currentAdventureTypeInState);\n            }\n\n            const validatedDifficulty = VALID_ADVENTURE_DIFFICULTY_LEVELS.includes(incomingPayload.difficulty as DifficultyLevel)\n                 ? incomingPayload.difficulty as DifficultyLevel\n                 : state.adventureSettings.difficulty;\n\n            let characterOriginTypeForUpdate: 'existing' | 'original' | undefined = undefined;\n            if (finalAdventureType === 'Immersed') {\n                characterOriginTypeForUpdate = incomingPayload.characterOriginType ?? state.adventureSettings.characterOriginType ?? 'original';\n            }\n\n            const newSettings: AdventureSettings = {\n                ...state.adventureSettings, \n                ...incomingPayload,         \n                adventureType: finalAdventureType, \n                difficulty: validatedDifficulty,\n                characterOriginType: characterOriginTypeForUpdate,\n\n                // Ensure Custom fields are only populated if type is Custom\n                worldType: finalAdventureType === 'Custom' ? (incomingPayload.worldType ?? state.adventureSettings.worldType ?? \"\") : \"\",\n                mainQuestline: finalAdventureType === 'Custom' ? (incomingPayload.mainQuestline ?? state.adventureSettings.mainQuestline ?? \"\") : \"\",\n                genreTheme: finalAdventureType === 'Custom' ? (incomingPayload.genreTheme ?? state.adventureSettings.genreTheme ?? \"\") : \"\",\n                magicSystem: finalAdventureType === 'Custom' ? (incomingPayload.magicSystem ?? state.adventureSettings.magicSystem ?? \"\") : \"\",\n                techLevel: finalAdventureType === 'Custom' ? (incomingPayload.techLevel ?? state.adventureSettings.techLevel ?? \"\") : \"\",\n                dominantTone: finalAdventureType === 'Custom' ? (incomingPayload.dominantTone ?? state.adventureSettings.dominantTone ?? \"\") : \"\",\n                startingSituation: finalAdventureType === 'Custom' ? (incomingPayload.startingSituation ?? state.adventureSettings.startingSituation ?? \"\") : \"\",\n                combatFrequency: finalAdventureType === 'Custom' ? (incomingPayload.combatFrequency ?? state.adventureSettings.combatFrequency) : undefined,\n                puzzleFrequency: finalAdventureType === 'Custom' ? (incomingPayload.puzzleFrequency ?? state.adventureSettings.puzzleFrequency) : undefined,\n                socialFocus: finalAdventureType === 'Custom' ? (incomingPayload.socialFocus ?? state.adventureSettings.socialFocus) : undefined,\n\n                // Ensure Immersed fields are only populated if type is Immersed\n                universeName: finalAdventureType === 'Immersed' ? (incomingPayload.universeName ?? state.adventureSettings.universeName ?? \"\") : \"\",\n                playerCharacterConcept: finalAdventureType === 'Immersed' ? (incomingPayload.playerCharacterConcept ?? state.adventureSettings.playerCharacterConcept ?? \"\") : \"\",\n            };\n            console.log(\"SettingsReducer: SET_ADVENTURE_SETTINGS. Final settings being applied:\", JSON.stringify(newSettings));\n            return { ...state, adventureSettings: newSettings };\n        }\n        case \"SET_ADVENTURE_TYPE\": {\n            console.log(\"SettingsReducer: Setting adventure type to\", action.payload, \". Resetting specific fields.\");\n            const preservedDifficulty = state.adventureSettings.difficulty || initialAdventureSettings.difficulty;\n            const preservedPermadeath = state.adventureSettings.permanentDeath !== undefined\n                ? state.adventureSettings.permanentDeath\n                : initialAdventureSettings.permanentDeath;\n\n            return {\n                ...state,\n                adventureSettings: {\n                    // Start with a clean slate for adventure-specific settings\n                    ...initialAdventureSettings, \n                    adventureType: action.payload, // Set the new type\n                    // Preserve general settings\n                    difficulty: preservedDifficulty,\n                    permanentDeath: preservedPermadeath,\n                    // Crucially, characterOriginType is ONLY relevant for \"Immersed\"\n                    // For Randomized/Custom, it MUST be undefined.\n                    characterOriginType: action.payload === 'Immersed' ? 'original' : undefined,\n                }\n            };\n        }\n        case \"SET_THEME_ID\":\n            return { ...state, selectedThemeId: action.payload };\n        case \"SET_DARK_MODE\":\n            return { ...state, isDarkMode: action.payload };\n        case \"SET_USER_API_KEY\":\n            return { ...state, userGoogleAiApiKey: action.payload };\n         case \"RESET_GAME\":\n             // Preserve theme and API key, reset adventure settings\n             return {\n                ...state,\n                adventureSettings: { ...initialAdventureSettings }, \n             };\n         case \"LOAD_ADVENTURE\": {\n             const settingsToLoad = action.payload.adventureSettings;\n             const validatedDifficulty = VALID_ADVENTURE_DIFFICULTY_LEVELS.includes(settingsToLoad?.difficulty as DifficultyLevel)\n                 ? settingsToLoad.difficulty as DifficultyLevel\n                 : initialAdventureSettings.difficulty;\n\n             const loadedAdventureType = settingsToLoad?.adventureType || null;\n             let loadedCharacterOriginType: 'existing' | 'original' | undefined = undefined;\n             if (loadedAdventureType === 'Immersed') {\n                loadedCharacterOriginType = settingsToLoad?.characterOriginType ?? 'original';\n             }\n\n\n             const validatedSettings: AdventureSettings = {\n                 ...initialAdventureSettings,\n                 ...(settingsToLoad || {}),\n                 adventureType: loadedAdventureType,\n                 difficulty: validatedDifficulty,\n                 characterOriginType: loadedCharacterOriginType,\n\n                worldType: loadedAdventureType === 'Custom' ? (settingsToLoad?.worldType ?? \"\") : \"\",\n                mainQuestline: loadedAdventureType === 'Custom' ? (settingsToLoad?.mainQuestline ?? \"\") : \"\",\n                genreTheme: loadedAdventureType === 'Custom' ? (settingsToLoad?.genreTheme ?? \"\") : \"\",\n                magicSystem: loadedAdventureType === 'Custom' ? (settingsToLoad?.magicSystem ?? \"\") : \"\",\n                techLevel: loadedAdventureType === 'Custom' ? (settingsToLoad?.techLevel ?? \"\") : \"\",\n                dominantTone: loadedAdventureType === 'Custom' ? (settingsToLoad?.dominantTone ?? \"\") : \"\",\n                startingSituation: loadedAdventureType === 'Custom' ? (settingsToLoad?.startingSituation ?? \"\") : \"\",\n                combatFrequency: loadedAdventureType === 'Custom' ? (settingsToLoad?.combatFrequency) : undefined,\n                puzzleFrequency: loadedAdventureType === 'Custom' ? (settingsToLoad?.puzzleFrequency) : undefined,\n                socialFocus: loadedAdventureType === 'Custom' ? (settingsToLoad?.socialFocus) : undefined,\n\n                universeName: loadedAdventureType === 'Immersed' ? (settingsToLoad?.universeName ?? \"\") : \"\",\n                playerCharacterConcept: loadedAdventureType === 'Immersed' ? (settingsToLoad?.playerCharacterConcept ?? \"\") : \"\",\n             };\n             console.log(\"SettingsReducer: Loaded adventure settings:\", JSON.stringify(validatedSettings));\n             return {\n                ...state,\n                 adventureSettings: validatedSettings\n             };\n         }\n        default:\n            return state;\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 916, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/lib/game-state-utils.ts"],"sourcesContent":["\n// src/lib/game-state-utils.ts\n\nimport type { Character } from \"../types/character-types\";\nimport type { InventoryItem } from \"../types/inventory-types\";\n\n/**\n * Helper function to update the game state string with current character and inventory info.\n * It parses the existing string and replaces relevant sections.\n *\n * @param baseString - The current game state string.\n * @param character - The current character object.\n * @param inventory - The current inventory array.\n * @param turn - The current turn count.\n * @returns The updated game state string.\n */\nexport const updateGameStateString = (\n    baseString: string,\n    character: Character | null,\n    inventory: InventoryItem[],\n    turn: number\n): string => {\n    if (!character) return baseString; // Return base if no character\n\n    let updatedString = baseString;\n\n    // Update Turn Count\n    updatedString = updatedString.replace(/Turn: \\d+/, `Turn: ${turn}`);\n\n    // Update Level and XP\n    updatedString = updatedString.replace(/Level: \\d+ \\(\\d+\\/\\d+ XP\\)/, `Level: ${character.level} (${character.xp}/${character.xpToNextLevel} XP)`);\n\n    // Update Inventory\n    const inventoryString = inventory.length > 0 ? inventory.map(item => `${item.name}${item.quality && item.quality !== 'Common' ? ` (${item.quality})` : ''}`).join(', ') : 'Empty';\n    updatedString = updatedString.replace(/Inventory:.*?(?:\\n|$)/, `Inventory: ${inventoryString}\\n`);\n\n    // Update Status (Stamina/Mana)\n    updatedString = updatedString.replace(/Status:.*?\\(STA: \\d+\\/\\d+, MANA: \\d+\\/\\d+\\)/, `Status: Healthy (STA: ${character.currentStamina}/${character.maxStamina}, MANA: ${character.currentMana}/${character.maxMana})`);\n\n    // Update Reputation\n    const reputationString = Object.entries(character.reputation).map(([f, s]) => `${f}: ${s}`).join(', ') || 'None';\n    updatedString = updatedString.replace(/Reputation:.*?(?:\\n|$)/, `Reputation: ${reputationString}\\n`);\n\n    // Update NPC Relationships\n    const relationshipString = Object.entries(character.npcRelationships).map(([n, s]) => `${n}: ${s}`).join(', ') || 'None';\n    updatedString = updatedString.replace(/NPC Relationships:.*?(?:\\n|$)/, `NPC Relationships: ${relationshipString}\\n`);\n\n    // Update Class\n    updatedString = updatedString.replace(/Class: .*?(?:\\n|$)/, `Class: ${character.class}\\n`);\n\n    // Update Skill Stage\n    const currentStage = character.skillTreeStage ?? 0;\n    const stageName = currentStage >= 0 && character.skillTree && character.skillTree.stages.length > currentStage\n        ? character.skillTree.stages[currentStage]?.stageName ?? `Stage ${currentStage}`\n        : \"Potential\";\n    const skillStageString = character.skillTree ? `${stageName} (Stage ${currentStage}/4)` : 'None';\n    updatedString = updatedString.replace(/Skill Stage:.*?(?:\\n|$)/, `Skill Stage: ${skillStageString}\\n`);\n\n    // Update Learned Skills\n    const learnedSkillsString = character.learnedSkills.map(s => s.name).join(', ') || 'None';\n    updatedString = updatedString.replace(/Learned Skills:.*?(?:\\n|$)/, `Learned Skills: ${learnedSkillsString}\\n`);\n\n    // Note: Character description, traits, knowledge, background, stats, AI profile, and adventure settings\n    // are usually part of the initial state or updated less frequently, so we might not need\n    // to parse and replace them on every narration update unless explicitly changed by the AI.\n    // If they *can* change, add similar replace logic here.\n\n    return updatedString;\n};\n"],"names":[],"mappings":"AACA,8BAA8B;;;;AAevB,MAAM,wBAAwB,CACjC,YACA,WACA,WACA;IAEA,IAAI,CAAC,WAAW,OAAO,YAAY,8BAA8B;IAEjE,IAAI,gBAAgB;IAEpB,oBAAoB;IACpB,gBAAgB,cAAc,OAAO,CAAC,aAAa,CAAC,MAAM,EAAE,MAAM;IAElE,sBAAsB;IACtB,gBAAgB,cAAc,OAAO,CAAC,8BAA8B,CAAC,OAAO,EAAE,UAAU,KAAK,CAAC,EAAE,EAAE,UAAU,EAAE,CAAC,CAAC,EAAE,UAAU,aAAa,CAAC,IAAI,CAAC;IAE/I,mBAAmB;IACnB,MAAM,kBAAkB,UAAU,MAAM,GAAG,IAAI,UAAU,GAAG,CAAC,CAAA,OAAQ,GAAG,KAAK,IAAI,GAAG,KAAK,OAAO,IAAI,KAAK,OAAO,KAAK,WAAW,CAAC,EAAE,EAAE,KAAK,OAAO,CAAC,CAAC,CAAC,GAAG,IAAI,EAAE,IAAI,CAAC,QAAQ;IAC1K,gBAAgB,cAAc,OAAO,CAAC,yBAAyB,CAAC,WAAW,EAAE,gBAAgB,EAAE,CAAC;IAEhG,+BAA+B;IAC/B,gBAAgB,cAAc,OAAO,CAAC,+CAA+C,CAAC,sBAAsB,EAAE,UAAU,cAAc,CAAC,CAAC,EAAE,UAAU,UAAU,CAAC,QAAQ,EAAE,UAAU,WAAW,CAAC,CAAC,EAAE,UAAU,OAAO,CAAC,CAAC,CAAC;IAEtN,oBAAoB;IACpB,MAAM,mBAAmB,OAAO,OAAO,CAAC,UAAU,UAAU,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAK,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,SAAS;IAC1G,gBAAgB,cAAc,OAAO,CAAC,0BAA0B,CAAC,YAAY,EAAE,iBAAiB,EAAE,CAAC;IAEnG,2BAA2B;IAC3B,MAAM,qBAAqB,OAAO,OAAO,CAAC,UAAU,gBAAgB,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAK,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,SAAS;IAClH,gBAAgB,cAAc,OAAO,CAAC,iCAAiC,CAAC,mBAAmB,EAAE,mBAAmB,EAAE,CAAC;IAEnH,eAAe;IACf,gBAAgB,cAAc,OAAO,CAAC,sBAAsB,CAAC,OAAO,EAAE,UAAU,KAAK,CAAC,EAAE,CAAC;IAEzF,qBAAqB;IACrB,MAAM,eAAe,UAAU,cAAc,IAAI;IACjD,MAAM,YAAY,gBAAgB,KAAK,UAAU,SAAS,IAAI,UAAU,SAAS,CAAC,MAAM,CAAC,MAAM,GAAG,eAC5F,UAAU,SAAS,CAAC,MAAM,CAAC,aAAa,EAAE,aAAa,CAAC,MAAM,EAAE,cAAc,GAC9E;IACN,MAAM,mBAAmB,UAAU,SAAS,GAAG,GAAG,UAAU,QAAQ,EAAE,aAAa,GAAG,CAAC,GAAG;IAC1F,gBAAgB,cAAc,OAAO,CAAC,2BAA2B,CAAC,aAAa,EAAE,iBAAiB,EAAE,CAAC;IAErG,wBAAwB;IACxB,MAAM,sBAAsB,UAAU,aAAa,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,EAAE,IAAI,CAAC,SAAS;IACnF,gBAAgB,cAAc,OAAO,CAAC,8BAA8B,CAAC,gBAAgB,EAAE,oBAAoB,EAAE,CAAC;IAE9G,wGAAwG;IACxG,yFAAyF;IACzF,2FAA2F;IAC3F,wDAAwD;IAExD,OAAO;AACX","debugId":null}},
    {"offset": {"line": 963, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/context/reducers/adventureReducer.ts"],"sourcesContent":["\n// src/context/reducers/adventureReducer.ts\nimport type { GameState } from \"../../types/game-types\";\nimport type { StoryLogEntry, SavedAdventure } from \"../../types/adventure-types\";\nimport type { Action } from \"../game-actions\";\nimport { initialState, initialInventory } from \"../game-initial-state\";\nimport { generateAdventureId, calculateMaxHealth, calculateMaxActionStamina, calculateMaxMana } from \"../../lib/gameUtils\";\nimport { updateGameStateString } from \"../../lib/game-state-utils\";\nimport { SAVED_ADVENTURES_KEY } from \"../../lib/constants\";\n\nexport function adventureReducer(state: GameState, action: Action): GameState {\n    switch (action.type) {\n        case \"SET_GAME_STATUS\":\n            return { ...state, status: action.payload };\n\n        case \"START_GAMEPLAY\": {\n            if (state.adventureSettings.adventureType !== \"Coop\" && !state.character) {\n                console.error(\"AdventureReducer: Cannot start single-player gameplay: Character is null. Resetting to Main Menu.\");\n                return { ...initialState, savedAdventures: state.savedAdventures, selectedThemeId: state.selectedThemeId, isDarkMode: state.isDarkMode, userGoogleAiApiKey: state.userGoogleAiApiKey };\n            }\n            if (!state.adventureSettings.adventureType && state.adventureSettings.adventureType !== \"Coop\") { // Allow Coop to start without adventureType pre-set if session handles it\n                console.error(\"AdventureReducer: Cannot start gameplay: Adventure type is not set. Resetting to Main Menu.\");\n                 return { ...initialState, savedAdventures: state.savedAdventures, selectedThemeId: state.selectedThemeId, isDarkMode: state.isDarkMode, userGoogleAiApiKey: state.userGoogleAiApiKey };\n            }\n            const adventureId = state.currentAdventureId || (state.adventureSettings.adventureType === \"Coop\" ? state.sessionId : generateAdventureId());\n            const turnCount = state.turnCount > 0 ? state.turnCount : 0;\n            const currentInventory = state.inventory.length > 0 ? state.inventory : [...initialInventory];\n            const initialGameState = updateGameStateString( state.storyLog.length > 0 ? state.currentGameStateString : \"The adventure is about to begin...\", state.character, currentInventory, turnCount );\n            \n            const newStatus = state.adventureSettings.adventureType === \"Coop\" ? \"CoopGameplay\" : \"Gameplay\";\n\n            return {\n                ...state, status: newStatus, inventory: currentInventory, currentGameStateString: initialGameState,\n                currentAdventureId: adventureId,\n                isGeneratingSkillTree: state.character ? (state.adventureSettings.adventureType !== \"Immersed\" && !state.character.skillTree && !state.isGeneratingSkillTree) : false,\n                turnCount: turnCount,\n            };\n        }\n\n        case \"UPDATE_NARRATION\": {\n            const newLogEntry: StoryLogEntry = { ...action.payload, timestamp: action.payload.timestamp || Date.now() };\n            const newLog = [...state.storyLog, newLogEntry];\n            const newTurnCount = state.turnCount + 1;\n            \n            // Create a deep copy of the character to apply updates\n            let updatedCharacter = state.character ? { ...state.character } : null;\n\n            if (updatedCharacter) {\n                 const { updatedStats, updatedTraits, updatedKnowledge, healthChange, staminaChange, manaChange, gainedSkill, xpGained, reputationChange, npcRelationshipChange, progressedToStage } = action.payload;\n\n                 // Update Stats and recalculate derived max values\n                 if (updatedStats) {\n                     updatedCharacter.stats = { ...updatedCharacter.stats, ...updatedStats };\n                     updatedCharacter.maxHealth = calculateMaxHealth(updatedCharacter.stats);\n                     updatedCharacter.maxStamina = calculateMaxActionStamina(updatedCharacter.stats);\n                     updatedCharacter.maxMana = calculateMaxMana(updatedCharacter.stats, updatedCharacter.knowledge);\n                 }\n\n                 // Update Lists\n                 if (updatedTraits) updatedCharacter.traits = updatedTraits;\n                 if (updatedKnowledge) updatedCharacter.knowledge = updatedKnowledge;\n\n                 // Recalculate max values if knowledge changed (affects Mana)\n                 if (updatedKnowledge) {\n                    updatedCharacter.maxMana = calculateMaxMana(updatedCharacter.stats, updatedCharacter.knowledge);\n                 }\n\n                 // Update Vitals (Current)\n                 if (healthChange) updatedCharacter.currentHealth = Math.max(0, Math.min(updatedCharacter.maxHealth, updatedCharacter.currentHealth + healthChange));\n                 if (staminaChange) updatedCharacter.currentStamina = Math.max(0, Math.min(updatedCharacter.maxStamina, updatedCharacter.currentStamina + staminaChange));\n                 if (manaChange) updatedCharacter.currentMana = Math.max(0, Math.min(updatedCharacter.maxMana, updatedCharacter.currentMana + manaChange));\n\n                 // Update Skills/XP/Rep\n                 if (gainedSkill && !updatedCharacter.learnedSkills.some(s => s.name === gainedSkill.name)) {\n                     updatedCharacter.learnedSkills = [...updatedCharacter.learnedSkills, { ...gainedSkill, type: 'Learned' }];\n                 }\n                 if (xpGained) updatedCharacter.xp += xpGained;\n\n                 if (reputationChange) {\n                     const { faction, change } = reputationChange;\n                     const currentScore = updatedCharacter.reputation[faction] ?? 0;\n                     updatedCharacter.reputation = {\n                        ...updatedCharacter.reputation,\n                        [faction]: Math.max(-100, Math.min(100, currentScore + change))\n                     };\n                 }\n\n                 if (npcRelationshipChange) {\n                     const { npcName, change } = npcRelationshipChange;\n                     const currentScore = updatedCharacter.npcRelationships[npcName] ?? 0;\n                     updatedCharacter.npcRelationships = {\n                        ...updatedCharacter.npcRelationships,\n                        [npcName]: Math.max(-100, Math.min(100, currentScore + change))\n                     };\n                 }\n\n                 if (progressedToStage !== undefined && progressedToStage > updatedCharacter.skillTreeStage) {\n                     updatedCharacter.skillTreeStage = progressedToStage;\n                 }\n            }\n\n            const updatedGameState = updateGameStateString(action.payload.updatedGameState, updatedCharacter, state.inventory, newTurnCount);\n\n            if (action.payload.isCharacterDefeated && updatedCharacter && updatedCharacter.currentHealth <= 0) {\n                if (state.adventureSettings.permanentDeath) {\n                    console.log(\"AdventureReducer: Character defeated (Permadeath). Game will end.\");\n                } else {\n                    console.log(\"AdventureReducer: Character defeated. Respawn should be triggered.\");\n                }\n            }\n            return {\n                ...state, \n                character: updatedCharacter,\n                currentNarration: newLogEntry, \n                storyLog: newLog,\n                currentGameStateString: updatedGameState, \n                turnCount: newTurnCount,\n            };\n        }\n        case \"RESPAWN_CHARACTER\": {\n            if (!state.character) return state;\n             const respawnMessage = action.payload?.narrationMessage || \"You had a narrow escape and have recovered!\";\n             const respawnLogEntry: StoryLogEntry = {\n                 narration: respawnMessage,\n                 updatedGameState: updateGameStateString(state.currentGameStateString, state.character, state.inventory, state.turnCount),\n                 timestamp: Date.now(),\n             };\n             \n             // Restore character vitals\n             const updatedCharacter = {\n                 ...state.character,\n                 currentHealth: state.character.maxHealth,\n                 currentStamina: state.character.maxStamina,\n                 currentMana: state.character.maxMana\n             };\n\n            return {\n                ...state,\n                character: updatedCharacter,\n                storyLog: [...state.storyLog, respawnLogEntry],\n                currentNarration: respawnLogEntry,\n            };\n        }\n\n        case \"UPDATE_CRAFTING_RESULT\": {\n            const { narration, newGameStateString: providedGameState } = action.payload;\n            const newTurnCount = state.turnCount + 1;\n            if (!state.character) return { ...state, turnCount: newTurnCount };\n             const finalGameStateString = updateGameStateString(providedGameState || state.currentGameStateString, state.character, state.inventory, newTurnCount);\n             const craftingLogEntry: StoryLogEntry = { narration: narration, updatedGameState: finalGameStateString, timestamp: Date.now() };\n             return {\n                 ...state, storyLog: [...state.storyLog, craftingLogEntry], currentNarration: craftingLogEntry,\n                 currentGameStateString: finalGameStateString, turnCount: newTurnCount,\n             };\n        }\n\n        case \"INCREMENT_TURN\": return { ...state, turnCount: state.turnCount + 1 };\n        case \"SET_SKILL_TREE_GENERATING\": return { ...state, isGeneratingSkillTree: action.payload };\n\n        case \"END_ADVENTURE\": {\n             let finalLog = [...state.storyLog];\n             let finalGameState = state.currentGameStateString;\n             let finalCharacterState = state.character;\n             let finalInventoryState = state.inventory;\n             let finalTurnCount = state.turnCount;\n\n             if (action.payload.finalNarration && (!state.currentNarration || action.payload.finalNarration.narration !== state.currentNarration.narration)) {\n                 const finalEntry: StoryLogEntry = { ...action.payload.finalNarration, timestamp: action.payload.finalNarration.timestamp || Date.now() };\n                 finalLog.push(finalEntry);\n                 finalCharacterState = state.character;\n                 finalInventoryState = state.inventory;\n                 finalTurnCount = state.turnCount + (action.payload.finalNarration ? 1: 0) ;\n                 if (finalCharacterState) {\n                     finalGameState = updateGameStateString(action.payload.finalNarration.updatedGameState, finalCharacterState, finalInventoryState, finalTurnCount);\n                 }\n             }\n\n             let updatedSavedAdventures = state.savedAdventures;\n             if (finalCharacterState && state.currentAdventureId && state.adventureSettings.adventureType !== \"Coop\") { // Only save non-Coop games locally this way\n                 const endedAdventure: SavedAdventure = {\n                     id: state.currentAdventureId, saveTimestamp: Date.now(), characterName: finalCharacterState.name,\n                     character: finalCharacterState, adventureSettings: state.adventureSettings, storyLog: finalLog,\n                     currentGameStateString: finalGameState, inventory: finalInventoryState, statusBeforeSave: \"AdventureSummary\",\n                     adventureSummary: action.payload.summary, turnCount: finalTurnCount,\n                 };\n                 updatedSavedAdventures = state.savedAdventures.filter(adv => adv.id !== endedAdventure.id);\n                 updatedSavedAdventures.push(endedAdventure);\n                 localStorage.setItem(SAVED_ADVENTURES_KEY, JSON.stringify(updatedSavedAdventures));\n             }\n             return {\n                 ...state, status: \"AdventureSummary\", character: finalCharacterState, adventureSummary: action.payload.summary,\n                 storyLog: finalLog, inventory: finalInventoryState, turnCount: finalTurnCount, currentNarration: null,\n                 savedAdventures: updatedSavedAdventures, isGeneratingSkillTree: false,\n                 sessionId: state.adventureSettings.adventureType === \"Coop\" ? null : state.sessionId, // Clear session ID if it was a co-op game ending\n                 isHost: state.adventureSettings.adventureType === \"Coop\" ? false : state.isHost,\n             };\n        }\n\n        case \"LOAD_SAVED_ADVENTURES\": return { ...state, savedAdventures: action.payload };\n\n        case \"SAVE_CURRENT_ADVENTURE\": {\n            if (!state.character || !state.currentAdventureId || state.status !== \"Gameplay\" || state.adventureSettings.adventureType === \"Coop\") {\n                return state; // Do not save co-op games this way\n            }\n            const currentSave: SavedAdventure = {\n              id: state.currentAdventureId, saveTimestamp: Date.now(), characterName: state.character.name,\n              character: state.character, adventureSettings: state.adventureSettings, storyLog: state.storyLog,\n              currentGameStateString: updateGameStateString(state.currentGameStateString, state.character, state.inventory, state.turnCount),\n              inventory: state.inventory, statusBeforeSave: state.status, adventureSummary: state.adventureSummary,\n              turnCount: state.turnCount,\n            };\n            const savesWithoutCurrent = state.savedAdventures.filter(adv => adv.id !== currentSave.id);\n            const newSaves = [...savesWithoutCurrent, currentSave];\n            localStorage.setItem(SAVED_ADVENTURES_KEY, JSON.stringify(newSaves));\n            return { ...state, savedAdventures: newSaves };\n          }\n\n        case \"LOAD_ADVENTURE\": {\n            const adventureToLoad = action.payload;\n            if (!adventureToLoad || adventureToLoad.adventureSettings.adventureType === \"Coop\") {\n                return state; // Do not load co-op games this way\n            }\n            const statusToLoad = adventureToLoad.statusBeforeSave || (adventureToLoad.adventureSummary ? \"AdventureSummary\" : \"Gameplay\");\n             return {\n                 ...initialState,\n                 savedAdventures: state.savedAdventures, selectedThemeId: state.selectedThemeId,\n                 isDarkMode: state.isDarkMode, userGoogleAiApiKey: state.userGoogleAiApiKey,\n                 status: statusToLoad, character: adventureToLoad.character,\n                 adventureSettings: adventureToLoad.adventureSettings, storyLog: adventureToLoad.storyLog,\n                 inventory: adventureToLoad.inventory, turnCount: adventureToLoad.turnCount || 0,\n                 currentGameStateString: adventureToLoad.currentGameStateString,\n                 currentNarration: adventureToLoad.storyLog.length > 0 ? adventureToLoad.storyLog[adventureToLoad.storyLog.length - 1] : null,\n                 adventureSummary: adventureToLoad.adventureSummary, currentAdventureId: adventureToLoad.id,\n                 isGeneratingSkillTree: false,\n             };\n         }\n\n        case \"DELETE_ADVENTURE\": {\n            const filteredSaves = state.savedAdventures.filter(adv => adv.id !== action.payload);\n            localStorage.setItem(SAVED_ADVENTURES_KEY, JSON.stringify(filteredSaves));\n            return { ...state, savedAdventures: filteredSaves };\n         }\n\n        // --- Multiplayer Actions ---\n        case \"SET_SESSION_ID\":\n            return { ...state, sessionId: action.payload, currentAdventureId: action.payload }; // For co-op, sessionID is the adventureID\n        case \"SET_PLAYERS\":\n            return { ...state, players: action.payload };\n        case \"ADD_PLAYER\":\n            if (state.players.includes(action.payload)) return state;\n            return { ...state, players: [...state.players, action.payload] };\n        case \"REMOVE_PLAYER\":\n            return { ...state, players: state.players.filter(uid => uid !== action.payload) };\n        case \"SET_CURRENT_PLAYER_UID\":\n            return { ...state, currentPlayerUid: action.payload };\n        case \"SET_IS_HOST\":\n            return { ...state, isHost: action.payload };\n        case \"SYNC_COOP_SESSION_STATE\": {\n            const sessionData = action.payload;\n            let updatedState = { ...state };\n            if (sessionData.players) updatedState.players = sessionData.players;\n            if (sessionData.turnCount !== undefined) updatedState.turnCount = sessionData.turnCount;\n            if (sessionData.storyLog) updatedState.storyLog = sessionData.storyLog;\n            if (sessionData.currentGameStateString) updatedState.currentGameStateString = sessionData.currentGameStateString;\n            if (sessionData.sharedCharacter) updatedState.character = sessionData.sharedCharacter; // Simple sync for now\n            if (sessionData.sharedInventory) updatedState.inventory = sessionData.sharedInventory;\n            if (sessionData.adventureSettings) {\n                updatedState.adventureSettings = {\n                    ...state.adventureSettings, // Keep local settings like difficulty if not in session\n                    ...sessionData.adventureSettings,\n                    adventureType: \"Coop\", // Ensure type is Coop\n                };\n            }\n            if (sessionData.storyLog && sessionData.storyLog.length > 0) {\n                updatedState.currentNarration = sessionData.storyLog[sessionData.storyLog.length - 1];\n            }\n            return updatedState;\n        }\n\n        default:\n            return state;\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1366, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/context/game-reducer.ts"],"sourcesContent":["\"use client\";\n\n// src/context/game-reducer.ts\nimport type { GameState } from \"../types/game-types\";\nimport type { Action } from \"./game-actions\";\nimport { initialAdventureSettings, initialState } from \"./game-initial-state\";\nimport { characterReducer } from \"./reducers/characterReducer\";\nimport { inventoryReducer } from \"./reducers/inventoryReducer\";\nimport { settingsReducer } from \"./reducers/settingsReducer\";\nimport { adventureReducer } from \"./reducers/adventureReducer\"; // This will handle most game flow logic\n\nexport function gameReducer(state: GameState, action: Action): GameState {\n    console.log(`GameReducer: Action received - ${action.type}`, (action as any).payload !== undefined ? JSON.stringify((action as any).payload).substring(0,300) : '(no payload)');\n\n    const updatedCharacter = characterReducer(state.character, action);\n    const updatedInventory = inventoryReducer(state.inventory, action);\n    const settingsRelatedState = settingsReducer(\n        {\n            adventureSettings: state.adventureSettings,\n            selectedThemeId: state.selectedThemeId,\n            isDarkMode: state.isDarkMode,\n            userGoogleAiApiKey: state.userGoogleAiApiKey,\n        },\n        action\n    );\n\n    let nextState: GameState = {\n        ...state,\n        character: updatedCharacter,\n        inventory: updatedInventory,\n        adventureSettings: settingsRelatedState.adventureSettings,\n        selectedThemeId: settingsRelatedState.selectedThemeId,\n        isDarkMode: settingsRelatedState.isDarkMode,\n        userGoogleAiApiKey: settingsRelatedState.userGoogleAiApiKey,\n    };\n\n    nextState = adventureReducer(nextState, action);\n\n    switch (action.type) {\n        case \"RESET_GAME\": {\n            const { savedAdventures, selectedThemeId, isDarkMode, userGoogleAiApiKey } = state;\n            console.log(\"GameReducer: Resetting game to initial state, preserving session settings.\");\n            return {\n                ...initialState,\n                savedAdventures,\n                selectedThemeId,\n                isDarkMode,\n                userGoogleAiApiKey,\n                status: \"MainMenu\",\n            };\n        }\n        // CREATE_CHARACTER_AND_SETUP is now fully handled by adventureReducer which calls characterReducer\n        // Other specific root actions handled by adventureReducer or sub-reducers.\n        default:\n            return nextState;\n    }\n}"],"names":[],"mappings":";;;AAKA;AACA;AACA;AACA;AACA,iQAAgE,wCAAwC;AATxG;;;;;;AAWO,SAAS,YAAY,KAAgB,EAAE,MAAc;IACxD,QAAQ,GAAG,CAAC,CAAC,+BAA+B,EAAE,OAAO,IAAI,EAAE,EAAE,AAAC,OAAe,OAAO,KAAK,YAAY,KAAK,SAAS,CAAC,AAAC,OAAe,OAAO,EAAE,SAAS,CAAC,GAAE,OAAO;IAEhK,MAAM,mBAAmB,CAAA,GAAA,iJAAA,CAAA,mBAAgB,AAAD,EAAE,MAAM,SAAS,EAAE;IAC3D,MAAM,mBAAmB,CAAA,GAAA,iJAAA,CAAA,mBAAgB,AAAD,EAAE,MAAM,SAAS,EAAE;IAC3D,MAAM,uBAAuB,CAAA,GAAA,gJAAA,CAAA,kBAAe,AAAD,EACvC;QACI,mBAAmB,MAAM,iBAAiB;QAC1C,iBAAiB,MAAM,eAAe;QACtC,YAAY,MAAM,UAAU;QAC5B,oBAAoB,MAAM,kBAAkB;IAChD,GACA;IAGJ,IAAI,YAAuB;QACvB,GAAG,KAAK;QACR,WAAW;QACX,WAAW;QACX,mBAAmB,qBAAqB,iBAAiB;QACzD,iBAAiB,qBAAqB,eAAe;QACrD,YAAY,qBAAqB,UAAU;QAC3C,oBAAoB,qBAAqB,kBAAkB;IAC/D;IAEA,YAAY,CAAA,GAAA,iJAAA,CAAA,mBAAgB,AAAD,EAAE,WAAW;IAExC,OAAQ,OAAO,IAAI;QACf,KAAK;YAAc;gBACf,MAAM,EAAE,eAAe,EAAE,eAAe,EAAE,UAAU,EAAE,kBAAkB,EAAE,GAAG;gBAC7E,QAAQ,GAAG,CAAC;gBACZ,OAAO;oBACH,GAAG,6IAAA,CAAA,eAAY;oBACf;oBACA;oBACA;oBACA;oBACA,QAAQ;gBACZ;YACJ;QACA,mGAAmG;QACnG,2EAA2E;QAC3E;YACI,OAAO;IACf;AACJ","debugId":null}},
    {"offset": {"line": 1429, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/lib/themes.ts"],"sourcesContent":["// src/lib/themes.ts\n\nexport interface Theme {\n    name: string;\n    id: string;\n    light: Record<string, string>; // CSS variable -> HSL value\n    dark: Record<string, string>;\n}\n\n// --- Define Color Themes ---\nexport const THEMES: Theme[] = [\n    {\n        name: \"Cardboard\",\n        id: \"cardboard\",\n        light: {\n            \"--background\": \"20 15% 95%\",\n            \"--foreground\": \"20 10% 20%\",\n            \"--card\": \"30 20% 92%\",\n            \"--card-foreground\": \"20 10% 20%\",\n            \"--popover\": \"30 20% 92%\",\n            \"--popover-foreground\": \"20 10% 20%\",\n            \"--primary\": \"0 0% 50%\",\n            \"--primary-foreground\": \"0 0% 100%\",\n            \"--secondary\": \"30 15% 80%\",\n            \"--secondary-foreground\": \"20 10% 20%\",\n            \"--muted\": \"30 15% 85%\",\n            \"--muted-foreground\": \"0 0% 45%\",\n            \"--accent\": \"20 60% 50%\", // Burnt Orange\n            \"--accent-foreground\": \"0 0% 100%\",\n            \"--destructive\": \"0 84.2% 60.2%\",\n            \"--destructive-foreground\": \"0 0% 98%\",\n            \"--border\": \"20 10% 75%\",\n            \"--input\": \"20 10% 80%\",\n            \"--ring\": \"20 60% 50%\",\n            \"--chart-1\": \"12 76% 61%\",\n            \"--chart-2\": \"173 58% 39%\",\n            \"--chart-3\": \"197 37% 24%\",\n            \"--chart-4\": \"43 74% 66%\",\n            \"--chart-5\": \"27 87% 67%\",\n        },\n        dark: {\n            \"--background\": \"20 10% 10%\",\n            \"--foreground\": \"20 5% 95%\",\n            \"--card\": \"20 10% 15%\",\n            \"--card-foreground\": \"20 5% 95%\",\n            \"--popover\": \"20 10% 15%\",\n            \"--popover-foreground\": \"20 5% 95%\",\n            \"--primary\": \"0 0% 70%\",\n            \"--primary-foreground\": \"0 0% 10%\",\n            \"--secondary\": \"30 10% 25%\",\n            \"--secondary-foreground\": \"20 5% 95%\",\n            \"--muted\": \"30 10% 20%\",\n            \"--muted-foreground\": \"0 0% 63.9%\",\n            \"--accent\": \"20 60% 50%\", // Burnt Orange\n            \"--accent-foreground\": \"0 0% 100%\",\n            \"--destructive\": \"0 62.8% 30.6%\",\n            \"--destructive-foreground\": \"0 0% 98%\",\n            \"--border\": \"20 10% 30%\",\n            \"--input\": \"20 10% 35%\",\n            \"--ring\": \"20 60% 50%\",\n            \"--chart-1\": \"220 70% 50%\",\n            \"--chart-2\": \"160 60% 45%\",\n            \"--chart-3\": \"30 80% 55%\",\n            \"--chart-4\": \"280 65% 60%\",\n            \"--chart-5\": \"340 75% 55%\",\n        }\n    },\n    {\n        name: \"Ocean Depths\",\n        id: \"ocean\",\n        light: {\n             \"--background\": \"210 40% 98%\",\n             \"--foreground\": \"210 30% 15%\",\n             \"--card\": \"210 40% 94%\",\n             \"--card-foreground\": \"210 30% 15%\",\n             \"--popover\": \"210 40% 94%\",\n             \"--popover-foreground\": \"210 30% 15%\",\n             \"--primary\": \"210 60% 45%\", // Deep Blue\n             \"--primary-foreground\": \"0 0% 100%\",\n             \"--secondary\": \"180 40% 85%\", // Tealish Gray\n             \"--secondary-foreground\": \"210 30% 15%\",\n             \"--muted\": \"210 40% 90%\",\n             \"--muted-foreground\": \"210 15% 45%\",\n             \"--accent\": \"185 70% 50%\", // Cyan/Teal\n             \"--accent-foreground\": \"210 30% 15%\",\n             \"--destructive\": \"0 84.2% 60.2%\",\n             \"--destructive-foreground\": \"0 0% 98%\",\n             \"--border\": \"210 20% 75%\",\n             \"--input\": \"210 20% 80%\",\n             \"--ring\": \"185 70% 50%\",\n             \"--chart-1\": \"210 80% 55%\",\n             \"--chart-2\": \"185 75% 45%\",\n             \"--chart-3\": \"195 60% 60%\",\n             \"--chart-4\": \"220 50% 70%\",\n             \"--chart-5\": \"170 65% 40%\",\n         },\n         dark: {\n             \"--background\": \"210 30% 10%\",\n             \"--foreground\": \"210 20% 95%\",\n             \"--card\": \"210 30% 15%\",\n             \"--card-foreground\": \"210 20% 95%\",\n             \"--popover\": \"210 30% 15%\",\n             \"--popover-foreground\": \"210 20% 95%\",\n             \"--primary\": \"210 70% 65%\", // Lighter Deep Blue\n             \"--primary-foreground\": \"210 30% 10%\",\n             \"--secondary\": \"180 30% 25%\", // Dark Tealish Gray\n             \"--secondary-foreground\": \"210 20% 95%\",\n             \"--muted\": \"210 30% 20%\",\n             \"--muted-foreground\": \"210 15% 63.9%\",\n             \"--accent\": \"185 60% 60%\", // Brighter Cyan/Teal\n             \"--accent-foreground\": \"210 30% 10%\",\n             \"--destructive\": \"0 62.8% 30.6%\",\n             \"--destructive-foreground\": \"0 0% 98%\",\n             \"--border\": \"210 20% 30%\",\n             \"--input\": \"210 20% 35%\",\n             \"--ring\": \"185 60% 60%\",\n             \"--chart-1\": \"210 70% 60%\",\n             \"--chart-2\": \"185 65% 55%\",\n             \"--chart-3\": \"195 50% 70%\",\n             \"--chart-4\": \"220 40% 80%\",\n             \"--chart-5\": \"170 70% 50%\",\n         }\n    },\n    {\n        name: \"Forest Canopy\",\n        id: \"forest\",\n         light: {\n             \"--background\": \"120 10% 96%\",\n             \"--foreground\": \"120 20% 10%\",\n             \"--card\": \"110 15% 93%\",\n             \"--card-foreground\": \"120 20% 10%\",\n             \"--popover\": \"110 15% 93%\",\n             \"--popover-foreground\": \"120 20% 10%\",\n             \"--primary\": \"120 50% 35%\", // Forest Green\n             \"--primary-foreground\": \"0 0% 100%\",\n             \"--secondary\": \"40 30% 80%\", // Light Brown/Beige\n             \"--secondary-foreground\": \"120 20% 10%\",\n             \"--muted\": \"110 15% 90%\",\n             \"--muted-foreground\": \"120 10% 45%\",\n             \"--accent\": \"90 60% 55%\", // Leaf Green\n             \"--accent-foreground\": \"120 20% 10%\",\n             \"--destructive\": \"0 84.2% 60.2%\",\n             \"--destructive-foreground\": \"0 0% 98%\",\n             \"--border\": \"110 10% 75%\",\n             \"--input\": \"110 10% 80%\",\n             \"--ring\": \"90 60% 55%\",\n             \"--chart-1\": \"120 60% 40%\",\n             \"--chart-2\": \"90 70% 50%\",\n             \"--chart-3\": \"40 40% 60%\",\n             \"--chart-4\": \"100 50% 70%\",\n             \"--chart-5\": \"80 65% 45%\",\n         },\n         dark: {\n             \"--background\": \"120 20% 8%\",\n             \"--foreground\": \"110 10% 94%\",\n             \"--card\": \"120 20% 12%\",\n             \"--card-foreground\": \"110 10% 94%\",\n             \"--popover\": \"120 20% 12%\",\n             \"--popover-foreground\": \"110 10% 94%\",\n             \"--primary\": \"120 60% 55%\", // Brighter Forest Green\n             \"--primary-foreground\": \"120 20% 8%\",\n             \"--secondary\": \"40 25% 20%\", // Dark Brown\n             \"--secondary-foreground\": \"110 10% 94%\",\n             \"--muted\": \"120 20% 15%\",\n             \"--muted-foreground\": \"110 10% 63.9%\",\n             \"--accent\": \"90 50% 65%\", // Brighter Leaf Green\n             \"--accent-foreground\": \"120 20% 8%\",\n             \"--destructive\": \"0 62.8% 30.6%\",\n             \"--destructive-foreground\": \"0 0% 98%\",\n             \"--border\": \"110 10% 25%\",\n             \"--input\": \"110 10% 30%\",\n             \"--ring\": \"90 50% 65%\",\n             \"--chart-1\": \"120 50% 50%\",\n             \"--chart-2\": \"90 60% 60%\",\n             \"--chart-3\": \"40 30% 40%\",\n             \"--chart-4\": \"100 40% 80%\",\n             \"--chart-5\": \"80 55% 60%\",\n         }\n    },\n    {\n         name: \"Mystic Scroll\",\n         id: \"scroll\",\n         light: {\n             \"--background\": \"35 40% 94%\", // Parchment\n             \"--foreground\": \"35 15% 20%\", // Dark Ink Brown\n             \"--card\": \"35 45% 90%\",\n             \"--card-foreground\": \"35 15% 20%\",\n             \"--popover\": \"35 45% 90%\",\n             \"--popover-foreground\": \"35 15% 20%\",\n             \"--primary\": \"50 60% 50%\", // Gold/Yellow Ochre\n             \"--primary-foreground\": \"35 15% 20%\",\n             \"--secondary\": \"0 40% 85%\", // Muted Red/Terracotta\n             \"--secondary-foreground\": \"35 15% 20%\",\n             \"--muted\": \"35 40% 92%\",\n             \"--muted-foreground\": \"35 10% 45%\",\n             \"--accent\": \"280 50% 60%\", // Purple/Violet\n             \"--accent-foreground\": \"0 0% 100%\",\n             \"--destructive\": \"0 84.2% 60.2%\",\n             \"--destructive-foreground\": \"0 0% 98%\",\n             \"--border\": \"35 15% 70%\",\n             \"--input\": \"35 15% 75%\",\n             \"--ring\": \"280 50% 60%\",\n             \"--chart-1\": \"50 70% 60%\",\n             \"--chart-2\": \"0 50% 70%\",\n             \"--chart-3\": \"280 60% 65%\",\n             \"--chart-4\": \"35 30% 50%\",\n             \"--chart-5\": \"240 40% 75%\",\n         },\n         dark: {\n             \"--background\": \"35 15% 12%\", // Dark Parchment/Brown\n             \"--foreground\": \"35 25% 92%\", // Light Ink Beige\n             \"--card\": \"35 15% 18%\",\n             \"--card-foreground\": \"35 25% 92%\",\n             \"--popover\": \"35 15% 18%\",\n             \"--popover-foreground\": \"35 25% 92%\",\n             \"--primary\": \"50 70% 70%\", // Brighter Gold\n             \"--primary-foreground\": \"35 15% 12%\",\n             \"--secondary\": \"0 30% 30%\", // Dark Terracotta\n             \"--secondary-foreground\": \"35 25% 92%\",\n             \"--muted\": \"35 15% 22%\",\n             \"--muted-foreground\": \"35 10% 63.9%\",\n             \"--accent\": \"280 60% 75%\", // Brighter Purple\n             \"--accent-foreground\": \"35 15% 12%\",\n             \"--destructive\": \"0 62.8% 30.6%\",\n             \"--destructive-foreground\": \"0 0% 98%\",\n             \"--border\": \"35 15% 35%\",\n             \"--input\": \"35 15% 40%\",\n             \"--ring\": \"280 60% 75%\",\n             \"--chart-1\": \"50 60% 65%\",\n             \"--chart-2\": \"0 40% 55%\",\n             \"--chart-3\": \"280 50% 70%\",\n             \"--chart-4\": \"35 20% 40%\",\n             \"--chart-5\": \"240 50% 80%\",\n         }\n    },\n    {\n         name: \"Nightshade\",\n         id: \"nightshade\",\n         light: { // Keep light mode less extreme, more like a twilight\n             \"--background\": \"240 10% 90%\",\n             \"--foreground\": \"240 20% 10%\",\n             \"--card\": \"240 15% 85%\",\n             \"--card-foreground\": \"240 20% 10%\",\n             \"--popover\": \"240 15% 85%\",\n             \"--popover-foreground\": \"240 20% 10%\",\n             \"--primary\": \"260 60% 55%\", // Deep Purple\n             \"--primary-foreground\": \"0 0% 100%\",\n             \"--secondary\": \"300 30% 75%\", // Muted Magenta/Pinkish\n             \"--secondary-foreground\": \"240 20% 10%\",\n             \"--muted\": \"240 15% 88%\",\n             \"--muted-foreground\": \"240 10% 45%\",\n             \"--accent\": \"150 50% 50%\", // Vibrant Teal/Green\n             \"--accent-foreground\": \"240 20% 10%\",\n             \"--destructive\": \"0 84.2% 60.2%\",\n             \"--destructive-foreground\": \"0 0% 98%\",\n             \"--border\": \"240 10% 70%\",\n             \"--input\": \"240 10% 75%\",\n             \"--ring\": \"150 50% 50%\",\n             \"--chart-1\": \"260 70% 60%\",\n             \"--chart-2\": \"300 40% 80%\",\n             \"--chart-3\": \"150 60% 55%\",\n             \"--chart-4\": \"240 30% 70%\",\n             \"--chart-5\": \"280 50% 65%\",\n         },\n         dark: {\n             \"--background\": \"240 20% 6%\", // Very Dark Blue/Black\n             \"--foreground\": \"240 10% 95%\", // Light Gray\n             \"--card\": \"240 20% 10%\",\n             \"--card-foreground\": \"240 10% 95%\",\n             \"--popover\": \"240 20% 10%\",\n             \"--popover-foreground\": \"240 10% 95%\",\n             \"--primary\": \"260 70% 70%\", // Brighter Deep Purple\n             \"--primary-foreground\": \"240 20% 6%\",\n             \"--secondary\": \"300 40% 25%\", // Dark Magenta\n             \"--secondary-foreground\": \"240 10% 95%\",\n             \"--muted\": \"240 20% 12%\",\n             \"--muted-foreground\": \"240 10% 63.9%\",\n             \"--accent\": \"150 60% 65%\", // Brighter Teal\n             \"--accent-foreground\": \"240 20% 6%\",\n             \"--destructive\": \"0 62.8% 30.6%\",\n             \"--destructive-foreground\": \"0 0% 98%\",\n             \"--border\": \"240 10% 20%\",\n             \"--input\": \"240 10% 25%\",\n             \"--ring\": \"150 60% 65%\",\n             \"--chart-1\": \"260 60% 65%\",\n             \"--chart-2\": \"300 30% 50%\",\n             \"--chart-3\": \"150 50% 70%\",\n             \"--chart-4\": \"240 20% 40%\",\n             \"--chart-5\": \"280 40% 60%\",\n         }\n    }\n];\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1724, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/context/GameContext.tsx"],"sourcesContent":["\n// src/context/GameContext.tsx\n\"use client\";\n\nimport type { ReactNode } from \"react\";\nimport React, { createContext, useContext, useReducer, Dispatch, useEffect, useCallback } from \"react\";\nimport type { GameState } from \"../types/game-types\";\nimport type { Action } from \"./game-actions\";\nimport { initialState } from \"./game-initial-state\";\nimport { gameReducer } from \"./game-reducer\";\nimport { THEMES } from \"../lib/themes\";\nimport { SAVED_ADVENTURES_KEY, THEME_ID_KEY, THEME_MODE_KEY, USER_API_KEY_KEY } from \"../lib/constants\";\nimport type { SavedAdventure } from \"../types/adventure-types\";\n// Firebase imports disabled\n// import { auth } from '../lib/firebase';\n// import type { User } from 'firebase/auth';\n// import { signInAnonymously } from \"firebase/auth\";\n// import { listenToSessionUpdates } from \"../services/multiplayer-service\";\n\n\nconst GameContext = createContext<{ state: GameState; dispatch: Dispatch<Action> } | undefined>(undefined);\n\nexport const GameProvider = ({ children }: React.PropsWithChildren<{}>) => {\n  const [state, dispatch] = useReducer(gameReducer, initialState);\n\n   const applyTheme = useCallback((themeId: string, isDark: boolean) => {\n        const theme = THEMES.find(t => t.id === themeId) || THEMES[0];\n        const colors = isDark ? theme.dark : theme.light;\n        const root = document.documentElement;\n        if (!root) return;\n        Object.entries(colors).forEach(([property, value]) => {\n            root.style.setProperty(property, value as string);\n        });\n        if (isDark) {\n            root.classList.add('dark');\n        } else {\n            root.classList.remove('dark');\n        }\n   }, []);\n\n    useEffect(() => {\n        console.log(\"GameProvider initializing...\");\n\n        // Load saved adventures from localStorage\n        try {\n            const savedData = localStorage.getItem(SAVED_ADVENTURES_KEY);\n            if (savedData) {\n                const loadedAdventures: SavedAdventure[] = JSON.parse(savedData);\n                if (Array.isArray(loadedAdventures)) {\n                    dispatch({ type: \"LOAD_SAVED_ADVENTURES\", payload: loadedAdventures });\n                } else {\n                    localStorage.removeItem(SAVED_ADVENTURES_KEY);\n                }\n            }\n        } catch (error) {\n            console.error(\"Failed to load saved adventures:\", error);\n            localStorage.removeItem(SAVED_ADVENTURES_KEY);\n        }\n\n        // Load theme and API key from localStorage\n        const savedThemeId = localStorage.getItem(THEME_ID_KEY) || initialState.selectedThemeId;\n        const savedMode = localStorage.getItem(THEME_MODE_KEY);\n        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n        const initialDarkMode = savedMode === 'dark' || (savedMode === null && prefersDark);\n        const savedUserApiKey = localStorage.getItem(USER_API_KEY_KEY);\n        \n        if (savedUserApiKey) {\n            dispatch({ type: 'SET_USER_API_KEY', payload: savedUserApiKey });\n        }\n        dispatch({ type: 'SET_THEME_ID', payload: savedThemeId });\n        dispatch({ type: 'SET_DARK_MODE', payload: initialDarkMode });\n\n        // Apply the loaded theme immediately\n        applyTheme(savedThemeId, initialDarkMode);\n        \n        // FIREBASE DISABLED\n        /*\n        // Setup Firebase anonymous auth listener\n        const unsubscribeAuth = auth.onAuthStateChanged(async (user: User | null) => {\n            if (user) {\n                console.log(\"GameProvider: Firebase Auth user signed in:\", user.uid);\n                dispatch({ type: 'SET_CURRENT_PLAYER_UID', payload: user.uid });\n            } else {\n                console.log(\"GameProvider: Firebase Auth user signed out or no user. Attempting anonymous sign-in.\");\n                try {\n                    const userCredential = await signInAnonymously(auth);\n                    console.log(\"GameProvider: Signed in anonymously:\", userCredential.user.uid);\n                    dispatch({ type: 'SET_CURRENT_PLAYER_UID', payload: userCredential.user.uid });\n                } catch (error) {\n                    console.error(\"GameProvider: Error signing in anonymously:\", error);\n                    dispatch({ type: 'SET_CURRENT_PLAYER_UID', payload: null });\n                }\n            }\n        });\n\n        // Cleanup auth listener on component unmount\n        return () => {\n            unsubscribeAuth();\n        };\n        */\n    }, [applyTheme]); // Only run this effect once on mount\n\n\n      useEffect(() => {\n         // Apply visual changes immediately regardless of game status\n         applyTheme(state.selectedThemeId, state.isDarkMode);\n         \n         // Persist to local storage\n         localStorage.setItem(THEME_ID_KEY, state.selectedThemeId);\n         localStorage.setItem(THEME_MODE_KEY, state.isDarkMode ? 'dark' : 'light');\n      }, [state.selectedThemeId, state.isDarkMode, applyTheme]);\n\n      useEffect(() => {\n        // Persist API key regardless of game status\n        if (state.userGoogleAiApiKey) {\n            localStorage.setItem(USER_API_KEY_KEY, state.userGoogleAiApiKey);\n        } else {\n            // Only remove if explicitly null (cleared), undefined might be initial load\n            if (state.userGoogleAiApiKey === null) {\n                 localStorage.removeItem(USER_API_KEY_KEY);\n            }\n        }\n      }, [state.userGoogleAiApiKey]);\n\n    // FIREBASE DISABLED - Removed Session Listener\n    /*\n    useEffect(() => {\n        let unsubscribeSession: (() => void) | undefined;\n\n        if (state.sessionId && (state.status === \"CoopLobby\" || state.status === \"CoopGameplay\")) {\n            console.log(`GameContext: Listening to session updates for sessionId: ${state.sessionId}`);\n            unsubscribeSession = listenToSessionUpdates(state.sessionId, (sessionData: FirestoreCoopSession | null) => {\n                if (sessionData) {\n                    console.log(\"GameContext: Firestore session data received:\", sessionData);\n                    dispatch({ type: \"SYNC_COOP_SESSION_STATE\", payload: sessionData });\n\n                    if (sessionData.status === 'playing' && state.status === 'CoopLobby') {\n                        dispatch({\n                            type: \"SET_ADVENTURE_SETTINGS\",\n                            payload: {\n                                ...sessionData.adventureSettings,\n                                adventureType: \"Coop\"\n                            }\n                        });\n                        dispatch({ type: \"SET_GAME_STATUS\", payload: \"CoopGameplay\" });\n                    }\n                } else {\n                    console.log(\"GameContext: Session data is null (deleted or error).\");\n                    if (state.status === \"CoopLobby\" || state.status === \"CoopGameplay\") {\n                         dispatch({ type: \"RESET_GAME\" });\n                    }\n                }\n            });\n        }\n        return () => {\n            if (unsubscribeSession) {\n                console.log(`GameContext: Unsubscribing from session updates for sessionId: ${state.sessionId}`);\n                unsubscribeSession();\n            }\n        };\n    }, [state.sessionId, state.status, dispatch]);\n    */\n\n\n   useEffect(() => {\n      const currentStageName = state.character?.skillTreeStage !== undefined && state.character?.skillTree\n          ? state.character.skillTree.stages[state.character.skillTreeStage]?.stageName ?? `Stage ${state.character.skillTreeStage}`\n          : \"Potential\";\n      const reputationString = state.character ? Object.entries(state.character.reputation).map(([f, s]) => `${f}: ${s}`).join(', ') || 'None' : 'N/A';\n      const relationshipString = state.character ? Object.entries(state.character.npcRelationships).map(([n, s]) => `${n}: ${s}`).join(', ') || 'None' : 'N/A';\n      const inventoryString = state.inventory.map(i => `${i.name}${i.quality ? ` (${i.quality})` : ''}`).join(', ') || 'Empty';\n      console.log(\"Game State Updated:\", {\n         status: state.status,\n         turn: state.turnCount,\n         character: state.character?.name,\n         level: state.character?.level,\n         xp: `${state.character?.xp}/${state.character?.xpToNextLevel}`,\n         reputation: reputationString,\n         relationships: relationshipString,\n         class: state.character?.class,\n         stage: `${currentStageName} (${state.character?.skillTreeStage ?? 0}/4)`,\n         health: `${state.character?.currentHealth}/${state.character?.maxHealth}`,\n         actionStamina: `${state.character?.currentStamina}/${state.character?.maxStamina}`,\n         mana: `${state.character?.currentMana}/${state.character?.maxMana}`,\n         adventureId: state.currentAdventureId,\n         settings: state.adventureSettings,\n         inventory: inventoryString,\n         theme: `${state.selectedThemeId} (${state.isDarkMode ? 'Dark' : 'Light'})`,\n         apiKeySet: !!state.userGoogleAiApiKey,\n         storyLogLength: state.storyLog.length,\n         isGeneratingSkillTree: state.isGeneratingSkillTree,\n         sessionId: state.sessionId,\n         players: state.players,\n         currentPlayerUid: state.currentPlayerUid,\n         isHost: state.isHost,\n      });\n   }, [state]);\n\n\n  return (\n    <GameContext.Provider value={{ state, dispatch }}>\n      {children}\n    </GameContext.Provider>\n  );\n};\n\nexport const useGame = () => {\n  const context = useContext(GameContext);\n  if (context === undefined) {\n    throw new Error(\"useGame must be used within a GameProvider\");\n  }\n  return context;\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1983, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/hooks/use-toast.ts"],"sourcesContent":["\"use client\"\n\n// src/hooks/use-toast.ts\nimport * as React from \"react\"\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"../components/ui/toast\"\n\nconst TOAST_LIMIT = 3 // Allow up to 3 toasts visible at once\nconst TOAST_REMOVE_DELAY = 5000 // Auto-remove after 5 seconds\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\n// Generates a unique ID for each toast\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\n// Defines the possible actions that can be dispatched to the toast reducer\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast> // Allows updating parts of a toast\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"] // Optional ID to dismiss a specific toast, otherwise dismiss all\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"] // Optional ID to remove a specific toast, otherwise remove all\n    }\n\n// Defines the shape of the toast state\ninterface State {\n  toasts: ToasterToast[]\n}\n\n// Stores timeout IDs for automatic removal\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\n// Schedules a toast for removal after a delay\nconst addToRemoveQueue = (toastId: string) => {\n  // If a timeout already exists for this toast, do nothing\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  // Set a timeout to dispatch the REMOVE_TOAST action\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId); // Remove the timeout ID from the map\n    // Dispatch action to remove the toast from state\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  // Store the timeout ID\n  toastTimeouts.set(toastId, timeout)\n}\n\n// The reducer function handles state updates based on dispatched actions\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    // Add a new toast to the beginning of the array, respecting the limit\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    // Update an existing toast by its ID\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    // Mark toast(s) as not open and schedule for removal\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // Schedule the specific toast or all toasts for removal\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      // Update the state to mark the toast(s) as closed\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false, // Mark as not open\n              }\n            : t\n        ),\n      }\n    }\n    // Remove a specific toast or all toasts immediately\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        // Remove all toasts\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      // Remove a specific toast by filtering\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n    default:\n      return state;\n  }\n}\n\n// Array to hold listener functions that will be called on state change\nconst listeners: Array<(state: State) => void> = []\n\n// The single source of truth for the toast state\nlet memoryState: State = { toasts: [] }\n\n// Dispatches an action to the reducer and notifies listeners\nfunction dispatch(action: Action) {\n  // console.log(\"Dispatching toast action:\", action.type, action); // Optional logging\n  memoryState = reducer(memoryState, action)\n  // Call all registered listener functions with the new state\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\n// The type for the toast function argument (omits 'id' as it's generated)\ntype Toast = Omit<ToasterToast, \"id\">\n\n// Function to create and display a new toast\nfunction toast({ ...props }: Toast) {\n  const id = genId() // Generate a unique ID\n\n  // Function to update this specific toast\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n\n  // Function to dismiss this specific toast\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  // Dispatch the action to add the new toast to the state\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true, // Toasts start open\n      // Callback for when the toast's open state changes (e.g., closed by user)\n      onOpenChange: (open) => {\n        if (!open) dismiss() // If closed manually, dismiss it\n      },\n    },\n  })\n\n  // Return methods to control the toast\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\n// The custom hook to access toast state and actions\nfunction useToast() {\n  // Use React state to trigger re-renders when the memoryState changes\n  const [state, setState] = React.useState<State>(memoryState)\n\n  // Register and unregister the setState function as a listener\n  React.useEffect(() => {\n    listeners.push(setState); // Add listener on mount\n    return () => {\n      // Remove listener on unmount\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state]) // Re-run effect if state identity changes (shouldn't normally happen)\n\n  // Return the current state and the toast/dismiss functions\n  return {\n    ...state, // Spread the current toasts array\n    toast, // Function to create new toasts\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }), // Function to dismiss toasts\n  }\n}\n\nexport { useToast, toast }"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2185, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/lib/utils.ts"],"sourcesContent":["\nimport { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\nimport type { ItemQuality } from \"../types/inventory-types\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n// Helper to get quality color\nexport const getQualityColor = (quality: ItemQuality | undefined): string => {\n    switch (quality) {\n        case \"Poor\": return \"text-gray-500 dark:text-gray-400\";\n        case \"Common\": return \"text-foreground\";\n        case \"Uncommon\": return \"text-green-600 dark:text-green-400\";\n        case \"Rare\": return \"text-blue-600 dark:text-blue-400\";\n        case \"Epic\": return \"text-purple-600 dark:text-purple-400\";\n        case \"Legendary\": return \"text-orange-500 dark:text-orange-400\";\n        default: return \"text-muted-foreground\";\n    }\n};\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAGO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,CAAA,GAAA,8JAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,wIAAA,CAAA,OAAI,AAAD,EAAE;AACtB;AAGO,MAAM,kBAAkB,CAAC;IAC5B,OAAQ;QACJ,KAAK;YAAQ,OAAO;QACpB,KAAK;YAAU,OAAO;QACtB,KAAK;YAAY,OAAO;QACxB,KAAK;YAAQ,OAAO;QACpB,KAAK;YAAQ,OAAO;QACpB,KAAK;YAAa,OAAO;QACzB;YAAS,OAAO;IACpB;AACJ","debugId":null}},
    {"offset": {"line": 2223, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/components/ui/toast.tsx"],"sourcesContent":["\"use client\"\n\n// src/components/ui/toast.tsx\nimport * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"../../lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      // Changed default positioning to bottom-0 for mobile\n      \"fixed bottom-0 z-[100] flex max-h-screen w-full flex-col p-4 sm:bottom-0 sm:right-0 sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-bottom-full data-[state=open]:sm:slide-in-from-bottom-full\", // Adjusted animation for bottom positioning\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}"],"names":[],"mappings":";;;;;;;;;;AAEA,8BAA8B;AAC9B;AACA;AACA;AACA;AAEA;AARA;;;;;;;AAUA,MAAM,gBAAgB,oKAAA,CAAA,WAAwB;AAE9C,MAAM,8BAAgB,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAGnC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oKAAA,CAAA,WAAwB;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,qDAAqD;QACrD,oHACA;QAED,GAAG,KAAK;;;;;;;AAGb,cAAc,WAAW,GAAG,oKAAA,CAAA,WAAwB,CAAC,WAAW;AAEhE,MAAM,gBAAgB,CAAA,GAAA,mKAAA,CAAA,MAAG,AAAD,EACtB,gmBACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,MAAM,sBAAQ,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAI3B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAO,EAAE;IACnC,qBACE,6LAAC,oKAAA,CAAA,OAAoB;QACnB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;;AACA,MAAM,WAAW,GAAG,oKAAA,CAAA,OAAoB,CAAC,WAAW;AAEpD,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oKAAA,CAAA,SAAsB;QACrB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,sgBACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,oKAAA,CAAA,SAAsB,CAAC,WAAW;AAE5D,MAAM,2BAAa,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oKAAA,CAAA,QAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,yVACA;QAEF,eAAY;QACX,GAAG,KAAK;kBAET,cAAA,6LAAC,+LAAA,CAAA,IAAC;YAAC,WAAU;;;;;;;;;;;;AAGjB,WAAW,WAAW,GAAG,oKAAA,CAAA,QAAqB,CAAC,WAAW;AAE1D,MAAM,2BAAa,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oKAAA,CAAA,QAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,yBAAyB;QACtC,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG,oKAAA,CAAA,QAAqB,CAAC,WAAW;AAE1D,MAAM,iCAAmB,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,SAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oKAAA,CAAA,cAA2B;QAC1B,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,sBAAsB;QACnC,GAAG,KAAK;;;;;;;AAGb,iBAAiB,WAAW,GAAG,oKAAA,CAAA,cAA2B,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 2360, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/components/ui/toaster.tsx"],"sourcesContent":["\"use client\"\n\n// src/components/ui/toaster.tsx\nimport { useToast } from \"../../hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"./toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      {/* Updated viewport positioning */}\n      <ToastViewport className=\"fixed bottom-0 z-[100] flex max-h-screen w-full flex-col p-4 sm:bottom-0 sm:right-0 sm:flex-col md:max-w-[420px]\" />\n    </ToastProvider>\n  )\n}"],"names":[],"mappings":";;;;AAEA,gCAAgC;AAChC;AACA;;;AAJA;;;AAaO,SAAS;;IACd,MAAM,EAAE,MAAM,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,WAAQ,AAAD;IAE1B,qBACE,6LAAC,oIAAA,CAAA,gBAAa;;YACX,OAAO,GAAG,CAAC,SAAU,EAAE,EAAE,EAAE,KAAK,EAAE,WAAW,EAAE,MAAM,EAAE,GAAG,OAAO;gBAChE,qBACE,6LAAC,oIAAA,CAAA,QAAK;oBAAW,GAAG,KAAK;;sCACvB,6LAAC;4BAAI,WAAU;;gCACZ,uBAAS,6LAAC,oIAAA,CAAA,aAAU;8CAAE;;;;;;gCACtB,6BACC,6LAAC,oIAAA,CAAA,mBAAgB;8CAAE;;;;;;;;;;;;wBAGtB;sCACD,6LAAC,oIAAA,CAAA,aAAU;;;;;;mBARD;;;;;YAWhB;0BAEA,6LAAC,oIAAA,CAAA,gBAAa;gBAAC,WAAU;;;;;;;;;;;;AAG/B;GAvBgB;;QACK,+HAAA,CAAA,WAAQ;;;KADb","debugId":null}}]
}