{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/ai/ai-instance.ts"],"sourcesContent":["// src/ai/ai-instance.ts\nimport { GoogleGenAI } from \"@google/genai\";\n\n// Safely access process.env\nconst safeProcess = typeof process !== 'undefined' ? process : { env: {} as Record<string, string | undefined> };\n\n// Use a dummy key if not present to prevent initialization crash. \n// Real requests will fail if a valid key isn't provided via getClient later or if this env var is invalid.\nconst apiKey = safeProcess.env.API_KEY || safeProcess.env.GOOGLE_GENAI_API_KEY || 'DUMMY_KEY_FOR_INIT';\n\n// Initialize the default client\nexport const aiClient = new GoogleGenAI({ apiKey });\n\n/**\n * Gets a GenAI client instance. \n * If a user API key is provided, returns a new instance using that key.\n * Otherwise returns the default instance using the environment key.\n * @param userApiKey - The user-provided Google AI API key.\n * @returns A GoogleGenAI client instance.\n */\nexport function getClient(userApiKey?: string | null): GoogleGenAI {\n    if (userApiKey) {\n        return new GoogleGenAI({ apiKey: userApiKey });\n    }\n    return aiClient;\n}"],"names":[],"mappings":"AAAA,wBAAwB;;;;;AACxB;;AAEA,4BAA4B;AAC5B,MAAM,cAAc,OAAO,YAAY,cAAc,UAAU;IAAE,KAAK,CAAC;AAAwC;AAE/G,mEAAmE;AACnE,2GAA2G;AAC3G,MAAM,SAAS,YAAY,GAAG,CAAC,OAAO,IAAI,YAAY,GAAG,CAAC,oBAAoB,IAAI;AAG3E,MAAM,WAAW,IAAI,2JAAA,CAAA,cAAW,CAAC;IAAE;AAAO;AAS1C,SAAS,UAAU,UAA0B;IAChD,IAAI,YAAY;QACZ,OAAO,IAAI,2JAAA,CAAA,cAAW,CAAC;YAAE,QAAQ;QAAW;IAChD;IACA,OAAO;AACX","debugId":null}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/ai/flows/generate-character-description.ts"],"sourcesContent":["/**\n * @fileOverview An AI agent that generates a detailed character description.\n */\n\nimport { getClient } from '../ai-instance';\nimport { Type, Schema } from \"@google/genai\";\n\nexport interface GenerateCharacterDescriptionInput {\n  characterDescription: string;\n  isImmersedMode?: boolean;\n  universeName?: string;\n  playerCharacterConcept?: string;\n  userApiKey?: string | null;\n}\n\nexport interface GenerateCharacterDescriptionOutput {\n  detailedDescription: string;\n  inferredClass: string;\n  inferredTraits: string[];\n  inferredKnowledge: string[];\n  inferredBackground: string;\n}\n\nconst responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n        detailedDescription: { type: Type.STRING },\n        inferredClass: { type: Type.STRING },\n        inferredTraits: { type: Type.ARRAY, items: { type: Type.STRING } },\n        inferredKnowledge: { type: Type.ARRAY, items: { type: Type.STRING } },\n        inferredBackground: { type: Type.STRING }\n    },\n    required: [\"detailedDescription\", \"inferredClass\", \"inferredTraits\", \"inferredKnowledge\", \"inferredBackground\"]\n};\n\nexport async function generateCharacterDescription(\n  input: GenerateCharacterDescriptionInput\n): Promise<GenerateCharacterDescriptionOutput> {\n  \n  let promptContext = \"\";\n  if (input.isImmersedMode) {\n      promptContext = `\n**Context: IMMERSED ADVENTURE MODE**\n* Universe: ${input.universeName}\n* Character Concept: ${input.playerCharacterConcept}\n* User Description: ${input.characterDescription}\n\nTask:\n1. Elaborate on the character within the ${input.universeName} universe.\n2. Infer role/archetype (inferredClass).\n3. Infer traits, knowledge/skills, and background fitting the lore.\n`;\n  } else {\n      promptContext = `\n**Context: STANDARD ADVENTURE MODE**\n* User Description: ${input.characterDescription}\n\nTask:\n1. Elaborate on the description.\n2. Infer Class from [Warrior, Mage, Rogue, Scholar, Hunter, Healer, Bard, Artisan, Noble, Commoner, Adventurer].\n3. Infer traits, knowledge, and background.\n`;\n  }\n\n  const prompt = `You are a fantasy/sci-fi story writer and character profiler.\n${promptContext}\n\nOutput JSON matching the schema.\n`;\n\n  try {\n      const client = getClient(input.userApiKey);\n      const response = await client.models.generateContent({\n          model: 'gemini-2.0-flash',\n          contents: prompt,\n          config: {\n              responseMimeType: \"application/json\",\n              responseSchema: responseSchema,\n          }\n      });\n\n      const text = response.text;\n      if (!text) throw new Error(\"No text returned from AI\");\n      const output = JSON.parse(text) as GenerateCharacterDescriptionOutput;\n      \n      // Sanitization\n      output.inferredTraits = Array.isArray(output.inferredTraits) ? output.inferredTraits : [];\n      output.inferredKnowledge = Array.isArray(output.inferredKnowledge) ? output.inferredKnowledge : [];\n      \n      return output;\n\n  } catch (error) {\n      console.error(\"AI Character Generation Error:\", error);\n      return {\n          detailedDescription: `AI generation failed for: \"${input.characterDescription}\".`,\n          inferredClass: input.isImmersedMode ? \"Immersed Protagonist\" : \"Adventurer\",\n          inferredTraits: [],\n          inferredKnowledge: [],\n          inferredBackground: \"Unknown\",\n      };\n  }\n}"],"names":[],"mappings":"AAAA;;CAEC;;;AAED;AACA;;;AAkBA,MAAM,iBAAyB;IAC3B,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;IACjB,YAAY;QACR,qBAAqB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;QAAC;QACzC,eAAe;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;QAAC;QACnC,gBAAgB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;YAAE,OAAO;gBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAC;QAAE;QACjE,mBAAmB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;YAAE,OAAO;gBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAC;QAAE;QACpE,oBAAoB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;QAAC;IAC5C;IACA,UAAU;QAAC;QAAuB;QAAiB;QAAkB;QAAqB;KAAqB;AACnH;AAEO,eAAe,6BACpB,KAAwC;IAGxC,IAAI,gBAAgB;IACpB,IAAI,MAAM,cAAc,EAAE;QACtB,gBAAgB,CAAC;;YAEX,EAAE,MAAM,YAAY,CAAC;qBACZ,EAAE,MAAM,sBAAsB,CAAC;oBAChC,EAAE,MAAM,oBAAoB,CAAC;;;yCAGR,EAAE,MAAM,YAAY,CAAC;;;AAG9D,CAAC;IACC,OAAO;QACH,gBAAgB,CAAC;;oBAEH,EAAE,MAAM,oBAAoB,CAAC;;;;;;AAMjD,CAAC;IACC;IAEA,MAAM,SAAS,CAAC;AAClB,EAAE,cAAc;;;AAGhB,CAAC;IAEC,IAAI;QACA,MAAM,SAAS,CAAA,GAAA,2HAAA,CAAA,YAAS,AAAD,EAAE,MAAM,UAAU;QACzC,MAAM,WAAW,MAAM,OAAO,MAAM,CAAC,eAAe,CAAC;YACjD,OAAO;YACP,UAAU;YACV,QAAQ;gBACJ,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAEA,MAAM,OAAO,SAAS,IAAI;QAC1B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAC3B,MAAM,SAAS,KAAK,KAAK,CAAC;QAE1B,eAAe;QACf,OAAO,cAAc,GAAG,MAAM,OAAO,CAAC,OAAO,cAAc,IAAI,OAAO,cAAc,GAAG,EAAE;QACzF,OAAO,iBAAiB,GAAG,MAAM,OAAO,CAAC,OAAO,iBAAiB,IAAI,OAAO,iBAAiB,GAAG,EAAE;QAElG,OAAO;IAEX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO;YACH,qBAAqB,CAAC,2BAA2B,EAAE,MAAM,oBAAoB,CAAC,EAAE,CAAC;YACjF,eAAe,MAAM,cAAc,GAAG,yBAAyB;YAC/D,gBAAgB,EAAE;YAClB,mBAAmB,EAAE;YACrB,oBAAoB;QACxB;IACJ;AACF","debugId":null}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/ai/flows/suggest-existing-characters.ts"],"sourcesContent":["/**\n * @fileOverview An AI agent that suggests existing character names.\n */\n\nimport { getClient } from '../ai-instance';\nimport { Type, Schema } from \"@google/genai\";\n\nexport interface SuggestExistingCharactersInput {\n  universeName: string;\n  userApiKey?: string | null;\n}\n\nexport interface SuggestExistingCharactersOutput {\n  suggestedNames: string[];\n}\n\nconst responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n        suggestedNames: { type: Type.ARRAY, items: { type: Type.STRING } }\n    },\n    required: [\"suggestedNames\"]\n};\n\nexport async function suggestExistingCharacters(input: SuggestExistingCharactersInput): Promise<SuggestExistingCharactersOutput> {\n  const prompt = `Suggest 3 to 5 well-known existing characters from the universe \"${input.universeName}\" suitable for a player character. Return only a JSON object with 'suggestedNames' array.`;\n\n  try {\n      const client = getClient(input.userApiKey);\n      const response = await client.models.generateContent({\n          model: 'gemini-2.0-flash',\n          contents: prompt,\n          config: {\n              responseMimeType: \"application/json\",\n              responseSchema: responseSchema,\n          }\n      });\n\n      const text = response.text;\n      if (!text) throw new Error(\"No text\");\n      return JSON.parse(text);\n  } catch (e) {\n      console.error(\"AI Suggestion Error:\", e);\n      return { suggestedNames: [\"Hero\", \"Villain\", \"Sidekick\"] };\n  }\n}"],"names":[],"mappings":"AAAA;;CAEC;;;AAED;AACA;;;AAWA,MAAM,iBAAyB;IAC3B,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;IACjB,YAAY;QACR,gBAAgB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;YAAE,OAAO;gBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAC;QAAE;IACrE;IACA,UAAU;QAAC;KAAiB;AAChC;AAEO,eAAe,0BAA0B,KAAqC;IACnF,MAAM,SAAS,CAAC,iEAAiE,EAAE,MAAM,YAAY,CAAC,yFAAyF,CAAC;IAEhM,IAAI;QACA,MAAM,SAAS,CAAA,GAAA,2HAAA,CAAA,YAAS,AAAD,EAAE,MAAM,UAAU;QACzC,MAAM,WAAW,MAAM,OAAO,MAAM,CAAC,eAAe,CAAC;YACjD,OAAO;YACP,UAAU;YACV,QAAQ;gBACJ,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAEA,MAAM,OAAO,SAAS,IAAI;QAC1B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAC3B,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YAAE,gBAAgB;gBAAC;gBAAQ;gBAAW;aAAW;QAAC;IAC7D;AACF","debugId":null}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/ai/flows/suggest-original-character-concepts.ts"],"sourcesContent":["/**\n * @fileOverview An AI agent that suggests original character concepts.\n */\n\nimport { getClient } from '../ai-instance';\nimport { Type, Schema } from \"@google/genai\";\n\nexport interface SuggestOriginalCharacterConceptsInput {\n  universeName: string;\n  userApiKey?: string | null;\n}\n\nexport interface SuggestOriginalCharacterConceptsOutput {\n  suggestedConcepts: string[];\n}\n\nconst responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n        suggestedConcepts: { type: Type.ARRAY, items: { type: Type.STRING } }\n    },\n    required: [\"suggestedConcepts\"]\n};\n\nexport async function suggestOriginalCharacterConcepts(input: SuggestOriginalCharacterConceptsInput): Promise<SuggestOriginalCharacterConceptsOutput> {\n  const prompt = `Suggest 3 to 5 creative ORIGINAL character concepts for the universe \"${input.universeName}\". Brief phrases. Return only JSON object with 'suggestedConcepts' array.`;\n\n  try {\n      const client = getClient(input.userApiKey);\n      const response = await client.models.generateContent({\n          model: 'gemini-2.0-flash',\n          contents: prompt,\n          config: {\n              responseMimeType: \"application/json\",\n              responseSchema: responseSchema,\n          }\n      });\n\n      const text = response.text;\n      if (!text) throw new Error(\"No text\");\n      return JSON.parse(text);\n  } catch (e) {\n      console.error(\"AI Suggestion Error:\", e);\n      return { suggestedConcepts: [\"A wanderer\", \"A local merchant\", \"A lost soldier\"] };\n  }\n}"],"names":[],"mappings":"AAAA;;CAEC;;;AAED;AACA;;;AAWA,MAAM,iBAAyB;IAC3B,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;IACjB,YAAY;QACR,mBAAmB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;YAAE,OAAO;gBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAC;QAAE;IACxE;IACA,UAAU;QAAC;KAAoB;AACnC;AAEO,eAAe,iCAAiC,KAA4C;IACjG,MAAM,SAAS,CAAC,sEAAsE,EAAE,MAAM,YAAY,CAAC,yEAAyE,CAAC;IAErL,IAAI;QACA,MAAM,SAAS,CAAA,GAAA,2HAAA,CAAA,YAAS,AAAD,EAAE,MAAM,UAAU;QACzC,MAAM,WAAW,MAAM,OAAO,MAAM,CAAC,eAAe,CAAC;YACjD,OAAO;YACP,UAAU;YACV,QAAQ;gBACJ,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAEA,MAAM,OAAO,SAAS,IAAI;QAC1B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAC3B,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YAAE,mBAAmB;gBAAC;gBAAc;gBAAoB;aAAiB;QAAC;IACrF;AACF","debugId":null}},
    {"offset": {"line": 254, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/ai/flows/narrate-adventure.ts"],"sourcesContent":["/**\n * @fileOverview An AI agent that narrates the story of a text adventure game.\n */\nimport { getClient } from '../ai-instance';\nimport { Type, Schema } from \"@google/genai\";\nimport type { CharacterStats } from '../../types/character-types';\nimport type { AdventureSettings } from '../../types/adventure-types';\n\nexport interface NarrateAdventureInput {\n  character: any; // Using any for simplicity in types here, effectively matches schema\n  playerChoice: string;\n  gameState: string;\n  previousNarration?: string;\n  adventureSettings: AdventureSettings;\n  turnCount: number;\n  userApiKey?: string | null;\n}\n\nexport interface NarrateAdventureOutput {\n  narration: string;\n  updatedGameState: string;\n  updatedStats?: Partial<CharacterStats>;\n  updatedTraits?: string[];\n  updatedKnowledge?: string[];\n  progressedToStage?: number;\n  healthChange?: number;\n  staminaChange?: number;\n  manaChange?: number;\n  xpGained?: number;\n  reputationChange?: { faction: string; change: number };\n  npcRelationshipChange?: { npcName: string; change: number };\n  suggestedClassChange?: string;\n  gainedSkill?: { name: string; description: string; type?: string; manaCost?: number; staminaCost?: number };\n  branchingChoices: { text: string; consequenceHint?: string }[];\n  dynamicEventTriggered?: string;\n  isCharacterDefeated?: boolean;\n}\n\nconst responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n        narration: { type: Type.STRING },\n        updatedGameState: { type: Type.STRING },\n        updatedStats: { \n            type: Type.OBJECT,\n            properties: {\n                strength: { type: Type.NUMBER },\n                stamina: { type: Type.NUMBER },\n                wisdom: { type: Type.NUMBER },\n            },\n            nullable: true\n        },\n        updatedTraits: { type: Type.ARRAY, items: { type: Type.STRING }, nullable: true },\n        updatedKnowledge: { type: Type.ARRAY, items: { type: Type.STRING }, nullable: true },\n        progressedToStage: { type: Type.NUMBER, nullable: true },\n        healthChange: { type: Type.NUMBER, nullable: true },\n        staminaChange: { type: Type.NUMBER, nullable: true },\n        manaChange: { type: Type.NUMBER, nullable: true },\n        xpGained: { type: Type.NUMBER, nullable: true },\n        reputationChange: {\n            type: Type.OBJECT,\n            properties: { faction: { type: Type.STRING }, change: { type: Type.NUMBER } },\n            nullable: true\n        },\n        npcRelationshipChange: {\n            type: Type.OBJECT,\n            properties: { npcName: { type: Type.STRING }, change: { type: Type.NUMBER } },\n            nullable: true\n        },\n        suggestedClassChange: { type: Type.STRING, nullable: true },\n        gainedSkill: {\n            type: Type.OBJECT,\n            properties: {\n                name: { type: Type.STRING },\n                description: { type: Type.STRING },\n                type: { type: Type.STRING },\n                manaCost: { type: Type.NUMBER },\n                staminaCost: { type: Type.NUMBER }\n            },\n            nullable: true\n        },\n        branchingChoices: {\n            type: Type.ARRAY,\n            items: {\n                type: Type.OBJECT,\n                properties: { text: { type: Type.STRING }, consequenceHint: { type: Type.STRING } },\n                required: [\"text\"]\n            }\n        },\n        dynamicEventTriggered: { type: Type.STRING, nullable: true },\n        isCharacterDefeated: { type: Type.BOOLEAN, nullable: true }\n    },\n    required: [\"narration\", \"updatedGameState\", \"branchingChoices\"]\n};\n\nexport async function narrateAdventure(input: NarrateAdventureInput): Promise<NarrateAdventureOutput> {\n  if (input.character.class === 'admin000') {\n    return {\n        narration: `Developer command \"${input.playerChoice}\" processed.`,\n        updatedGameState: input.gameState,\n        branchingChoices: [\n            { text: \"Continue.\" }, { text: \"Inspect.\" }, { text: \"Status.\" }, { text: \"Chaos.\" }\n        ]\n    };\n  }\n\n  const { character, adventureSettings, turnCount } = input;\n  const isCustom = adventureSettings.adventureType === \"Custom\";\n  const isImmersed = adventureSettings.adventureType === \"Immersed\";\n  const isRandomized = adventureSettings.adventureType === \"Randomized\";\n\n  let adventureContext = \"\";\n  if (isCustom) {\n      adventureContext = `\n* World: ${adventureSettings.worldType}\n* Main Quest: ${adventureSettings.mainQuestline}\n* Genre: ${adventureSettings.genreTheme}\n* Tone: ${adventureSettings.dominantTone}\n      `;\n  } else if (isImmersed) {\n      adventureContext = `\n* Universe: ${adventureSettings.universeName}\n* Character Concept: ${adventureSettings.playerCharacterConcept}\n**INSTRUCTION:** Adhere strictly to universe lore.\n      `;\n  } else if (isRandomized) {\n      adventureContext = `**INSTRUCTION:** Establish a unique setting based on character traits.`;\n  }\n\n  const prompt = `\nYou are a creative Game Master AI for \"Endless Tales\". Narrate the next segment.\n\n**Character:**\nName: ${character.name}\nClass: ${character.class}\nStats: STR ${character.stats.strength}, STA ${character.stats.stamina}, WIS ${character.stats.wisdom}\nHealth: ${character.currentHealth}/${character.maxHealth}\nDescription: ${character.aiGeneratedDescription || character.description}\n\n**Context:**\nTurn: ${turnCount}\nDifficulty: ${adventureSettings.difficulty}\n${adventureContext}\n\n**Previous Narration:** ${input.previousNarration || \"None\"}\n**Current Game State:** ${input.gameState}\n\n**Action:** ${input.playerChoice}\n\n**Task:**\n1. Narrate the outcome.\n2. Update game state (include Turn: ${turnCount + 1}).\n3. Provide exactly 4 branching choices.\n4. Calculate resource changes (health, stamina, mana) if applicable.\n5. If character HP <= 0, set isCharacterDefeated: true.\n\nOutput JSON.\n`;\n\n  try {\n      const client = getClient(input.userApiKey);\n      const response = await client.models.generateContent({\n          model: 'gemini-2.0-flash',\n          contents: prompt,\n          config: {\n              responseMimeType: \"application/json\",\n              responseSchema: responseSchema,\n          }\n      });\n\n      const text = response.text;\n      if (!text) throw new Error(\"No text returned from AI\");\n      const output = JSON.parse(text) as NarrateAdventureOutput;\n      \n      // Force correct branching choice count if AI fails\n      if (!output.branchingChoices || output.branchingChoices.length !== 4) {\n          output.branchingChoices = [\n            { text: \"Look around.\" }, { text: \"Think carefully.\" },\n            { text: \"Check inventory.\" }, { text: \"Wait.\" }\n          ];\n      }\n      \n      return output;\n\n  } catch (error: any) {\n      console.error(\"AI Narration Error:\", error);\n      return {\n          narration: `The Narrator stumbled. (AI Error: ${error.message}). Please retry.`,\n          updatedGameState: input.gameState,\n          branchingChoices: [\n            { text: \"Look around.\" }, { text: \"Think carefully.\" },\n            { text: \"Check inventory.\" }, { text: \"Wait.\" }\n          ]\n      };\n  }\n}"],"names":[],"mappings":"AAAA;;CAEC;;;AACD;AACA;;;AAkCA,MAAM,iBAAyB;IAC3B,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;IACjB,YAAY;QACR,WAAW;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;QAAC;QAC/B,kBAAkB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;QAAC;QACtC,cAAc;YACV,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YACjB,YAAY;gBACR,UAAU;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAC9B,SAAS;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAC7B,QAAQ;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;YAChC;YACA,UAAU;QACd;QACA,eAAe;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;YAAE,OAAO;gBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAC;YAAG,UAAU;QAAK;QAChF,kBAAkB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;YAAE,OAAO;gBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAC;YAAG,UAAU;QAAK;QACnF,mBAAmB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAE,UAAU;QAAK;QACvD,cAAc;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAE,UAAU;QAAK;QAClD,eAAe;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAE,UAAU;QAAK;QACnD,YAAY;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAE,UAAU;QAAK;QAChD,UAAU;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAE,UAAU;QAAK;QAC9C,kBAAkB;YACd,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YACjB,YAAY;gBAAE,SAAS;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAAG,QAAQ;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;YAAE;YAC5E,UAAU;QACd;QACA,uBAAuB;YACnB,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YACjB,YAAY;gBAAE,SAAS;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAAG,QAAQ;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;YAAE;YAC5E,UAAU;QACd;QACA,sBAAsB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAE,UAAU;QAAK;QAC1D,aAAa;YACT,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YACjB,YAAY;gBACR,MAAM;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAC1B,aAAa;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBACjC,MAAM;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAC1B,UAAU;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAC9B,aAAa;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;YACrC;YACA,UAAU;QACd;QACA,kBAAkB;YACd,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;YAChB,OAAO;gBACH,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBACjB,YAAY;oBAAE,MAAM;wBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;oBAAC;oBAAG,iBAAiB;wBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;oBAAC;gBAAE;gBAClF,UAAU;oBAAC;iBAAO;YACtB;QACJ;QACA,uBAAuB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAE,UAAU;QAAK;QAC3D,qBAAqB;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,OAAO;YAAE,UAAU;QAAK;IAC9D;IACA,UAAU;QAAC;QAAa;QAAoB;KAAmB;AACnE;AAEO,eAAe,iBAAiB,KAA4B;IACjE,IAAI,MAAM,SAAS,CAAC,KAAK,KAAK,YAAY;QACxC,OAAO;YACH,WAAW,CAAC,mBAAmB,EAAE,MAAM,YAAY,CAAC,YAAY,CAAC;YACjE,kBAAkB,MAAM,SAAS;YACjC,kBAAkB;gBACd;oBAAE,MAAM;gBAAY;gBAAG;oBAAE,MAAM;gBAAW;gBAAG;oBAAE,MAAM;gBAAU;gBAAG;oBAAE,MAAM;gBAAS;aACtF;QACL;IACF;IAEA,MAAM,EAAE,SAAS,EAAE,iBAAiB,EAAE,SAAS,EAAE,GAAG;IACpD,MAAM,WAAW,kBAAkB,aAAa,KAAK;IACrD,MAAM,aAAa,kBAAkB,aAAa,KAAK;IACvD,MAAM,eAAe,kBAAkB,aAAa,KAAK;IAEzD,IAAI,mBAAmB;IACvB,IAAI,UAAU;QACV,mBAAmB,CAAC;SACjB,EAAE,kBAAkB,SAAS,CAAC;cACzB,EAAE,kBAAkB,aAAa,CAAC;SACvC,EAAE,kBAAkB,UAAU,CAAC;QAChC,EAAE,kBAAkB,YAAY,CAAC;MACnC,CAAC;IACL,OAAO,IAAI,YAAY;QACnB,mBAAmB,CAAC;YACd,EAAE,kBAAkB,YAAY,CAAC;qBACxB,EAAE,kBAAkB,sBAAsB,CAAC;;MAE1D,CAAC;IACL,OAAO,IAAI,cAAc;QACrB,mBAAmB,CAAC,sEAAsE,CAAC;IAC/F;IAEA,MAAM,SAAS,CAAC;;;;MAIZ,EAAE,UAAU,IAAI,CAAC;OAChB,EAAE,UAAU,KAAK,CAAC;WACd,EAAE,UAAU,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,UAAU,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,UAAU,KAAK,CAAC,MAAM,CAAC;QAC7F,EAAE,UAAU,aAAa,CAAC,CAAC,EAAE,UAAU,SAAS,CAAC;aAC5C,EAAE,UAAU,sBAAsB,IAAI,UAAU,WAAW,CAAC;;;MAGnE,EAAE,UAAU;YACN,EAAE,kBAAkB,UAAU,CAAC;AAC3C,EAAE,iBAAiB;;wBAEK,EAAE,MAAM,iBAAiB,IAAI,OAAO;wBACpC,EAAE,MAAM,SAAS,CAAC;;YAE9B,EAAE,MAAM,YAAY,CAAC;;;;oCAIG,EAAE,YAAY,EAAE;;;;;;AAMpD,CAAC;IAEC,IAAI;QACA,MAAM,SAAS,CAAA,GAAA,2HAAA,CAAA,YAAS,AAAD,EAAE,MAAM,UAAU;QACzC,MAAM,WAAW,MAAM,OAAO,MAAM,CAAC,eAAe,CAAC;YACjD,OAAO;YACP,UAAU;YACV,QAAQ;gBACJ,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAEA,MAAM,OAAO,SAAS,IAAI;QAC1B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAC3B,MAAM,SAAS,KAAK,KAAK,CAAC;QAE1B,mDAAmD;QACnD,IAAI,CAAC,OAAO,gBAAgB,IAAI,OAAO,gBAAgB,CAAC,MAAM,KAAK,GAAG;YAClE,OAAO,gBAAgB,GAAG;gBACxB;oBAAE,MAAM;gBAAe;gBAAG;oBAAE,MAAM;gBAAmB;gBACrD;oBAAE,MAAM;gBAAmB;gBAAG;oBAAE,MAAM;gBAAQ;aAC/C;QACL;QAEA,OAAO;IAEX,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;YACH,WAAW,CAAC,kCAAkC,EAAE,MAAM,OAAO,CAAC,gBAAgB,CAAC;YAC/E,kBAAkB,MAAM,SAAS;YACjC,kBAAkB;gBAChB;oBAAE,MAAM;gBAAe;gBAAG;oBAAE,MAAM;gBAAmB;gBACrD;oBAAE,MAAM;gBAAmB;gBAAG;oBAAE,MAAM;gBAAQ;aAC/C;QACL;IACJ;AACF","debugId":null}},
    {"offset": {"line": 532, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/ai/flows/summarize-adventure.ts"],"sourcesContent":["/**\n * @fileOverview Summarizes the adventure.\n */\n\nimport { getClient } from '../ai-instance';\nimport { Type, Schema } from \"@google/genai\";\n\nexport interface SummarizeAdventureInput {\n  story: string;\n  userApiKey?: string | null;\n}\n\nexport interface SummarizeAdventureOutput {\n  summary: string;\n}\n\nconst responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n        summary: { type: Type.STRING }\n    },\n    required: [\"summary\"]\n};\n\nexport async function summarizeAdventure(input: SummarizeAdventureInput): Promise<SummarizeAdventureOutput> {\n  const prompt = `Summarize the following adventure story concisely, highlighting key events and consequences:\\n\\n${input.story}`;\n\n  try {\n      const client = getClient(input.userApiKey);\n      const response = await client.models.generateContent({\n          model: 'gemini-2.0-flash',\n          contents: prompt,\n          config: {\n              responseMimeType: \"application/json\",\n              responseSchema: responseSchema,\n          }\n      });\n\n      const text = response.text;\n      if (!text) throw new Error(\"No text\");\n      return JSON.parse(text);\n  } catch (e) {\n      console.error(\"AI Summary Error:\", e);\n      return { summary: \"Summary generation failed.\" };\n  }\n}"],"names":[],"mappings":"AAAA;;CAEC;;;AAED;AACA;;;AAWA,MAAM,iBAAyB;IAC3B,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;IACjB,YAAY;QACR,SAAS;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;QAAC;IACjC;IACA,UAAU;QAAC;KAAU;AACzB;AAEO,eAAe,mBAAmB,KAA8B;IACrE,MAAM,SAAS,CAAC,gGAAgG,EAAE,MAAM,KAAK,EAAE;IAE/H,IAAI;QACA,MAAM,SAAS,CAAA,GAAA,2HAAA,CAAA,YAAS,AAAD,EAAE,MAAM,UAAU;QACzC,MAAM,WAAW,MAAM,OAAO,MAAM,CAAC,eAAe,CAAC;YACjD,OAAO;YACP,UAAU;YACV,QAAQ;gBACJ,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAEA,MAAM,OAAO,SAAS,IAAI;QAC1B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAC3B,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO;YAAE,SAAS;QAA6B;IACnD;AACF","debugId":null}},
    {"offset": {"line": 580, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/ai/flows/assess-action-difficulty.ts"],"sourcesContent":["/**\n * @fileOverview An AI agent that assesses the difficulty of a player action in a text adventure game.\n */\n\nimport { getClient } from '../ai-instance';\nimport { Type, Schema } from \"@google/genai\";\nimport type { DifficultyLevel } from '../../types/game-types'; \n\nexport type { DifficultyLevel };\n\nexport interface AssessActionDifficultyInput {\n    playerAction: string;\n    characterCapabilities: string;\n    characterClass?: string;\n    currentSituation: string;\n    gameStateSummary: string;\n    gameDifficulty: string;\n    turnCount: number;\n    userApiKey?: string | null;\n}\n\nexport interface AssessActionDifficultyOutput {\n    difficulty: DifficultyLevel;\n    reasoning: string;\n    suggestedDice: \"d6\" | \"d10\" | \"d20\" | \"d100\" | \"None\";\n}\n\nconst responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n        difficulty: {\n            type: Type.STRING,\n            enum: [\"Trivial\", \"Easy\", \"Normal\", \"Hard\", \"Very Hard\", \"Impossible\"],\n            description: \"The assessed difficulty level.\"\n        },\n        reasoning: {\n            type: Type.STRING,\n            description: \"Explanation for the difficulty.\"\n        },\n        suggestedDice: {\n            type: Type.STRING,\n            enum: [\"d6\", \"d10\", \"d20\", \"d100\", \"None\"],\n            description: \"Suggested dice to roll.\"\n        }\n    },\n    required: [\"difficulty\", \"reasoning\", \"suggestedDice\"]\n};\n\nexport async function assessActionDifficulty(input: AssessActionDifficultyInput): Promise<AssessActionDifficultyOutput> {\n  if (input.characterClass === 'admin000') {\n    return {\n      difficulty: \"Trivial\",\n      reasoning: \"Developer Mode active. Action automatically succeeds.\",\n      suggestedDice: \"None\",\n    };\n  }\n\n  const prompt = `\nYou are an expert Game Master AI for the text adventure \"Endless Tales\". Your task is to assess the difficulty of a player's intended action.\n\n**Overall Game Difficulty:** ${input.gameDifficulty} (Adjust baseline difficulty: Harder settings make actions generally tougher).\n**Current Turn:** ${input.turnCount}\n\n**Factors to Consider:**\n1. **Player Action:** ${input.playerAction}\n2. **Character Capabilities:** ${input.characterCapabilities}\n3. **Current Situation:** ${input.currentSituation}\n4. **Game State Summary:** ${input.gameStateSummary}\n5. **Plausibility:** Is the action physically possible? \"Fly to the moon\" or \"become king instantly\" are Impossible without specific justification.\n\n**Assessment Task:**\nDetermine the difficulty: Trivial, Easy, Normal, Hard, Very Hard, Impossible.\nSuggest a dice type: d6, d10, d20, d100, None.\n\nOutput JSON only.\n`;\n\n  try {\n      const client = getClient(input.userApiKey);\n      const response = await client.models.generateContent({\n          model: 'gemini-2.0-flash',\n          contents: prompt,\n          config: {\n              responseMimeType: \"application/json\",\n              responseSchema: responseSchema,\n          }\n      });\n\n      const text = response.text;\n      if (!text) throw new Error(\"No text returned from AI\");\n      return JSON.parse(text) as AssessActionDifficultyOutput;\n\n  } catch (error) {\n      console.error(\"AI Error in assessActionDifficulty:\", error);\n      // Fallback\n      let fallbackDifficulty: DifficultyLevel = \"Normal\";\n      let fallbackDice: \"d6\" | \"d10\" | \"d20\" | \"d100\" | \"None\" = \"d10\";\n      switch(input.gameDifficulty?.toLowerCase()) {\n          case 'easy': fallbackDifficulty = \"Easy\"; fallbackDice = \"d6\"; break;\n          case 'hard': case 'nightmare': fallbackDifficulty = \"Hard\"; fallbackDice = \"d20\"; break;\n          default: fallbackDifficulty = \"Normal\"; fallbackDice = \"d10\";\n      }\n      return {\n          difficulty: fallbackDifficulty,\n          reasoning: \"AI assessment failed, assuming difficulty based on game settings.\",\n          suggestedDice: fallbackDice,\n      };\n  }\n}"],"names":[],"mappings":"AAAA;;CAEC;;;AAED;AACA;;;AAsBA,MAAM,iBAAyB;IAC3B,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;IACjB,YAAY;QACR,YAAY;YACR,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YACjB,MAAM;gBAAC;gBAAW;gBAAQ;gBAAU;gBAAQ;gBAAa;aAAa;YACtE,aAAa;QACjB;QACA,WAAW;YACP,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YACjB,aAAa;QACjB;QACA,eAAe;YACX,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YACjB,MAAM;gBAAC;gBAAM;gBAAO;gBAAO;gBAAQ;aAAO;YAC1C,aAAa;QACjB;IACJ;IACA,UAAU;QAAC;QAAc;QAAa;KAAgB;AAC1D;AAEO,eAAe,uBAAuB,KAAkC;IAC7E,IAAI,MAAM,cAAc,KAAK,YAAY;QACvC,OAAO;YACL,YAAY;YACZ,WAAW;YACX,eAAe;QACjB;IACF;IAEA,MAAM,SAAS,CAAC;;;6BAGW,EAAE,MAAM,cAAc,CAAC;kBAClC,EAAE,MAAM,SAAS,CAAC;;;sBAGd,EAAE,MAAM,YAAY,CAAC;+BACZ,EAAE,MAAM,qBAAqB,CAAC;0BACnC,EAAE,MAAM,gBAAgB,CAAC;2BACxB,EAAE,MAAM,gBAAgB,CAAC;;;;;;;;AAQpD,CAAC;IAEC,IAAI;QACA,MAAM,SAAS,CAAA,GAAA,2HAAA,CAAA,YAAS,AAAD,EAAE,MAAM,UAAU;QACzC,MAAM,WAAW,MAAM,OAAO,MAAM,CAAC,eAAe,CAAC;YACjD,OAAO;YACP,UAAU;YACV,QAAQ;gBACJ,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAEA,MAAM,OAAO,SAAS,IAAI;QAC1B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAC3B,OAAO,KAAK,KAAK,CAAC;IAEtB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uCAAuC;QACrD,WAAW;QACX,IAAI,qBAAsC;QAC1C,IAAI,eAAuD;QAC3D,OAAO,MAAM,cAAc,EAAE;YACzB,KAAK;gBAAQ,qBAAqB;gBAAQ,eAAe;gBAAM;YAC/D,KAAK;YAAQ,KAAK;gBAAa,qBAAqB;gBAAQ,eAAe;gBAAO;YAClF;gBAAS,qBAAqB;gBAAU,eAAe;QAC3D;QACA,OAAO;YACH,YAAY;YACZ,WAAW;YACX,eAAe;QACnB;IACJ;AACF","debugId":null}},
    {"offset": {"line": 698, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/ai/flows/generate-skill-tree.ts"],"sourcesContent":["/**\n * @fileOverview An AI agent that generates a skill tree.\n */\n\nimport { getClient } from '../ai-instance';\nimport { Type, Schema } from \"@google/genai\";\nimport type { SkillTree } from '../../types/game-types'; \n\nexport interface GenerateSkillTreeInput {\n  characterClass: string;\n  userApiKey?: string | null;\n}\n\nexport type GenerateSkillTreeOutput = SkillTree;\n\nconst responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n        className: { type: Type.STRING },\n        stages: {\n            type: Type.ARRAY,\n            items: {\n                type: Type.OBJECT,\n                properties: {\n                    stage: { type: Type.NUMBER },\n                    stageName: { type: Type.STRING },\n                    skills: {\n                        type: Type.ARRAY,\n                        items: {\n                            type: Type.OBJECT,\n                            properties: {\n                                name: { type: Type.STRING },\n                                description: { type: Type.STRING },\n                                manaCost: { type: Type.NUMBER, nullable: true },\n                                staminaCost: { type: Type.NUMBER, nullable: true }\n                            },\n                            required: [\"name\", \"description\"]\n                        }\n                    }\n                },\n                required: [\"stage\", \"stageName\", \"skills\"]\n            }\n        }\n    },\n    required: [\"className\", \"stages\"]\n};\n\nconst createFallbackSkillTree = (className: string): SkillTree => ({\n    className: className,\n    stages: [\n        { stage: 0, stageName: \"Potential\", skills: [] },\n        { stage: 1, stageName: \"Novice\", skills: [{ name: \"Basic Training\", description: \"Improves readiness.\"}] },\n        { stage: 2, stageName: \"Apprentice\", skills: [{ name: \"Focused Study\", description: \"Deeper understanding.\"}] },\n        { stage: 3, stageName: \"Adept\", skills: [{ name: \"Power Surge\", description: \"Boosts effectiveness.\"}] },\n        { stage: 4, stageName: \"Master\", skills: [{ name: \"Ultimate Focus\", description: \"True potential.\"}] },\n    ]\n});\n\nexport async function generateSkillTree(input: GenerateSkillTreeInput): Promise<GenerateSkillTreeOutput> {\n  const prompt = `\nYou are a game designer. Generate a 5-stage skill tree (stages 0-4) for the class: ${input.characterClass}.\n\nRequirements:\n1. 5 stages (0, 1, 2, 3, 4).\n2. Stage 0 named \"Potential\" or similar, with EMPTY skills array.\n3. Stages 1-4 have thematic names and 1-3 skills each.\n4. Skills need name, description, and optional manaCost/staminaCost.\n\nOutput JSON.\n`;\n\n  try {\n      const client = getClient(input.userApiKey);\n      const response = await client.models.generateContent({\n          model: 'gemini-2.0-flash',\n          contents: prompt,\n          config: {\n              responseMimeType: \"application/json\",\n              responseSchema: responseSchema,\n          }\n      });\n\n      const text = response.text;\n      if (!text) throw new Error(\"No text returned from AI\");\n      const output = JSON.parse(text) as GenerateSkillTreeOutput;\n      \n      // Basic validation\n      if (!output.stages || output.stages.length !== 5) throw new Error(\"Invalid stage count\");\n      \n      return output;\n\n  } catch (error) {\n      console.error(\"AI Skill Tree Error:\", error);\n      return createFallbackSkillTree(input.characterClass);\n  }\n}"],"names":[],"mappings":"AAAA;;CAEC;;;AAED;AACA;;;AAUA,MAAM,iBAAyB;IAC3B,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;IACjB,YAAY;QACR,WAAW;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;QAAC;QAC/B,QAAQ;YACJ,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;YAChB,OAAO;gBACH,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBACjB,YAAY;oBACR,OAAO;wBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;oBAAC;oBAC3B,WAAW;wBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;oBAAC;oBAC/B,QAAQ;wBACJ,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;wBAChB,OAAO;4BACH,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;4BACjB,YAAY;gCACR,MAAM;oCAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gCAAC;gCAC1B,aAAa;oCAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gCAAC;gCACjC,UAAU;oCAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;oCAAE,UAAU;gCAAK;gCAC9C,aAAa;oCAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;oCAAE,UAAU;gCAAK;4BACrD;4BACA,UAAU;gCAAC;gCAAQ;6BAAc;wBACrC;oBACJ;gBACJ;gBACA,UAAU;oBAAC;oBAAS;oBAAa;iBAAS;YAC9C;QACJ;IACJ;IACA,UAAU;QAAC;QAAa;KAAS;AACrC;AAEA,MAAM,0BAA0B,CAAC,YAAiC,CAAC;QAC/D,WAAW;QACX,QAAQ;YACJ;gBAAE,OAAO;gBAAG,WAAW;gBAAa,QAAQ,EAAE;YAAC;YAC/C;gBAAE,OAAO;gBAAG,WAAW;gBAAU,QAAQ;oBAAC;wBAAE,MAAM;wBAAkB,aAAa;oBAAqB;iBAAE;YAAC;YACzG;gBAAE,OAAO;gBAAG,WAAW;gBAAc,QAAQ;oBAAC;wBAAE,MAAM;wBAAiB,aAAa;oBAAuB;iBAAE;YAAC;YAC9G;gBAAE,OAAO;gBAAG,WAAW;gBAAS,QAAQ;oBAAC;wBAAE,MAAM;wBAAe,aAAa;oBAAuB;iBAAE;YAAC;YACvG;gBAAE,OAAO;gBAAG,WAAW;gBAAU,QAAQ;oBAAC;wBAAE,MAAM;wBAAkB,aAAa;oBAAiB;iBAAE;YAAC;SACxG;IACL,CAAC;AAEM,eAAe,kBAAkB,KAA6B;IACnE,MAAM,SAAS,CAAC;mFACiE,EAAE,MAAM,cAAc,CAAC;;;;;;;;;AAS1G,CAAC;IAEC,IAAI;QACA,MAAM,SAAS,CAAA,GAAA,2HAAA,CAAA,YAAS,AAAD,EAAE,MAAM,UAAU;QACzC,MAAM,WAAW,MAAM,OAAO,MAAM,CAAC,eAAe,CAAC;YACjD,OAAO;YACP,UAAU;YACV,QAAQ;gBACJ,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAEA,MAAM,OAAO,SAAS,IAAI;QAC1B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAC3B,MAAM,SAAS,KAAK,KAAK,CAAC;QAE1B,mBAAmB;QACnB,IAAI,CAAC,OAAO,MAAM,IAAI,OAAO,MAAM,CAAC,MAAM,KAAK,GAAG,MAAM,IAAI,MAAM;QAElE,OAAO;IAEX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,wBAAwB,MAAM,cAAc;IACvD;AACF","debugId":null}},
    {"offset": {"line": 853, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/ai/flows/attempt-crafting.ts"],"sourcesContent":["/**\n * @fileOverview An AI agent that determines the outcome of a crafting attempt.\n */\n\nimport { getClient } from '../ai-instance';\nimport { Type, Schema } from \"@google/genai\";\nimport type { InventoryItem, ItemQuality } from '../../types/game-types';\n\nexport interface AttemptCraftingInput {\n  characterKnowledge: string[];\n  characterSkills: string[];\n  inventoryItems: string[];\n  desiredItem: string;\n  usedIngredients: string[];\n  userApiKey?: string | null;\n}\n\nexport interface AttemptCraftingOutput {\n  success: boolean;\n  message: string;\n  craftedItem: {\n      name: string;\n      description: string;\n      quality?: ItemQuality;\n      weight?: number;\n      durability?: number;\n      magicalEffect?: string;\n  } | null;\n  consumedItems: string[];\n}\n\nconst responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n        success: { type: Type.BOOLEAN },\n        message: { type: Type.STRING },\n        craftedItem: {\n            type: Type.OBJECT,\n            properties: {\n                name: { type: Type.STRING },\n                description: { type: Type.STRING },\n                quality: { type: Type.STRING, enum: [\"Poor\", \"Common\", \"Uncommon\", \"Rare\", \"Epic\", \"Legendary\"] },\n                weight: { type: Type.NUMBER },\n                durability: { type: Type.NUMBER },\n                magicalEffect: { type: Type.STRING }\n            },\n            nullable: true\n        },\n        consumedItems: {\n            type: Type.ARRAY,\n            items: { type: Type.STRING }\n        }\n    },\n    required: [\"success\", \"message\", \"consumedItems\"]\n};\n\nexport async function attemptCrafting(input: AttemptCraftingInput): Promise<AttemptCraftingOutput> {\n  const prompt = `\nYou are a Master Crafter AI for the text adventure \"Endless Tales\". Evaluate a player's crafting attempt.\n\n**Character Capabilities:**\n* Knowledge: ${input.characterKnowledge.length ? input.characterKnowledge.join(', ') : 'None'}\n* Skills: ${input.characterSkills.length ? input.characterSkills.join(', ') : 'None'}\n\n**Inventory:**\n${input.inventoryItems.length ? input.inventoryItems.join(', ') : 'Empty'}\n\n**Crafting Attempt:**\n* Goal: ${input.desiredItem}\n* Ingredients Used: ${input.usedIngredients.length ? input.usedIngredients.join(', ') : 'None specified'}\n\n**Evaluation Task:**\n1. **Plausibility:** Is crafting ${input.desiredItem} feasible?\n2. **Knowledge/Skills:** Does character have required know-how?\n3. **Ingredients:** Are ingredients logical and available?\n\n**Outcome:**\n* **Success:** Set success=true. Generate item details. List used ingredients in consumedItems.\n* **Failure/Impossible:** Set success=false. Provide message. List ingredients consumed (if failed attempt wasted them).\n\nOutput JSON.\n`;\n\n  try {\n      const client = getClient(input.userApiKey);\n      const response = await client.models.generateContent({\n          model: 'gemini-2.0-flash',\n          contents: prompt,\n          config: {\n              responseMimeType: \"application/json\",\n              responseSchema: responseSchema,\n          }\n      });\n\n      const text = response.text;\n      if (!text) throw new Error(\"No text returned from AI\");\n      return JSON.parse(text) as AttemptCraftingOutput;\n\n  } catch (error: any) {\n      console.error(\"AI Crafting Error:\", error);\n      return {\n          success: false,\n          message: \"The crafting attempt failed due to an external force (AI Error).\",\n          craftedItem: null,\n          consumedItems: []\n      };\n  }\n}"],"names":[],"mappings":"AAAA;;CAEC;;;AAED;AACA;;;AA0BA,MAAM,iBAAyB;IAC3B,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;IACjB,YAAY;QACR,SAAS;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,OAAO;QAAC;QAC9B,SAAS;YAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;QAAC;QAC7B,aAAa;YACT,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YACjB,YAAY;gBACR,MAAM;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAC1B,aAAa;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBACjC,SAAS;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;oBAAE,MAAM;wBAAC;wBAAQ;wBAAU;wBAAY;wBAAQ;wBAAQ;qBAAY;gBAAC;gBAChG,QAAQ;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAC5B,YAAY;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;gBAChC,eAAe;oBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;gBAAC;YACvC;YACA,UAAU;QACd;QACA,eAAe;YACX,MAAM,2JAAA,CAAA,OAAI,CAAC,KAAK;YAChB,OAAO;gBAAE,MAAM,2JAAA,CAAA,OAAI,CAAC,MAAM;YAAC;QAC/B;IACJ;IACA,UAAU;QAAC;QAAW;QAAW;KAAgB;AACrD;AAEO,eAAe,gBAAgB,KAA2B;IAC/D,MAAM,SAAS,CAAC;;;;aAIL,EAAE,MAAM,kBAAkB,CAAC,MAAM,GAAG,MAAM,kBAAkB,CAAC,IAAI,CAAC,QAAQ,OAAO;UACpF,EAAE,MAAM,eAAe,CAAC,MAAM,GAAG,MAAM,eAAe,CAAC,IAAI,CAAC,QAAQ,OAAO;;;AAGrF,EAAE,MAAM,cAAc,CAAC,MAAM,GAAG,MAAM,cAAc,CAAC,IAAI,CAAC,QAAQ,QAAQ;;;QAGlE,EAAE,MAAM,WAAW,CAAC;oBACR,EAAE,MAAM,eAAe,CAAC,MAAM,GAAG,MAAM,eAAe,CAAC,IAAI,CAAC,QAAQ,iBAAiB;;;iCAGxE,EAAE,MAAM,WAAW,CAAC;;;;;;;;;AASrD,CAAC;IAEC,IAAI;QACA,MAAM,SAAS,CAAA,GAAA,2HAAA,CAAA,YAAS,AAAD,EAAE,MAAM,UAAU;QACzC,MAAM,WAAW,MAAM,OAAO,MAAM,CAAC,eAAe,CAAC;YACjD,OAAO;YACP,UAAU;YACV,QAAQ;gBACJ,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAEA,MAAM,OAAO,SAAS,IAAI;QAC1B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAC3B,OAAO,KAAK,KAAK,CAAC;IAEtB,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO;YACH,SAAS;YACT,SAAS;YACT,aAAa;YACb,eAAe,EAAE;QACrB;IACJ;AACF","debugId":null}},
    {"offset": {"line": 971, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/hooks/use-mobile.tsx"],"sourcesContent":["import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,oBAAoB;AAEnB,SAAS;IACd,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAc,AAAD,EAAuB;IAEpE,CAAA,GAAA,qMAAA,CAAA,YAAe,AAAD,EAAE;QACd,MAAM,MAAM,OAAO,UAAU,CAAC,CAAC,YAAY,EAAE,oBAAoB,EAAE,GAAG,CAAC;QACvE,MAAM,WAAW;YACf,YAAY,OAAO,UAAU,GAAG;QAClC;QACA,IAAI,gBAAgB,CAAC,UAAU;QAC/B,YAAY,OAAO,UAAU,GAAG;QAChC,OAAO,IAAM,IAAI,mBAAmB,CAAC,UAAU;IACjD,GAAG,EAAE;IAEL,OAAO,CAAC,CAAC;AACX","debugId":null}},
    {"offset": {"line": 996, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/app/page.tsx"],"sourcesContent":["\n\"use client\";\n\nimport { useEffect } from 'react';\nimport { useGame } from \"../context/GameContext\";\nimport { MainMenu } from \"../components/screens/MainMenu\";\nimport { CharacterCreation } from \"../components/screens/CharacterCreation\";\nimport { AdventureSetup } from \"../components/screens/AdventureSetup\";\nimport { Gameplay } from \"../components/screens/Gameplay\";\nimport { AdventureSummary } from \"../components/screens/AdventureSummary\";\nimport { SavedAdventuresList } from \"../components/screens/SavedAdventuresList\";\n// import { CoopLobby } from \"../components/screens/CoopLobby\"; // Disabled\nimport { Loader2 } from \"lucide-react\";\n\nexport default function Home() {\n  const { state } = useGame();\n\n  useEffect(() => {\n    console.log(\"Current Game Status in page.tsx:\", state.status);\n  }, [state.status]);\n\n\n  const renderScreen = () => {\n    console.log(\"Rendering screen for status:\", state.status);\n    switch (state.status) {\n      case \"MainMenu\":\n        return <MainMenu />;\n      case \"CharacterCreation\":\n        return <CharacterCreation />;\n      case \"AdventureSetup\":\n        return <AdventureSetup />;\n      case \"Gameplay\":\n        return state.character ? <Gameplay /> : <div className=\"flex items-center justify-center min-h-screen\"><Loader2 className=\"h-8 w-8 animate-spin mr-2\"/> Loading Character...</div>;\n      \n      // Co-op modes temporarily disabled\n      case \"CoopGameplay\":\n      case \"CoopLobby\":\n         return <MainMenu />;\n\n      case \"AdventureSummary\":\n        return <AdventureSummary />;\n      case \"ViewSavedAdventures\":\n        return <SavedAdventuresList />;\n      default:\n        console.warn(\"Unknown game status in page.tsx:\", state.status, \"Defaulting to MainMenu.\");\n        return <MainMenu />;\n    }\n  };\n\n  return <main className=\"min-h-screen\">{renderScreen()}</main>;\n}\n"],"names":[],"mappings":";;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2EAA2E;AAC3E;AAXA;;;;;;;;;;;AAae,SAAS;IACtB,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,8HAAA,CAAA,UAAO,AAAD;IAExB,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,QAAQ,GAAG,CAAC,oCAAoC,MAAM,MAAM;IAC9D,GAAG;QAAC,MAAM,MAAM;KAAC;IAGjB,MAAM,eAAe;QACnB,QAAQ,GAAG,CAAC,gCAAgC,MAAM,MAAM;QACxD,OAAQ,MAAM,MAAM;YAClB,KAAK;gBACH,qBAAO,8OAAC,yIAAA,CAAA,WAAQ;;;;;YAClB,KAAK;gBACH,qBAAO,8OAAC,kJAAA,CAAA,oBAAiB;;;;;YAC3B,KAAK;gBACH,qBAAO,8OAAC,+IAAA,CAAA,iBAAc;;;;;YACxB,KAAK;gBACH,OAAO,MAAM,SAAS,iBAAG,8OAAC,yIAAA,CAAA,WAAQ;;;;yCAAM,8OAAC;oBAAI,WAAU;;sCAAgD,8OAAC,iNAAA,CAAA,UAAO;4BAAC,WAAU;;;;;;wBAA6B;;;;;;;YAEzJ,mCAAmC;YACnC,KAAK;YACL,KAAK;gBACF,qBAAO,8OAAC,yIAAA,CAAA,WAAQ;;;;;YAEnB,KAAK;gBACH,qBAAO,8OAAC,iJAAA,CAAA,mBAAgB;;;;;YAC1B,KAAK;gBACH,qBAAO,8OAAC,oJAAA,CAAA,sBAAmB;;;;;YAC7B;gBACE,QAAQ,IAAI,CAAC,oCAAoC,MAAM,MAAM,EAAE;gBAC/D,qBAAO,8OAAC,yIAAA,CAAA,WAAQ;;;;;QACpB;IACF;IAEA,qBAAO,8OAAC;QAAK,WAAU;kBAAgB;;;;;;AACzC","debugId":null}}]
}