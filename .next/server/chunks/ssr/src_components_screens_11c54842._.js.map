{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/components/screens/SettingsPanel.tsx"],"sourcesContent":["\n// src/components/screens/SettingsPanel.tsx\n\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { useGame } from \"../../context/GameContext\";\nimport {\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n  SheetDescription,\n  SheetFooter,\n} from \"../../components/ui/sheet\";\nimport { Button } from \"../../components/ui/button\";\nimport { Switch } from \"../../components/ui/switch\";\nimport { Label } from \"../../components/ui/label\";\nimport { Input } from \"../../components/ui/input\";\nimport { Palette, Moon, Sun, Paintbrush, KeyRound, CheckCircle, XCircle } from \"lucide-react\";\nimport { Separator } from \"../../components/ui/separator\";\nimport { cn } from \"../../lib/utils\";\nimport { THEMES } from \"../../lib/themes\";\nimport { useToast } from \"../../hooks/use-toast\";\n\ninterface SettingsPanelProps {\n    isOpen: boolean;\n    onOpenChange: (open: boolean) => void;\n}\n\nexport function SettingsPanel({ isOpen, onOpenChange }: SettingsPanelProps) {\n    const { state, dispatch } = useGame();\n    const { selectedThemeId, isDarkMode, userGoogleAiApiKey } = state;\n    const [apiKeyInput, setApiKeyInput] = useState(userGoogleAiApiKey || \"\");\n    const { toast } = useToast();\n\n    useEffect(() => {\n        setApiKeyInput(userGoogleAiApiKey || \"\");\n    }, [userGoogleAiApiKey]);\n\n\n    const toggleThemeMode = () => {\n        dispatch({ type: 'SET_DARK_MODE', payload: !isDarkMode });\n    };\n\n    const handleThemeChange = (themeId: string) => {\n        dispatch({ type: 'SET_THEME_ID', payload: themeId });\n    };\n\n    const handleSaveApiKey = () => {\n        const trimmedKey = apiKeyInput.trim();\n        if (trimmedKey) {\n            dispatch({ type: 'SET_USER_API_KEY', payload: trimmedKey });\n            toast({ title: \"API Key Saved\", description: \"Your Google AI API Key has been saved locally.\", variant: \"default\" });\n        } else {\n            dispatch({ type: 'SET_USER_API_KEY', payload: null });\n            toast({ title: \"API Key Cleared\", description: \"Your Google AI API Key has been cleared.\", variant: \"default\" });\n        }\n    };\n\n    const handleClearApiKey = () => {\n        setApiKeyInput(\"\");\n        dispatch({ type: 'SET_USER_API_KEY', payload: null });\n        toast({ title: \"API Key Cleared\", description: \"Your Google AI API Key has been cleared.\", variant: \"default\" });\n    };\n\n\n    return (\n        <SheetContent side=\"right\" className=\"w-[90vw] sm:w-[400px] flex flex-col\">\n            <SheetHeader className=\"p-4 border-b\">\n                <SheetTitle className=\"flex items-center gap-2 text-xl\">\n                    <Palette className=\"w-5 h-5\" /> Settings\n                </SheetTitle>\n                <SheetDescription>\n                    Customize your game experience.\n                </SheetDescription>\n            </SheetHeader>\n            <div className=\"flex-grow p-3 space-y-4 overflow-y-auto scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent\"> {/* Reduced padding and spacing */}\n                {/* Appearance Section */}\n                <div className=\"space-y-4\">\n                     <h3 className=\"text-lg font-medium border-b pb-1\">Appearance</h3>\n                     <div className=\"flex items-center justify-between space-x-2 p-3 border rounded-md bg-muted/30\">\n                       <Label htmlFor=\"dark-mode\" className=\"flex items-center gap-2 font-medium cursor-pointer\">\n                         {isDarkMode ? <Moon className=\"w-4 h-4\" /> : <Sun className=\"w-4 h-4\" />}\n                         <span>{isDarkMode ? \"Dark Mode\" : \"Light Mode\"}</span>\n                       </Label>\n                       <Switch\n                         id=\"dark-mode\"\n                         checked={isDarkMode}\n                         onCheckedChange={toggleThemeMode}\n                         aria-label={`Switch to ${isDarkMode ? 'Light' : 'Dark'} mode`}\n                       />\n                     </div>\n\n                     <div className=\"space-y-2\">\n                        <Label className=\"flex items-center gap-1\"><Paintbrush className=\"w-4 h-4\"/> Color Theme</Label>\n                         <div className=\"flex flex-wrap gap-2\"> {/* Changed from grid to flex-wrap */}\n                             {THEMES.map(theme => {\n                                const primaryColor = `hsl(${theme.light['--primary']})`;\n                                const accentColor = `hsl(${theme.light['--accent']})`;\n                                return (\n                                 <Button\n                                     key={theme.id}\n                                     variant=\"outline\"\n                                     size=\"sm\"\n                                     className={cn(\n                                         \"justify-start h-auto py-1.5 px-2 text-xs items-center\", // Adjusted padding for better fit, items-center\n                                         selectedThemeId === theme.id && \"ring-2 ring-ring ring-offset-2 ring-offset-background\"\n                                     )}\n                                     onClick={() => handleThemeChange(theme.id)}\n                                 >\n                                     <div\n                                        className=\"w-4 h-4 rounded-sm mr-2 border shrink-0\"\n                                        style={{\n                                            background: `linear-gradient(to bottom right, ${primaryColor} 0%, ${primaryColor} 50%, ${accentColor} 50%, ${accentColor} 100%)`\n                                        }}\n                                        aria-hidden=\"true\"\n                                     />\n                                     {theme.name}\n                                 </Button>\n                                );\n                            })}\n                         </div>\n                         <p className=\"text-xs text-muted-foreground\">Select a visual theme for the interface.</p>\n                     </div>\n                </div>\n\n                 <Separator />\n\n                {/* API Key Section */}\n                <div className=\"space-y-4\">\n                    <h3 className=\"text-lg font-medium border-b pb-1 flex items-center gap-2\">\n                        <KeyRound className=\"w-4 h-4\" /> API Configuration\n                    </h3>\n                    <div className=\"space-y-2\">\n                        <Label htmlFor=\"api-key-input\">Google AI API Key</Label>\n                        <Input\n                            id=\"api-key-input\"\n                            type=\"password\"\n                            value={apiKeyInput}\n                            onChange={(e) => setApiKeyInput(e.target.value)}\n                            placeholder=\"Enter your Google GenAI API Key\"\n                            className=\"text-sm\"\n                        />\n                        <p className=\"text-xs text-muted-foreground\">\n                            Your API key is stored locally in your browser and is used for AI-powered features.\n                            It is not sent to our servers.\n                        </p>\n                        <div className=\"flex items-center gap-2 mt-1\">\n                            {userGoogleAiApiKey ? (\n                                <span className=\"text-xs text-green-600 flex items-center gap-1\"><CheckCircle className=\"w-3.5 h-3.5\"/> API Key is set.</span>\n                            ) : (\n                                <span className=\"text-xs text-destructive flex items-center gap-1\"><XCircle className=\"w-3.5 h-3.5\"/> API Key is not set.</span>\n                            )}\n                        </div>\n                    </div>\n                    <div className=\"flex gap-2\">\n                        <Button onClick={handleSaveApiKey} size=\"sm\" className=\"flex-1\">\n                            Save API Key\n                        </Button>\n                        {userGoogleAiApiKey && (\n                            <Button onClick={handleClearApiKey} variant=\"destructive\" size=\"sm\">\n                                Clear API Key\n                            </Button>\n                        )}\n                    </div>\n                     <p className=\"text-xs text-muted-foreground italic\">\n                        Note: Currently, the game uses a pre-configured API key for AI interactions.\n                        User-provided keys will be enabled for AI calls in a future update.\n                    </p>\n                </div>\n\n\n            </div>\n            <SheetFooter className=\"border-t pt-4 p-3\"> {/* Added p-3 to footer as well */}\n                <Button variant=\"outline\" onClick={() => onOpenChange(false)}>Close</Button>\n            </SheetFooter>\n        </SheetContent>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 464, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/components/screens/MainMenu.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState, useEffect } from 'react';\nimport { useGame } from \"../../context/GameContext\";\nimport { Button } from \"../../components/ui/button\";\nimport { CardboardCard, CardContent, CardHeader, CardTitle, CardFooter } from \"../../components/game/CardboardCard\";\nimport { Play, Settings, Sparkles, FolderClock, ChevronDown, Dices, Swords } from \"lucide-react\";\nimport { SettingsPanel } from '../../components/screens/SettingsPanel';\nimport {\n  Sheet,\n  SheetTrigger,\n} from \"../../components/ui/sheet\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"../../components/ui/dropdown-menu\";\nimport type { AdventureType } from \"../../types/adventure-types\";\n\nexport function MainMenu() {\n  const { dispatch } = useGame();\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n\n   useEffect(() => {\n     console.log(\"MainMenu component mounted.\");\n   }, []);\n\n  const handleNewGameFlow = (adventureType: AdventureType) => {\n    console.log(`MainMenu: Starting new game flow for type: ${adventureType}`);\n    dispatch({ type: \"RESET_GAME\" });\n    dispatch({ type: \"SET_ADVENTURE_TYPE\", payload: adventureType });\n\n    if (adventureType === \"Coop\") {\n        dispatch({ type: \"SET_GAME_STATUS\", payload: \"CoopLobby\" });\n    } else if (adventureType === \"Randomized\") {\n        // For Randomized, go to Character Creation first.\n        dispatch({ type: \"SET_GAME_STATUS\", payload: \"CharacterCreation\" });\n    } else {\n        // For Custom and Immersed, go to Adventure Setup first.\n        dispatch({ type: \"SET_GAME_STATUS\", payload: \"AdventureSetup\" });\n    }\n  };\n\n  const handleViewSaved = () => {\n     console.log(\"MainMenu: Handling View Saved Adventures button click.\");\n    dispatch({ type: \"SET_GAME_STATUS\", payload: \"ViewSavedAdventures\" });\n  };\n\n\n  return (\n    <div className=\"flex flex-col items-center justify-center min-h-screen p-4 bg-background relative\">\n       <Sheet open={isSettingsOpen} onOpenChange={setIsSettingsOpen}>\n        <SheetTrigger asChild>\n           <Button variant=\"ghost\" size=\"icon\" className=\"absolute top-4 right-4 z-10\">\n              <Settings className=\"h-6 w-6 text-muted-foreground\" />\n              <span className=\"sr-only\">Open Settings</span>\n           </Button>\n        </SheetTrigger>\n        {/* SettingsPanel contains the SheetContent, so we render it directly here */}\n        <SettingsPanel isOpen={isSettingsOpen} onOpenChange={setIsSettingsOpen} />\n       </Sheet>\n\n      <CardboardCard className=\"w-full max-w-md text-center shadow-xl border-2 border-foreground/20\">\n        <CardHeader className=\"border-b border-foreground/10 pb-4\">\n          <CardTitle className=\"text-4xl font-bold text-foreground mb-4 font-['Comic_Sans_MS',_'Chalkboard_SE',_'Marker_Felt',_sans-serif]\">\n            Endless Tales\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"flex flex-col gap-4 pt-6\">\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button size=\"lg\" className=\"bg-accent hover:bg-accent/90 text-accent-foreground w-full\">\n                  <Play className=\"mr-2 h-5 w-5\" /> Start New Adventure <ChevronDown className=\"ml-auto h-4 w-4 opacity-70\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent className=\"w-[calc(100%-2rem)] sm:w-[364px] max-w-md\">\n                <DropdownMenuItem onClick={() => handleNewGameFlow(\"Randomized\")} className=\"cursor-pointer\">\n                  <Dices className=\"mr-2 h-4 w-4\" /> Randomized Adventure\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => handleNewGameFlow(\"Custom\")} className=\"cursor-pointer\">\n                  <Swords className=\"mr-2 h-4 w-4\" /> Custom Adventure\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => handleNewGameFlow(\"Immersed\")} className=\"cursor-pointer\">\n                  <Sparkles className=\"mr-2 h-4 w-4\" /> Immersed Adventure\n                </DropdownMenuItem>\n                 {/* Co-op Disabled Temporarily */}\n                 {/* <DropdownMenuSeparator />\n                 <DropdownMenuItem onClick={() => handleNewGameFlow(\"Coop\")} className=\"cursor-pointer\">\n                    <Users className=\"mr-2 h-4 w-4\" /> Co-op Adventure\n                 </DropdownMenuItem> */}\n              </DropdownMenuContent>\n            </DropdownMenu>\n\n            <Button size=\"lg\" onClick={handleViewSaved} variant=\"secondary\" className=\"w-full\">\n              <FolderClock className=\"mr-2 h-5 w-5\" /> View Saved Adventures\n            </Button>\n        </CardContent>\n        <CardFooter className=\"pt-4 justify-center flex-col items-center\">\n           <p className=\"text-xs text-muted-foreground mb-2\">v0.1.0 - Alpha</p>\n            <a href='https://ko-fi.com/K3K31ELFCW' target='_blank' rel=\"noopener noreferrer\">\n                <img\n                    src='https://storage.ko-fi.com/cdn/kofi5.png?v=6'\n                    alt='Buy Me a Coffee at ko-fi.com'\n                    width={150}\n                    height={36}\n                    style={{border: '0px', height: '36px', width: 'auto'}}\n                />\n            </a>\n        </CardFooter>\n      </CardboardCard>\n       <footer className=\"mt-8 text-sm text-muted-foreground text-center\">\n        <p>An AI-powered text adventure where your choices shape the story.</p>\n      </footer>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 813, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/components/screens/CharacterCreation.tsx"],"sourcesContent":["// src/components/screens/CharacterCreation.tsx\n\"use client\";\n\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\nimport { useForm, type FieldErrors, type UseFormRegister } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport _ from 'lodash';\nimport { useGame } from \"../../context/GameContext\";\nimport { Button } from \"../../components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"../../components/ui/tabs\";\nimport { CardboardCard, CardContent, CardHeader, CardTitle, CardFooter } from \"../../components/game/CardboardCard\";\nimport { Wand2, RotateCcw, User, Save, AlertCircle, CheckCircle, LogOut, Loader2, TrendingUp, ArrowRight } from \"lucide-react\";\nimport { generateCharacterDescription, type GenerateCharacterDescriptionOutput } from \"../../ai/flows/generate-character-description\";\nimport { Alert, AlertDescription, AlertTitle } from \"../../components/ui/alert\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"../../components/ui/tooltip\";\nimport { useToast } from \"../../hooks/use-toast\";\nimport { Separator } from \"../../components/ui/separator\";\nimport { StatAllocationInput } from \"../../components/character/StatAllocationInput\";\nimport { TOTAL_STAT_POINTS, MIN_STAT_VALUE, MAX_STAT_VALUE } from \"../../lib/constants\";\nimport type { CharacterStats, Character } from \"../../types/character-types\";\nimport { initialCharacterStats as defaultInitialStats } from \"../../context/game-initial-state\";\nimport { BasicCharacterForm } from \"../../components/character/BasicCharacterForm\";\nimport { TextCharacterForm } from \"../../components/character/TextCharacterForm\";\nimport type { AdventureType } from \"../../types/adventure-types\";\nimport { HandDrawnStrengthIcon, HandDrawnStaminaIcon, HandDrawnMagicIcon as HandDrawnWisdomIcon } from \"../../components/icons/HandDrawnIcons\";\n\n// Module-level variables to hold context for Zod schema, updated by useEffect\nlet currentGlobalAdventureType: AdventureType | null = null;\nlet currentGlobalCharacterOriginType: 'existing' | 'original' | undefined = undefined;\n\n// --- Zod Schema for Validation ---\nconst baseCharacterSchema = z.object({\n  name: z.string().min(1, \"Character name is required.\").max(50, \"Name too long (max 50).\"),\n});\n\nconst commaSeparatedMaxItems = (max: number, message: string) =>\n  z.string()\n   .transform(val => val === undefined || val === \"\" ? [] : val.split(',').map(s => s.trim()).filter(Boolean))\n   .refine(arr => arr.length <= max, { message })\n   .transform(arr => arr.join(', ')) // Convert back to string for form state\n   .optional()\n   .transform(val => val || \"\"); // Ensure it's an empty string if undefined\n\nconst basicCreationSchemaFields = {\n  creationType: z.literal(\"basic\"),\n  class: z.string().max(30, \"Class name too long (max 30).\").optional().transform(val => val || \"\"),\n  traits: commaSeparatedMaxItems(5, \"Max 5 traits allowed (comma-separated).\"),\n  knowledge: commaSeparatedMaxItems(5, \"Max 5 knowledge areas allowed (comma-separated).\"),\n  background: z.string().max(100, \"Background too long (max 100).\").optional().transform(val => val || \"\"),\n  description: z.string().optional().transform(val => val || \"\"), // Description is optional in basic mode initially\n};\nconst basicCreationSchema = baseCharacterSchema.extend(basicCreationSchemaFields);\n\nconst textCreationSchemaFields = {\n  creationType: z.literal(\"text\"),\n  description: z.string().optional(), // Description is central here, min length validated in superRefine\n  // The following are for AI to potentially fill, so initially optional from user's perspective\n  class: z.string().max(30, \"Class name too long (max 30).\").optional().transform(val => val || \"\"),\n  traits: commaSeparatedMaxItems(5, \"Max 5 traits allowed (comma-separated).\"),\n  knowledge: commaSeparatedMaxItems(5, \"Max 5 knowledge areas allowed (comma-separated).\"),\n  background: z.string().max(100, \"Background too long (max 100).\").optional().transform(val => val || \"\"),\n};\nconst textCreationSchema = baseCharacterSchema.extend(textCreationSchemaFields);\n\nconst combinedSchema = z.discriminatedUnion(\"creationType\", [\n  basicCreationSchema,\n  textCreationSchema,\n]).superRefine((data, ctx) => {\n  const advType = currentGlobalAdventureType;\n  const originType = currentGlobalCharacterOriginType;\n\n  if (data.creationType === \"basic\") {\n    if (advType !== \"Immersed\" && (!data.class || data.class.trim() === \"\")) {\n      ctx.addIssue({ code: z.ZodIssueCode.custom, message: \"Class is required for Randomized/Custom adventures.\", path: [\"class\"] });\n    }\n  } else if (data.creationType === \"text\") {\n    const descLength = data.description?.trim().length ?? 0;\n    const minDescLength = (advType === \"Immersed\" && originType === \"original\") ? 10 : 10;\n    if (descLength < minDescLength) {\n      let msg = `Description (min ${minDescLength} chars) is required for AI profile generation.`;\n      if (advType === \"Immersed\" && originType === \"original\") {\n        msg = `Original Character Concept (min ${minDescLength} chars in description box) is required.`;\n      } else if (advType !== \"Immersed\") {\n        // Only require if text tab is active and it's not an existing immersed character\n         msg = `Description (min ${minDescLength} chars) is required for AI profile generation in Randomized/Custom modes when using text-based creation.`;\n      }\n      ctx.addIssue({ code: z.ZodIssueCode.custom, message: msg, path: [\"description\"] });\n    }\n  }\n});\n\ntype FormData = z.infer<typeof combinedSchema>;\n\nconst staticDefaultValues: FormData = {\n    creationType: \"basic\", // Default tab\n    name: \"\",\n    class: \"\",\n    traits: \"\",\n    knowledge: \"\",\n    background: \"\",\n    description: \"\",\n};\n\n\nexport function CharacterCreation() {\n  const { state, dispatch } = useGame();\n  const { toast } = useToast();\n  const formRef = useRef<HTMLFormElement>(null);\n\n  const [creationType, setCreationType] = useState<\"basic\" | \"text\">(\"basic\");\n\n  const calculateRemainingPoints = useCallback((currentStats: CharacterStats): number => {\n    const allocatedTotal = currentStats.strength + currentStats.stamina + currentStats.wisdom;\n    return TOTAL_STAT_POINTS - allocatedTotal;\n  }, []);\n\n  const [stats, setStats] = useState<CharacterStats>(() => {\n    const characterContextStats = state.character?.stats;\n    const initial = characterContextStats ? { ...defaultInitialStats, ...characterContextStats } : { ...defaultInitialStats };\n    if (initial.strength + initial.stamina + initial.wisdom > TOTAL_STAT_POINTS ||\n        initial.strength < MIN_STAT_VALUE || initial.stamina < MIN_STAT_VALUE || initial.wisdom < MIN_STAT_VALUE ) {\n      return { ...defaultInitialStats };\n    }\n    return initial;\n  });\n\n  const [remainingPoints, setRemainingPoints] = useState<number>(() => calculateRemainingPoints(stats));\n  const [statError, setStatError] = useState<string | null>(null);\n  const [isRandomizing, setIsRandomizing] = useState(false);\n  const [randomizationComplete, setRandomizationComplete] = useState(false);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n   const { register, handleSubmit, formState, reset, watch, setValue, trigger, getValues } = useForm<FormData>({\n     resolver: zodResolver(combinedSchema),\n     mode: \"onChange\", \n     defaultValues: staticDefaultValues,\n   });\n   const { errors, isValid: formIsValid, isDirty, dirtyFields } = formState;\n\n\n  useEffect(() => {\n    const newAdvType = state.adventureSettings.adventureType;\n    const newOriginType = state.adventureSettings.characterOriginType;\n    let needsValidationTrigger = false;\n\n    if (currentGlobalAdventureType !== newAdvType) {\n      currentGlobalAdventureType = newAdvType;\n      needsValidationTrigger = true;\n    }\n    if (currentGlobalCharacterOriginType !== newOriginType) {\n      currentGlobalCharacterOriginType = newOriginType;\n      needsValidationTrigger = true;\n    }\n\n    if (needsValidationTrigger && formRef.current) { \n      trigger();\n    }\n  }, [state.adventureSettings.adventureType, state.adventureSettings.characterOriginType, trigger]);\n\n\n  useEffect(() => {\n    if (isRandomizing || isGenerating) return;\n\n    const newFormValues: Partial<FormData> = { creationType };\n    const isImmersedMode = state.adventureSettings.adventureType === \"Immersed\";\n    const isOriginalCharacterImmersed = isImmersedMode && state.adventureSettings.characterOriginType === \"original\";\n\n    if (state.character) {\n      newFormValues.name = state.character.name || \"\";\n      newFormValues.class = state.character.class || \"\";\n      newFormValues.traits = Array.isArray(state.character.traits) ? state.character.traits.join(', ') : \"\";\n      newFormValues.knowledge = Array.isArray(state.character.knowledge) ? state.character.knowledge.join(', ') : \"\";\n      newFormValues.background = state.character.background || \"\";\n      newFormValues.description = state.character.aiGeneratedDescription || state.character.description || \"\";\n    }\n\n    if (isOriginalCharacterImmersed && state.adventureSettings.playerCharacterConcept && !dirtyFields.description) {\n      newFormValues.description = state.adventureSettings.playerCharacterConcept;\n    }\n    \n    if (isImmersedMode) {\n        newFormValues.class = \"\"; // Class is not user-defined for Immersed\n    } else if (!dirtyFields.class && !newFormValues.class) {\n        newFormValues.class = \"Adventurer\";\n    }\n    \n    const currentFormState = getValues();\n    if (!_.isEqual(newFormValues, _.pick(currentFormState, Object.keys(newFormValues) as Array<keyof FormData>)) || creationType !== currentFormState.creationType) {\n        reset(newFormValues, { keepDirtyValues: true, keepValues: true });\n        setTimeout(() => trigger(), 50);\n    }\n\n  }, [\n    state.character, state.adventureSettings.adventureType, state.adventureSettings.characterOriginType,\n    state.adventureSettings.playerCharacterConcept, creationType,\n    reset, getValues, trigger, isDirty, dirtyFields, isRandomizing, isGenerating\n  ]);\n\n\n  const handleStatChange = useCallback((newStats: CharacterStats) => {\n    const newRemaining = calculateRemainingPoints(newStats);\n    setStats(newStats);\n    setRemainingPoints(newRemaining);\n\n    if (newRemaining < 0) {\n      setStatError(`${Math.abs(newRemaining)} point(s) over limit.`);\n    } else if (newRemaining > 0) {\n      setStatError(null); \n    } else { \n      setStatError(null); \n    }\n  }, [calculateRemainingPoints]);\n\n\n  const randomizeStats = useCallback(() => {\n    let pointsLeft = TOTAL_STAT_POINTS;\n    const newAllocatedStats: Pick<CharacterStats, 'strength' | 'stamina' | 'wisdom'> = {\n      strength: MIN_STAT_VALUE,\n      stamina: MIN_STAT_VALUE,\n      wisdom: MIN_STAT_VALUE,\n    };\n    pointsLeft -= (MIN_STAT_VALUE * 3);\n\n    const allocatedStatKeys: (keyof typeof newAllocatedStats)[] = ['strength', 'stamina', 'wisdom'];\n\n    while (pointsLeft > 0) {\n      const availableKeys = allocatedStatKeys.filter(key => newAllocatedStats[key] < MAX_STAT_VALUE);\n      if (availableKeys.length === 0) break; \n      const randomKey = availableKeys[Math.floor(Math.random() * availableKeys.length)];\n      newAllocatedStats[randomKey]++;\n      pointsLeft--;\n    }\n    \n    let currentTotal = newAllocatedStats.strength + newAllocatedStats.stamina + newAllocatedStats.wisdom;\n    if (currentTotal !== TOTAL_STAT_POINTS) {\n        let diff = TOTAL_STAT_POINTS - currentTotal;\n        const sortedByVal = allocatedStatKeys.sort((a,b) => newAllocatedStats[a] - newAllocatedStats[b]);\n\n        while(diff !== 0 && sortedByVal.length > 0) {\n            const keyToAdjust = diff > 0 ? sortedByVal[0] : sortedByVal[sortedByVal.length -1]; \n            const change = Math.sign(diff);\n            if ((change > 0 && newAllocatedStats[keyToAdjust] < MAX_STAT_VALUE) || (change < 0 && newAllocatedStats[keyToAdjust] > MIN_STAT_VALUE)) {\n                newAllocatedStats[keyToAdjust] += change;\n                diff -= change;\n            } else { \n                if (diff > 0) sortedByVal.shift(); else sortedByVal.pop();\n            }\n        }\n    }\n\n    const finalStats: CharacterStats = { ...defaultInitialStats, ...newAllocatedStats };\n    handleStatChange(finalStats);\n  }, [handleStatChange]);\n\n const randomizeAll = useCallback(async () => {\n     setIsRandomizing(true);\n     setRandomizationComplete(false);\n     setError(null);\n     \n     const randomNames = [\"Anya\", \"Borin\", \"Carys\", \"Darian\", \"Elara\", \"Fendrel\", \"Gorok\", \"Silas\", \"Lyra\", \"Roric\"];\n     const randomClasses = [\"Warrior\", \"Rogue\", \"Mage\", \"Scout\", \"Scholar\", \"Wanderer\", \"Guard\", \"Tinkerer\", \"Healer\", \"Bard\", \"Adventurer\"];\n     const randomTraitsPool = [\"Brave\", \"Curious\", \"Cautious\", \"Impulsive\", \"Loyal\", \"Clever\", \"Resourceful\", \"Quiet\", \"Stern\", \"Generous\", \"Witty\", \"Pessimistic\"];\n     const randomKnowledgePool = [\"Herbalism\", \"Local Lore\", \"Survival\", \"Trading\", \"Ancient Runes\", \"Beasts\", \"Smithing\", \"First Aid\", \"Navigation\", \"City Secrets\"];\n     const randomBackgrounds = [\"Farmer\", \"Orphan\", \"Noble Exile\", \"Street Urchin\", \"Acolyte\", \"Guard\", \"Merchant's Child\", \"Hermit\", \"Former Soldier\", \"Traveling Minstrel\"];\n     const randomDescriptions = [\n         \"A weary traveler, eyes sharp as a hawk, their cloak patched from countless journeys, forever seeking forgotten paths and lost knowledge.\",\n         \"A cheerful youth hailing from a small, secluded village, somewhat naive to the wider world but brimming with an infectious eagerness for adventure.\",\n         \"A stern and reserved individual, a faded scar across their cheek tells a silent story of a past they refuse to speak of.\",\n         \"A dedicated scholar, almost comically obsessed with forgotten lore and ancient prophecies, rarely seen without a satchel overflowing with dusty tomes and cryptic maps.\",\n         \"A skilled artisan, hands calloused yet remarkably deft, always ready to craft, repair, or ingeniously repurpose whatever materials are at hand.\"\n     ];\n\n     const name = randomNames[Math.floor(Math.random() * randomNames.length)];\n     const currentAdvType = state.adventureSettings.adventureType;\n     const isImmersedOriginal = currentAdvType === \"Immersed\" && state.adventureSettings.characterOriginType === \"original\";\n     \n     const fieldsToSet: Partial<FormData> = { name };\n     fieldsToSet.creationType = creationType; \n\n     if (creationType === 'basic') {\n         fieldsToSet.class = (currentAdvType !== \"Immersed\")\n                           ? randomClasses[Math.floor(Math.random() * randomClasses.length)]\n                           : \"\";\n         fieldsToSet.traits = randomTraitsPool.sort(() => 0.5 - Math.random()).slice(0, Math.floor(Math.random() * 3) + 2).join(', ');\n         fieldsToSet.knowledge = randomKnowledgePool.sort(() => 0.5 - Math.random()).slice(0, Math.floor(Math.random() * 3) + 1).join(', ');\n         fieldsToSet.background = randomBackgrounds[Math.floor(Math.random() * randomBackgrounds.length)];\n         fieldsToSet.description = randomDescriptions[Math.floor(Math.random() * randomDescriptions.length)];\n     } else { \n         let desc = randomDescriptions[Math.floor(Math.random() * randomDescriptions.length)];\n         if (isImmersedOriginal && state.adventureSettings.playerCharacterConcept) {\n             desc = `An original character for ${state.adventureSettings.universeName || 'chosen universe'}: A ${randomBackgrounds[Math.floor(Math.random() * randomBackgrounds.length)]} named ${name}. ${desc}`;\n         }\n         fieldsToSet.description = desc;\n         fieldsToSet.class = (currentAdvType !== \"Immersed\") ? \"Adventurer\" : \"\";\n         fieldsToSet.traits = randomTraitsPool.sort(() => 0.5 - Math.random()).slice(0, Math.floor(Math.random() * 2) +1).join(', ');\n         fieldsToSet.knowledge = randomKnowledgePool.sort(() => 0.5 - Math.random()).slice(0, Math.floor(Math.random()*2)).join(', ');\n         fieldsToSet.background = randomBackgrounds[Math.floor(Math.random() * randomBackgrounds.length)];\n     }\n     \n     for (const key in fieldsToSet) {\n         setValue(key as keyof FormData, fieldsToSet[key as keyof FormData] as any, { shouldDirty: true, shouldValidate: true });\n     }\n\n     randomizeStats();\n     await new Promise(res => setTimeout(res, 50)); \n     \n     setIsRandomizing(false);\n     setRandomizationComplete(true);\n     toast({ title: \"Character Randomized!\", description: `Created a new character: ${name}. Review and adjust as needed.` });\n     setTimeout(() => setRandomizationComplete(false), 1200);\n     trigger(); \n }, [creationType, randomizeStats, setValue, state.adventureSettings.adventureType, state.adventureSettings.characterOriginType, state.adventureSettings.universeName, state.adventureSettings.playerCharacterConcept, toast, trigger]);\n\n\n  const handleGenerateDescription = useCallback(async () => {\n     await trigger([\"name\", \"description\"]); \n     const currentFormValues = getValues();\n     const currentName = currentFormValues.name;\n     const currentDescValue = currentFormValues.description;\n\n     const currentAdvType = state.adventureSettings.adventureType;\n     const universeNameForAI = currentAdvType === \"Immersed\" ? state.adventureSettings.universeName : undefined;\n     const playerCharacterConceptForAI = (currentAdvType === \"Immersed\" && state.adventureSettings.characterOriginType === \"original\")\n                                          ? (currentDescValue || state.adventureSettings.playerCharacterConcept)\n                                          : undefined;\n\n     if (!currentName?.trim()) {\n         toast({ title: \"Name Required\", description: \"Please enter a character name.\", variant: \"destructive\" }); return;\n     }\n     const minDescLength = (currentAdvType === \"Immersed\" && state.adventureSettings.characterOriginType === \"original\") ? 10 : 10;\n     if (!currentDescValue || currentDescValue.trim().length < minDescLength) {\n        let msg = `Description (min ${minDescLength} chars) is required for AI profile generation.`;\n        if (currentAdvType === \"Immersed\" && state.adventureSettings.characterOriginType === \"original\") {\n            msg = `Original Character Concept (min ${minDescLength} chars in description box) is required.`;\n        }\n        toast({ title: \"Input Required\", description: msg, variant: \"destructive\" }); return;\n     }\n\n     setError(null); setIsGenerating(true);\n     try {\n        const aiInput = {\n             characterDescription: currentDescValue,\n             isImmersedMode: currentAdvType === \"Immersed\",\n             universeName: universeNameForAI,\n             playerCharacterConcept: playerCharacterConceptForAI,\n             userApiKey: state.userGoogleAiApiKey,\n        };\n        const result: GenerateCharacterDescriptionOutput = await generateCharacterDescription(aiInput);\n        \n        setValue(\"description\", result.detailedDescription || currentDescValue, {shouldDirty: true, shouldValidate: true});\n        setValue(\"traits\", (Array.isArray(result.inferredTraits) ? result.inferredTraits.join(', ') : result.inferredTraits) || currentFormValues.traits, {shouldDirty: true, shouldValidate: true});\n        setValue(\"knowledge\", (Array.isArray(result.inferredKnowledge) ? result.inferredKnowledge.join(', ') : result.inferredKnowledge) || currentFormValues.knowledge, {shouldDirty: true, shouldValidate: true});\n        setValue(\"background\", result.inferredBackground || currentFormValues.background, {shouldDirty: true, shouldValidate: true});\n\n        if (currentAdvType !== \"Immersed\") {\n            setValue(\"class\", result.inferredClass || \"Adventurer\", {shouldDirty: true, shouldValidate: true});\n        } else {\n            setValue(\"class\", result.inferredClass || \"Immersed Protagonist\", {shouldDirty: true, shouldValidate: true});\n        }\n        \n        dispatch({ type: \"SET_AI_DESCRIPTION\", payload: result.detailedDescription });\n        toast({ title: \"AI Profile Generated!\", description: \"Character details updated.\"});\n        await trigger(); \n     } catch (err: unknown) {\n       console.error(\"CharacterCreation: AI generation failed:\", err);\n       setError(\"Failed to generate profile. The AI might be busy or encountered an error.\");\n       const errorMessage = (err instanceof Error) ? err.message : String(err);\n       toast({ title: \"AI Generation Failed\", description: errorMessage, variant: \"destructive\" });\n     } finally { setIsGenerating(false); }\n   }, [getValues, setValue, trigger, dispatch, toast, state.adventureSettings, state.userGoogleAiApiKey]);\n\n\n  const onSubmit = (data: FormData) => {\n     setError(null);\n     if (remainingPoints !== 0) {\n         setStatError(`Please allocate all ${TOTAL_STAT_POINTS} stat points. ${remainingPoints > 0 ? `${remainingPoints} point(s) remaining.` : `${Math.abs(remainingPoints)} point(s) over limit.`}`);\n         toast({ title: \"Stat Allocation Incomplete\", description: statError || \"Stat allocation issue.\", variant: \"destructive\"}); return;\n     }\n     setStatError(null); \n\n    trigger().then(isFormCurrentlyValid => {\n        if (!isFormCurrentlyValid) {\n            const fieldErrorMessages = Object.entries(errors).map(([key, err]) => {\n                if (err && typeof err === 'object' && 'message' in err) {\n                    return `${key}: ${(err as any).message}`;\n                }\n                return null;\n            }).filter(Boolean);\n            const flatErrors = Object.values(errors).map(e => (e as any)?.message).filter(Boolean).join('; ');\n            toast({ title: \"Validation Error\", description: fieldErrorMessages.join('; ') || flatErrors || \"Please correct the highlighted fields.\", variant: \"destructive\"});\n            return;\n        }\n\n        const finalName = data.name;\n        let finalClass = data.class || \"Adventurer\";\n        if (state.adventureSettings.adventureType === \"Immersed\") {\n            finalClass = data.class || state.character?.class || state.adventureSettings.playerCharacterConcept || \"Immersed Protagonist\";\n        }\n\n        const finalTraits: string[] = (data.traits || \"\").split(',').map(t => t.trim()).filter(Boolean);\n        const finalKnowledge: string[] = (data.knowledge || \"\").split(',').map(k => k.trim()).filter(Boolean);\n        const finalBackground = data.background ?? \"\";\n        const finalDescription = data.description || \"\";\n        const finalAiGeneratedDescription = state.character?.aiGeneratedDescription === finalDescription ? state.character.aiGeneratedDescription : undefined;\n\n        const characterDataToDispatch: Partial<Character> = {\n            name: finalName, class: finalClass, description: finalDescription, traits: finalTraits, knowledge: finalKnowledge,\n            background: finalBackground, stats: { ...stats }, \n            aiGeneratedDescription: finalAiGeneratedDescription,\n        };\n\n        dispatch({ type: \"CREATE_CHARACTER\", payload: characterDataToDispatch });\n\n        if (state.adventureSettings.adventureType === \"Randomized\") {\n            dispatch({ type: \"SET_GAME_STATUS\", payload: \"AdventureSetup\" });\n        } else { // This handles the \"Custom\" flow correctly\n            dispatch({ type: \"START_GAMEPLAY\" });\n        }\n     });\n   };\n\n  const handleBackToMenu = () => {\n    dispatch({ type: \"RESET_GAME\" });\n  };\n\n  const showCharacterDefinitionForms = useMemo(() => {\n    const advType = state.adventureSettings.adventureType;\n    const originType = state.adventureSettings.characterOriginType;\n    return advType !== \"Immersed\" || (advType === \"Immersed\" && originType === \"original\");\n  }, [state.adventureSettings.adventureType, state.adventureSettings.characterOriginType]);\n\n  const isProceedButtonDisabled = useMemo(() => {\n    const nameValid = !!watch(\"name\")?.trim();\n    const generalDisabled = isGenerating || isRandomizing || remainingPoints !== 0 || (statError !== null && remainingPoints !==0);\n    \n    let specificFormFieldsValid = true;\n    if(showCharacterDefinitionForms) {\n        specificFormFieldsValid = formIsValid; \n    }\n    return generalDisabled || !nameValid || !specificFormFieldsValid;\n  }, [isGenerating, isRandomizing, remainingPoints, statError, formIsValid, errors, watch, showCharacterDefinitionForms]);\n\n\n  useEffect(() => {\n    currentGlobalAdventureType = state.adventureSettings.adventureType;\n    currentGlobalCharacterOriginType = state.adventureSettings.characterOriginType;\n    trigger(); \n  }, [state.adventureSettings.adventureType, state.adventureSettings.characterOriginType, trigger]);\n\n\n  if (state.adventureSettings.adventureType === \"Immersed\" && state.adventureSettings.characterOriginType === \"existing\" && !showCharacterDefinitionForms) {\n    return (\n        <div className=\"flex flex-col items-center justify-center min-h-screen p-4 bg-background\">\n            <CardboardCard className=\"w-full max-w-md text-center\">\n                <CardHeader><CardTitle className=\"text-2xl flex items-center justify-center gap-2\"><Loader2 className=\"w-6 h-6 animate-spin\"/> Loading Character...</CardTitle></CardHeader>\n                <CardContent>\n                    <p className=\"text-muted-foreground\">Preparing your adventure as {state.adventureSettings.playerCharacterConcept} in {state.adventureSettings.universeName}.</p>\n                    <p className=\"text-xs text-muted-foreground mt-2\">You should be taken to the game shortly.</p>\n                </CardContent>\n                 <CardFooter>\n                    <Button onClick={handleBackToMenu} className=\"w-full\" variant=\"outline\">Back to Main Menu</Button>\n                </CardFooter>\n            </CardboardCard>\n        </div>\n    );\n  }\n  \n  const proceedButtonText = state.adventureSettings.adventureType === \"Randomized\"\n      ? \"Proceed to Adventure Setup\"\n      : \"Start Adventure\";\n\n  return (\n    <div className=\"flex flex-col items-center justify-center min-h-screen p-4 bg-background\">\n        <form onSubmit={handleSubmit(onSubmit)} className=\"w-full max-w-2xl\" ref={formRef}>\n            <CardboardCard className=\"shadow-xl border-2 border-foreground/20\">\n                <CardHeader className=\"border-b border-foreground/10 pb-4\">\n                    <CardTitle className=\"text-3xl font-bold text-center flex items-center justify-center gap-2\">\n                        <User className=\"w-7 h-7\" /> Create Your Adventurer\n                    </CardTitle>\n                     {state.adventureSettings.adventureType === \"Immersed\" && state.adventureSettings.characterOriginType === \"original\" && (\n                        <p className=\"text-sm text-center text-muted-foreground mt-1\"> Mode: Immersed (Original Character) in <span className=\"font-semibold\">{state.adventureSettings.universeName || \"chosen universe\"}</span> <br/>Your Initial Concept: <span className=\"italic\">{state.adventureSettings.playerCharacterConcept || watch(\"description\")}</span> </p>\n                    )}\n                     {(state.adventureSettings.adventureType === \"Randomized\" || state.adventureSettings.adventureType === \"Custom\") && (\n                         <p className=\"text-sm text-center text-muted-foreground mt-1\"> Mode: {state.adventureSettings.adventureType} Adventure </p>\n                     )}\n                </CardHeader>\n                <CardContent className=\"space-y-6 pt-6\">\n                    {error && ( <Alert variant=\"destructive\" className=\"mb-4\"> <AlertCircle className=\"h-4 w-4\" /> <AlertTitle>Error</AlertTitle> <AlertDescription>{error}</AlertDescription> </Alert> )}\n\n                    {showCharacterDefinitionForms ? (\n                        <Tabs value={creationType} onValueChange={(value) => {\n                            const newCreationType = value as \"basic\" | \"text\";\n                            setCreationType(newCreationType);\n                            setValue(\"creationType\", newCreationType, { shouldValidate: true }); \n                        }} className=\"w-full\">\n                            <TabsList className=\"grid w-full grid-cols-2\">\n                                <TabsTrigger value=\"basic\">Basic Fields</TabsTrigger>\n                                <TabsTrigger value=\"text\">Text Description (AI Assist)</TabsTrigger>\n                            </TabsList>\n                            <TabsContent value=\"basic\" className=\"space-y-4 pt-4 border rounded-md p-4 mt-2 bg-card/50\">\n                                <BasicCharacterForm register={register as UseFormRegister<any>} errors={errors as FieldErrors<any>} adventureType={state.adventureSettings.adventureType} />\n                            </TabsContent>\n                            <TabsContent value=\"text\" className=\"space-y-4 pt-4 border rounded-md p-4 mt-2 bg-card/50\">\n                                <TextCharacterForm\n                                    register={register as UseFormRegister<any>}\n                                    errors={errors as FieldErrors<any>}\n                                    onGenerateDescription={handleGenerateDescription}\n                                    isGenerating={isGenerating}\n                                    watchedName={watch(\"name\")} \n                                    watchedDescription={watch(\"description\")}\n                                />\n                            </TabsContent>\n                        </Tabs>\n                    ) : (\n                        <Alert>\n                            <User className=\"h-4 w-4\" />\n                            <AlertTitle>Stat Allocation Only</AlertTitle>\n                            <AlertDescription>\n                                Character details are pre-defined or AI-generated for this mode. Please allocate stats.\n                            </AlertDescription>\n                        </Alert>\n                    )}\n                    <Separator />\n\n                    <div className=\"space-y-4\">\n                        <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-2 gap-2\">\n                            <h3 className=\"text-xl font-semibold flex items-center gap-1.5\"><TrendingUp className=\"w-5 h-5\"/>Allocate Stats ({stats.strength + stats.stamina + stats.wisdom} / {TOTAL_STAT_POINTS} Points)</h3>\n                             <p className={`text-sm font-medium ${statError && remainingPoints !==0 ? 'text-destructive' : (remainingPoints === 0 ? 'text-green-600' : 'text-muted-foreground')}`}>\n                                {(statError && remainingPoints !==0) ? ( <span className=\"flex items-center gap-1\"> <AlertCircle className=\"h-4 w-4\" /> {statError} </span>\n                                ) : remainingPoints === 0 ? ( <span className=\"flex items-center gap-1 text-green-600\"> <CheckCircle className=\"h-4 w-4\" /> All points allocated! </span>\n                                ) : ( `${remainingPoints} point(s) remaining.` )}\n                            </p>\n                        </div>\n                        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                            <StatAllocationInput\n                                label=\"Strength\"\n                                statKey=\"strength\"\n                                value={stats.strength}\n                                onChange={(key, val) => handleStatChange({...stats, [key]: val})}\n                                Icon={HandDrawnStrengthIcon}\n                                disabled={isGenerating || isRandomizing}\n                                remainingPoints={remainingPoints}\n                            />\n                            <StatAllocationInput\n                                label=\"Stamina\"\n                                statKey=\"stamina\"\n                                value={stats.stamina}\n                                onChange={(key, val) => handleStatChange({...stats, [key]: val})}\n                                Icon={HandDrawnStaminaIcon}\n                                disabled={isGenerating || isRandomizing}\n                                remainingPoints={remainingPoints}\n                            />\n                            <StatAllocationInput\n                                label=\"Wisdom\"\n                                statKey=\"wisdom\"\n                                value={stats.wisdom}\n                                onChange={(key, val) => handleStatChange({...stats, [key]: val})}\n                                Icon={HandDrawnWisdomIcon} \n                                disabled={isGenerating || isRandomizing}\n                                remainingPoints={remainingPoints}\n                            />\n                        </div>\n                    </div>\n\n                </CardContent>\n                <CardFooter className=\"flex flex-col sm:flex-row justify-between gap-4 pt-6 border-t border-foreground/10\">\n                     <Button type=\"button\" onClick={handleBackToMenu} variant=\"outline\" aria-label=\"Back to Main Menu\" className=\"w-full sm:w-auto\">\n                        <LogOut className=\"mr-2 h-4 w-4\" /> Back to Main Menu\n                     </Button>\n                    <div className=\"flex flex-col sm:flex-row gap-2 w-full sm:w-auto\">\n                        <TooltipProvider>\n                            <Tooltip>\n                                <TooltipTrigger asChild>\n                                     <Button\n                                        type=\"button\"\n                                        onClick={randomizeAll}\n                                        variant=\"secondary\"\n                                        aria-label=\"Randomize All Character Fields and Stats\"\n                                        className=\"relative overflow-hidden w-full sm:w-auto\"\n                                        disabled={isRandomizing || isGenerating || !showCharacterDefinitionForms} \n                                    >\n                                        <RotateCcw className={`mr-2 h-4 w-4 ${isRandomizing ? 'animate-spin' : ''}`} />\n                                        {isRandomizing ? 'Randomizing...' : 'Randomize All'}\n                                        {randomizationComplete && <CheckCircle className=\"absolute right-2 h-4 w-4 text-green-500 opacity-100 transition-opacity duration-300\" />}\n                                    </Button>\n                                </TooltipTrigger>\n                                <TooltipContent>\n                                    <p>Generate random character details and stats.</p>\n                                    {!showCharacterDefinitionForms && <p className=\"text-xs text-muted-foreground\">(Character details pre-defined/AI-gen for this mode.)</p>}\n                                </TooltipContent>\n                            </Tooltip>\n                        </TooltipProvider>\n                        <Button\n                            type=\"submit\"\n                            className=\"bg-accent hover:bg-accent/90 text-accent-foreground w-full sm:w-auto\"\n                            disabled={isProceedButtonDisabled}\n                            aria-label=\"Save character and proceed\"\n                        >\n                            {state.adventureSettings.adventureType === \"Randomized\" ? <ArrowRight className=\"mr-2 h-4 w-4\"/> : <Save className=\"mr-2 h-4 w-4\"/>}\n                            {proceedButtonText}\n                        </Button>\n                    </div>\n                </CardFooter>\n            </CardboardCard>\n        </form>\n    </div>\n  );\n}\n"],"names":[],"mappings":"AAAA,+CAA+C;;;;;AAG/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAxBA;;;;;;;;;;;;;;;;;;;;;;;AA0BA,8EAA8E;AAC9E,IAAI,6BAAmD;AACvD,IAAI,mCAAwE;AAE5E,oCAAoC;AACpC,MAAM,sBAAsB,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,EAAE;IACnC,MAAM,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,GAAG,CAAC,GAAG,+BAA+B,GAAG,CAAC,IAAI;AACjE;AAEA,MAAM,yBAAyB,CAAC,KAAa,UAC3C,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IACL,SAAS,CAAC,CAAA,MAAO,QAAQ,aAAa,QAAQ,KAAK,EAAE,GAAG,IAAI,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC,UACjG,MAAM,CAAC,CAAA,MAAO,IAAI,MAAM,IAAI,KAAK;QAAE;IAAQ,GAC3C,SAAS,CAAC,CAAA,MAAO,IAAI,IAAI,CAAC,OAAO,wCAAwC;KACzE,QAAQ,GACR,SAAS,CAAC,CAAA,MAAO,OAAO,KAAK,2CAA2C;AAE5E,MAAM,4BAA4B;IAChC,cAAc,CAAA,GAAA,oIAAA,CAAA,UAAS,AAAD,EAAE;IACxB,OAAO,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,GAAG,CAAC,IAAI,iCAAiC,QAAQ,GAAG,SAAS,CAAC,CAAA,MAAO,OAAO;IAC9F,QAAQ,uBAAuB,GAAG;IAClC,WAAW,uBAAuB,GAAG;IACrC,YAAY,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,GAAG,CAAC,KAAK,kCAAkC,QAAQ,GAAG,SAAS,CAAC,CAAA,MAAO,OAAO;IACrG,aAAa,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,QAAQ,GAAG,SAAS,CAAC,CAAA,MAAO,OAAO;AAC7D;AACA,MAAM,sBAAsB,oBAAoB,MAAM,CAAC;AAEvD,MAAM,2BAA2B;IAC/B,cAAc,CAAA,GAAA,oIAAA,CAAA,UAAS,AAAD,EAAE;IACxB,aAAa,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,QAAQ;IAChC,8FAA8F;IAC9F,OAAO,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,GAAG,CAAC,IAAI,iCAAiC,QAAQ,GAAG,SAAS,CAAC,CAAA,MAAO,OAAO;IAC9F,QAAQ,uBAAuB,GAAG;IAClC,WAAW,uBAAuB,GAAG;IACrC,YAAY,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,GAAG,CAAC,KAAK,kCAAkC,QAAQ,GAAG,SAAS,CAAC,CAAA,MAAO,OAAO;AACvG;AACA,MAAM,qBAAqB,oBAAoB,MAAM,CAAC;AAEtD,MAAM,iBAAiB,CAAA,GAAA,oIAAA,CAAA,qBAAoB,AAAD,EAAE,gBAAgB;IAC1D;IACA;CACD,EAAE,WAAW,CAAC,CAAC,MAAM;IACpB,MAAM,UAAU;IAChB,MAAM,aAAa;IAEnB,IAAI,KAAK,YAAY,KAAK,SAAS;QACjC,IAAI,YAAY,cAAc,CAAC,CAAC,KAAK,KAAK,IAAI,KAAK,KAAK,CAAC,IAAI,OAAO,EAAE,GAAG;YACvE,IAAI,QAAQ,CAAC;gBAAE,MAAM,oIAAA,CAAA,eAAc,CAAC,MAAM;gBAAE,SAAS;gBAAuD,MAAM;oBAAC;iBAAQ;YAAC;QAC9H;IACF,OAAO,IAAI,KAAK,YAAY,KAAK,QAAQ;QACvC,MAAM,aAAa,KAAK,WAAW,EAAE,OAAO,UAAU;QACtD,MAAM,gBAAgB,AAAC,YAAY,cAAc,eAAe,aAAc,KAAK;QACnF,IAAI,aAAa,eAAe;YAC9B,IAAI,MAAM,CAAC,iBAAiB,EAAE,cAAc,8CAA8C,CAAC;YAC3F,IAAI,YAAY,cAAc,eAAe,YAAY;gBACvD,MAAM,CAAC,gCAAgC,EAAE,cAAc,uCAAuC,CAAC;YACjG,OAAO,IAAI,YAAY,YAAY;gBACjC,iFAAiF;gBAChF,MAAM,CAAC,iBAAiB,EAAE,cAAc,wGAAwG,CAAC;YACpJ;YACA,IAAI,QAAQ,CAAC;gBAAE,MAAM,oIAAA,CAAA,eAAc,CAAC,MAAM;gBAAE,SAAS;gBAAK,MAAM;oBAAC;iBAAc;YAAC;QAClF;IACF;AACF;AAIA,MAAM,sBAAgC;IAClC,cAAc;IACd,MAAM;IACN,OAAO;IACP,QAAQ;IACR,WAAW;IACX,YAAY;IACZ,aAAa;AACjB;AAGO,SAAS;IACd,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,CAAA,GAAA,8HAAA,CAAA,UAAO,AAAD;IAClC,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,4HAAA,CAAA,WAAQ,AAAD;IACzB,MAAM,UAAU,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAmB;IAExC,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAoB;IAEnE,MAAM,2BAA2B,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE,CAAC;QAC5C,MAAM,iBAAiB,aAAa,QAAQ,GAAG,aAAa,OAAO,GAAG,aAAa,MAAM;QACzF,OAAO,uHAAA,CAAA,oBAAiB,GAAG;IAC7B,GAAG,EAAE;IAEL,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAkB;QACjD,MAAM,wBAAwB,MAAM,SAAS,EAAE;QAC/C,MAAM,UAAU,wBAAwB;YAAE,GAAG,0IAAA,CAAA,wBAAmB;YAAE,GAAG,qBAAqB;QAAC,IAAI;YAAE,GAAG,0IAAA,CAAA,wBAAmB;QAAC;QACxH,IAAI,QAAQ,QAAQ,GAAG,QAAQ,OAAO,GAAG,QAAQ,MAAM,GAAG,uHAAA,CAAA,oBAAiB,IACvE,QAAQ,QAAQ,GAAG,uHAAA,CAAA,iBAAc,IAAI,QAAQ,OAAO,GAAG,uHAAA,CAAA,iBAAc,IAAI,QAAQ,MAAM,GAAG,uHAAA,CAAA,iBAAc,EAAG;YAC7G,OAAO;gBAAE,GAAG,0IAAA,CAAA,wBAAmB;YAAC;QAClC;QACA,OAAO;IACT;IAEA,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAU,IAAM,yBAAyB;IAC9F,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAC1D,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnD,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnE,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACjD,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAEjD,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,CAAA,GAAA,8JAAA,CAAA,UAAO,AAAD,EAAY;QAC1G,UAAU,CAAA,GAAA,8JAAA,CAAA,cAAW,AAAD,EAAE;QACtB,MAAM;QACN,eAAe;IACjB;IACA,MAAM,EAAE,MAAM,EAAE,SAAS,WAAW,EAAE,OAAO,EAAE,WAAW,EAAE,GAAG;IAGhE,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,aAAa,MAAM,iBAAiB,CAAC,aAAa;QACxD,MAAM,gBAAgB,MAAM,iBAAiB,CAAC,mBAAmB;QACjE,IAAI,yBAAyB;QAE7B,IAAI,+BAA+B,YAAY;YAC7C,6BAA6B;YAC7B,yBAAyB;QAC3B;QACA,IAAI,qCAAqC,eAAe;YACtD,mCAAmC;YACnC,yBAAyB;QAC3B;QAEA,IAAI,0BAA0B,QAAQ,OAAO,EAAE;YAC7C;QACF;IACF,GAAG;QAAC,MAAM,iBAAiB,CAAC,aAAa;QAAE,MAAM,iBAAiB,CAAC,mBAAmB;QAAE;KAAQ;IAGhG,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,iBAAiB,cAAc;QAEnC,MAAM,gBAAmC;YAAE;QAAa;QACxD,MAAM,iBAAiB,MAAM,iBAAiB,CAAC,aAAa,KAAK;QACjE,MAAM,8BAA8B,kBAAkB,MAAM,iBAAiB,CAAC,mBAAmB,KAAK;QAEtG,IAAI,MAAM,SAAS,EAAE;YACnB,cAAc,IAAI,GAAG,MAAM,SAAS,CAAC,IAAI,IAAI;YAC7C,cAAc,KAAK,GAAG,MAAM,SAAS,CAAC,KAAK,IAAI;YAC/C,cAAc,MAAM,GAAG,MAAM,OAAO,CAAC,MAAM,SAAS,CAAC,MAAM,IAAI,MAAM,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ;YACnG,cAAc,SAAS,GAAG,MAAM,OAAO,CAAC,MAAM,SAAS,CAAC,SAAS,IAAI,MAAM,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ;YAC5G,cAAc,UAAU,GAAG,MAAM,SAAS,CAAC,UAAU,IAAI;YACzD,cAAc,WAAW,GAAG,MAAM,SAAS,CAAC,sBAAsB,IAAI,MAAM,SAAS,CAAC,WAAW,IAAI;QACvG;QAEA,IAAI,+BAA+B,MAAM,iBAAiB,CAAC,sBAAsB,IAAI,CAAC,YAAY,WAAW,EAAE;YAC7G,cAAc,WAAW,GAAG,MAAM,iBAAiB,CAAC,sBAAsB;QAC5E;QAEA,IAAI,gBAAgB;YAChB,cAAc,KAAK,GAAG,IAAI,yCAAyC;QACvE,OAAO,IAAI,CAAC,YAAY,KAAK,IAAI,CAAC,cAAc,KAAK,EAAE;YACnD,cAAc,KAAK,GAAG;QAC1B;QAEA,MAAM,mBAAmB;QACzB,IAAI,CAAC,gIAAA,CAAA,UAAC,CAAC,OAAO,CAAC,eAAe,gIAAA,CAAA,UAAC,CAAC,IAAI,CAAC,kBAAkB,OAAO,IAAI,CAAC,oBAA6C,iBAAiB,iBAAiB,YAAY,EAAE;YAC5J,MAAM,eAAe;gBAAE,iBAAiB;gBAAM,YAAY;YAAK;YAC/D,WAAW,IAAM,WAAW;QAChC;IAEF,GAAG;QACD,MAAM,SAAS;QAAE,MAAM,iBAAiB,CAAC,aAAa;QAAE,MAAM,iBAAiB,CAAC,mBAAmB;QACnG,MAAM,iBAAiB,CAAC,sBAAsB;QAAE;QAChD;QAAO;QAAW;QAAS;QAAS;QAAa;QAAe;KACjE;IAGD,MAAM,mBAAmB,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE,CAAC;QACpC,MAAM,eAAe,yBAAyB;QAC9C,SAAS;QACT,mBAAmB;QAEnB,IAAI,eAAe,GAAG;YACpB,aAAa,GAAG,KAAK,GAAG,CAAC,cAAc,qBAAqB,CAAC;QAC/D,OAAO,IAAI,eAAe,GAAG;YAC3B,aAAa;QACf,OAAO;YACL,aAAa;QACf;IACF,GAAG;QAAC;KAAyB;IAG7B,MAAM,iBAAiB,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QACjC,IAAI,aAAa,uHAAA,CAAA,oBAAiB;QAClC,MAAM,oBAA6E;YACjF,UAAU,uHAAA,CAAA,iBAAc;YACxB,SAAS,uHAAA,CAAA,iBAAc;YACvB,QAAQ,uHAAA,CAAA,iBAAc;QACxB;QACA,cAAe,uHAAA,CAAA,iBAAc,GAAG;QAEhC,MAAM,oBAAwD;YAAC;YAAY;YAAW;SAAS;QAE/F,MAAO,aAAa,EAAG;YACrB,MAAM,gBAAgB,kBAAkB,MAAM,CAAC,CAAA,MAAO,iBAAiB,CAAC,IAAI,GAAG,uHAAA,CAAA,iBAAc;YAC7F,IAAI,cAAc,MAAM,KAAK,GAAG;YAChC,MAAM,YAAY,aAAa,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,cAAc,MAAM,EAAE;YACjF,iBAAiB,CAAC,UAAU;YAC5B;QACF;QAEA,IAAI,eAAe,kBAAkB,QAAQ,GAAG,kBAAkB,OAAO,GAAG,kBAAkB,MAAM;QACpG,IAAI,iBAAiB,uHAAA,CAAA,oBAAiB,EAAE;YACpC,IAAI,OAAO,uHAAA,CAAA,oBAAiB,GAAG;YAC/B,MAAM,cAAc,kBAAkB,IAAI,CAAC,CAAC,GAAE,IAAM,iBAAiB,CAAC,EAAE,GAAG,iBAAiB,CAAC,EAAE;YAE/F,MAAM,SAAS,KAAK,YAAY,MAAM,GAAG,EAAG;gBACxC,MAAM,cAAc,OAAO,IAAI,WAAW,CAAC,EAAE,GAAG,WAAW,CAAC,YAAY,MAAM,GAAE,EAAE;gBAClF,MAAM,SAAS,KAAK,IAAI,CAAC;gBACzB,IAAI,AAAC,SAAS,KAAK,iBAAiB,CAAC,YAAY,GAAG,uHAAA,CAAA,iBAAc,IAAM,SAAS,KAAK,iBAAiB,CAAC,YAAY,GAAG,uHAAA,CAAA,iBAAc,EAAG;oBACpI,iBAAiB,CAAC,YAAY,IAAI;oBAClC,QAAQ;gBACZ,OAAO;oBACH,IAAI,OAAO,GAAG,YAAY,KAAK;yBAAS,YAAY,GAAG;gBAC3D;YACJ;QACJ;QAEA,MAAM,aAA6B;YAAE,GAAG,0IAAA,CAAA,wBAAmB;YAAE,GAAG,iBAAiB;QAAC;QAClF,iBAAiB;IACnB,GAAG;QAAC;KAAiB;IAEtB,MAAM,eAAe,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QAC7B,iBAAiB;QACjB,yBAAyB;QACzB,SAAS;QAET,MAAM,cAAc;YAAC;YAAQ;YAAS;YAAS;YAAU;YAAS;YAAW;YAAS;YAAS;YAAQ;SAAQ;QAC/G,MAAM,gBAAgB;YAAC;YAAW;YAAS;YAAQ;YAAS;YAAW;YAAY;YAAS;YAAY;YAAU;YAAQ;SAAa;QACvI,MAAM,mBAAmB;YAAC;YAAS;YAAW;YAAY;YAAa;YAAS;YAAU;YAAe;YAAS;YAAS;YAAY;YAAS;SAAc;QAC9J,MAAM,sBAAsB;YAAC;YAAa;YAAc;YAAY;YAAW;YAAiB;YAAU;YAAY;YAAa;YAAc;SAAe;QAChK,MAAM,oBAAoB;YAAC;YAAU;YAAU;YAAe;YAAiB;YAAW;YAAS;YAAoB;YAAU;YAAkB;SAAqB;QACxK,MAAM,qBAAqB;YACvB;YACA;YACA;YACA;YACA;SACH;QAED,MAAM,OAAO,WAAW,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,YAAY,MAAM,EAAE;QACxE,MAAM,iBAAiB,MAAM,iBAAiB,CAAC,aAAa;QAC5D,MAAM,qBAAqB,mBAAmB,cAAc,MAAM,iBAAiB,CAAC,mBAAmB,KAAK;QAE5G,MAAM,cAAiC;YAAE;QAAK;QAC9C,YAAY,YAAY,GAAG;QAE3B,IAAI,iBAAiB,SAAS;YAC1B,YAAY,KAAK,GAAG,AAAC,mBAAmB,aACpB,aAAa,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,cAAc,MAAM,EAAE,GAC/D;YACpB,YAAY,MAAM,GAAG,iBAAiB,IAAI,CAAC,IAAM,MAAM,KAAK,MAAM,IAAI,KAAK,CAAC,GAAG,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,KAAK,GAAG,IAAI,CAAC;YACvH,YAAY,SAAS,GAAG,oBAAoB,IAAI,CAAC,IAAM,MAAM,KAAK,MAAM,IAAI,KAAK,CAAC,GAAG,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,KAAK,GAAG,IAAI,CAAC;YAC7H,YAAY,UAAU,GAAG,iBAAiB,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,kBAAkB,MAAM,EAAE;YAChG,YAAY,WAAW,GAAG,kBAAkB,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,mBAAmB,MAAM,EAAE;QACvG,OAAO;YACH,IAAI,OAAO,kBAAkB,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,mBAAmB,MAAM,EAAE;YACpF,IAAI,sBAAsB,MAAM,iBAAiB,CAAC,sBAAsB,EAAE;gBACtE,OAAO,CAAC,0BAA0B,EAAE,MAAM,iBAAiB,CAAC,YAAY,IAAI,kBAAkB,IAAI,EAAE,iBAAiB,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,kBAAkB,MAAM,EAAE,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE,MAAM;YACxM;YACA,YAAY,WAAW,GAAG;YAC1B,YAAY,KAAK,GAAG,AAAC,mBAAmB,aAAc,eAAe;YACrE,YAAY,MAAM,GAAG,iBAAiB,IAAI,CAAC,IAAM,MAAM,KAAK,MAAM,IAAI,KAAK,CAAC,GAAG,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,KAAI,GAAG,IAAI,CAAC;YACtH,YAAY,SAAS,GAAG,oBAAoB,IAAI,CAAC,IAAM,MAAM,KAAK,MAAM,IAAI,KAAK,CAAC,GAAG,KAAK,KAAK,CAAC,KAAK,MAAM,KAAG,IAAI,IAAI,CAAC;YACvH,YAAY,UAAU,GAAG,iBAAiB,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,kBAAkB,MAAM,EAAE;QACpG;QAEA,IAAK,MAAM,OAAO,YAAa;YAC3B,SAAS,KAAuB,WAAW,CAAC,IAAsB,EAAS;gBAAE,aAAa;gBAAM,gBAAgB;YAAK;QACzH;QAEA;QACA,MAAM,IAAI,QAAQ,CAAA,MAAO,WAAW,KAAK;QAEzC,iBAAiB;QACjB,yBAAyB;QACzB,MAAM;YAAE,OAAO;YAAyB,aAAa,CAAC,yBAAyB,EAAE,KAAK,8BAA8B,CAAC;QAAC;QACtH,WAAW,IAAM,yBAAyB,QAAQ;QAClD;IACJ,GAAG;QAAC;QAAc;QAAgB;QAAU,MAAM,iBAAiB,CAAC,aAAa;QAAE,MAAM,iBAAiB,CAAC,mBAAmB;QAAE,MAAM,iBAAiB,CAAC,YAAY;QAAE,MAAM,iBAAiB,CAAC,sBAAsB;QAAE;QAAO;KAAQ;IAGpO,MAAM,4BAA4B,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QAC3C,MAAM,QAAQ;YAAC;YAAQ;SAAc;QACrC,MAAM,oBAAoB;QAC1B,MAAM,cAAc,kBAAkB,IAAI;QAC1C,MAAM,mBAAmB,kBAAkB,WAAW;QAEtD,MAAM,iBAAiB,MAAM,iBAAiB,CAAC,aAAa;QAC5D,MAAM,oBAAoB,mBAAmB,aAAa,MAAM,iBAAiB,CAAC,YAAY,GAAG;QACjG,MAAM,8BAA8B,AAAC,mBAAmB,cAAc,MAAM,iBAAiB,CAAC,mBAAmB,KAAK,aAC9E,oBAAoB,MAAM,iBAAiB,CAAC,sBAAsB,GACnE;QAEvC,IAAI,CAAC,aAAa,QAAQ;YACtB,MAAM;gBAAE,OAAO;gBAAiB,aAAa;gBAAkC,SAAS;YAAc;YAAI;QAC9G;QACA,MAAM,gBAAgB,AAAC,mBAAmB,cAAc,MAAM,iBAAiB,CAAC,mBAAmB,KAAK,aAAc,KAAK;QAC3H,IAAI,CAAC,oBAAoB,iBAAiB,IAAI,GAAG,MAAM,GAAG,eAAe;YACtE,IAAI,MAAM,CAAC,iBAAiB,EAAE,cAAc,8CAA8C,CAAC;YAC3F,IAAI,mBAAmB,cAAc,MAAM,iBAAiB,CAAC,mBAAmB,KAAK,YAAY;gBAC7F,MAAM,CAAC,gCAAgC,EAAE,cAAc,uCAAuC,CAAC;YACnG;YACA,MAAM;gBAAE,OAAO;gBAAkB,aAAa;gBAAK,SAAS;YAAc;YAAI;QACjF;QAEA,SAAS;QAAO,gBAAgB;QAChC,IAAI;YACD,MAAM,UAAU;gBACX,sBAAsB;gBACtB,gBAAgB,mBAAmB;gBACnC,cAAc;gBACd,wBAAwB;gBACxB,YAAY,MAAM,kBAAkB;YACzC;YACA,MAAM,SAA6C,MAAM,CAAA,GAAA,0JAAA,CAAA,+BAA4B,AAAD,EAAE;YAEtF,SAAS,eAAe,OAAO,mBAAmB,IAAI,kBAAkB;gBAAC,aAAa;gBAAM,gBAAgB;YAAI;YAChH,SAAS,UAAU,CAAC,MAAM,OAAO,CAAC,OAAO,cAAc,IAAI,OAAO,cAAc,CAAC,IAAI,CAAC,QAAQ,OAAO,cAAc,KAAK,kBAAkB,MAAM,EAAE;gBAAC,aAAa;gBAAM,gBAAgB;YAAI;YAC1L,SAAS,aAAa,CAAC,MAAM,OAAO,CAAC,OAAO,iBAAiB,IAAI,OAAO,iBAAiB,CAAC,IAAI,CAAC,QAAQ,OAAO,iBAAiB,KAAK,kBAAkB,SAAS,EAAE;gBAAC,aAAa;gBAAM,gBAAgB;YAAI;YACzM,SAAS,cAAc,OAAO,kBAAkB,IAAI,kBAAkB,UAAU,EAAE;gBAAC,aAAa;gBAAM,gBAAgB;YAAI;YAE1H,IAAI,mBAAmB,YAAY;gBAC/B,SAAS,SAAS,OAAO,aAAa,IAAI,cAAc;oBAAC,aAAa;oBAAM,gBAAgB;gBAAI;YACpG,OAAO;gBACH,SAAS,SAAS,OAAO,aAAa,IAAI,wBAAwB;oBAAC,aAAa;oBAAM,gBAAgB;gBAAI;YAC9G;YAEA,SAAS;gBAAE,MAAM;gBAAsB,SAAS,OAAO,mBAAmB;YAAC;YAC3E,MAAM;gBAAE,OAAO;gBAAyB,aAAa;YAA4B;YACjF,MAAM;QACT,EAAE,OAAO,KAAc;YACrB,QAAQ,KAAK,CAAC,4CAA4C;YAC1D,SAAS;YACT,MAAM,eAAe,AAAC,eAAe,QAAS,IAAI,OAAO,GAAG,OAAO;YACnE,MAAM;gBAAE,OAAO;gBAAwB,aAAa;gBAAc,SAAS;YAAc;QAC3F,SAAU;YAAE,gBAAgB;QAAQ;IACtC,GAAG;QAAC;QAAW;QAAU;QAAS;QAAU;QAAO,MAAM,iBAAiB;QAAE,MAAM,kBAAkB;KAAC;IAGtG,MAAM,WAAW,CAAC;QACf,SAAS;QACT,IAAI,oBAAoB,GAAG;YACvB,aAAa,CAAC,oBAAoB,EAAE,uHAAA,CAAA,oBAAiB,CAAC,cAAc,EAAE,kBAAkB,IAAI,GAAG,gBAAgB,oBAAoB,CAAC,GAAG,GAAG,KAAK,GAAG,CAAC,iBAAiB,qBAAqB,CAAC,EAAE;YAC5L,MAAM;gBAAE,OAAO;gBAA8B,aAAa,aAAa;gBAA0B,SAAS;YAAa;YAAI;QAC/H;QACA,aAAa;QAEd,UAAU,IAAI,CAAC,CAAA;YACX,IAAI,CAAC,sBAAsB;gBACvB,MAAM,qBAAqB,OAAO,OAAO,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC,KAAK,IAAI;oBAC7D,IAAI,OAAO,OAAO,QAAQ,YAAY,aAAa,KAAK;wBACpD,OAAO,GAAG,IAAI,EAAE,EAAE,AAAC,IAAY,OAAO,EAAE;oBAC5C;oBACA,OAAO;gBACX,GAAG,MAAM,CAAC;gBACV,MAAM,aAAa,OAAO,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAA,IAAM,GAAW,SAAS,MAAM,CAAC,SAAS,IAAI,CAAC;gBAC5F,MAAM;oBAAE,OAAO;oBAAoB,aAAa,mBAAmB,IAAI,CAAC,SAAS,cAAc;oBAA0C,SAAS;gBAAa;gBAC/J;YACJ;YAEA,MAAM,YAAY,KAAK,IAAI;YAC3B,IAAI,aAAa,KAAK,KAAK,IAAI;YAC/B,IAAI,MAAM,iBAAiB,CAAC,aAAa,KAAK,YAAY;gBACtD,aAAa,KAAK,KAAK,IAAI,MAAM,SAAS,EAAE,SAAS,MAAM,iBAAiB,CAAC,sBAAsB,IAAI;YAC3G;YAEA,MAAM,cAAwB,CAAC,KAAK,MAAM,IAAI,EAAE,EAAE,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC;YACvF,MAAM,iBAA2B,CAAC,KAAK,SAAS,IAAI,EAAE,EAAE,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC;YAC7F,MAAM,kBAAkB,KAAK,UAAU,IAAI;YAC3C,MAAM,mBAAmB,KAAK,WAAW,IAAI;YAC7C,MAAM,8BAA8B,MAAM,SAAS,EAAE,2BAA2B,mBAAmB,MAAM,SAAS,CAAC,sBAAsB,GAAG;YAE5I,MAAM,0BAA8C;gBAChD,MAAM;gBAAW,OAAO;gBAAY,aAAa;gBAAkB,QAAQ;gBAAa,WAAW;gBACnG,YAAY;gBAAiB,OAAO;oBAAE,GAAG,KAAK;gBAAC;gBAC/C,wBAAwB;YAC5B;YAEA,SAAS;gBAAE,MAAM;gBAAoB,SAAS;YAAwB;YAEtE,IAAI,MAAM,iBAAiB,CAAC,aAAa,KAAK,cAAc;gBACxD,SAAS;oBAAE,MAAM;oBAAmB,SAAS;gBAAiB;YAClE,OAAO;gBACH,SAAS;oBAAE,MAAM;gBAAiB;YACtC;QACH;IACF;IAED,MAAM,mBAAmB;QACvB,SAAS;YAAE,MAAM;QAAa;IAChC;IAEA,MAAM,+BAA+B,CAAA,GAAA,qMAAA,CAAA,UAAO,AAAD,EAAE;QAC3C,MAAM,UAAU,MAAM,iBAAiB,CAAC,aAAa;QACrD,MAAM,aAAa,MAAM,iBAAiB,CAAC,mBAAmB;QAC9D,OAAO,YAAY,cAAe,YAAY,cAAc,eAAe;IAC7E,GAAG;QAAC,MAAM,iBAAiB,CAAC,aAAa;QAAE,MAAM,iBAAiB,CAAC,mBAAmB;KAAC;IAEvF,MAAM,0BAA0B,CAAA,GAAA,qMAAA,CAAA,UAAO,AAAD,EAAE;QACtC,MAAM,YAAY,CAAC,CAAC,MAAM,SAAS;QACnC,MAAM,kBAAkB,gBAAgB,iBAAiB,oBAAoB,KAAM,cAAc,QAAQ,oBAAmB;QAE5H,IAAI,0BAA0B;QAC9B,IAAG,8BAA8B;YAC7B,0BAA0B;QAC9B;QACA,OAAO,mBAAmB,CAAC,aAAa,CAAC;IAC3C,GAAG;QAAC;QAAc;QAAe;QAAiB;QAAW;QAAa;QAAQ;QAAO;KAA6B;IAGtH,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,6BAA6B,MAAM,iBAAiB,CAAC,aAAa;QAClE,mCAAmC,MAAM,iBAAiB,CAAC,mBAAmB;QAC9E;IACF,GAAG;QAAC,MAAM,iBAAiB,CAAC,aAAa;QAAE,MAAM,iBAAiB,CAAC,mBAAmB;QAAE;KAAQ;IAGhG,IAAI,MAAM,iBAAiB,CAAC,aAAa,KAAK,cAAc,MAAM,iBAAiB,CAAC,mBAAmB,KAAK,cAAc,CAAC,8BAA8B;QACvJ,qBACI,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC,2JAAA,CAAA,gBAAa;gBAAC,WAAU;;kCACrB,8OAAC,gIAAA,CAAA,aAAU;kCAAC,cAAA,8OAAC,gIAAA,CAAA,YAAS;4BAAC,WAAU;;8CAAkD,8OAAC,iNAAA,CAAA,UAAO;oCAAC,WAAU;;;;;;gCAAwB;;;;;;;;;;;;kCAC9H,8OAAC,gIAAA,CAAA,cAAW;;0CACR,8OAAC;gCAAE,WAAU;;oCAAwB;oCAA6B,MAAM,iBAAiB,CAAC,sBAAsB;oCAAC;oCAAK,MAAM,iBAAiB,CAAC,YAAY;oCAAC;;;;;;;0CAC3J,8OAAC;gCAAE,WAAU;0CAAqC;;;;;;;;;;;;kCAErD,8OAAC,gIAAA,CAAA,aAAU;kCACR,cAAA,8OAAC,kIAAA,CAAA,SAAM;4BAAC,SAAS;4BAAkB,WAAU;4BAAS,SAAQ;sCAAU;;;;;;;;;;;;;;;;;;;;;;IAK1F;IAEA,MAAM,oBAAoB,MAAM,iBAAiB,CAAC,aAAa,KAAK,eAC9D,+BACA;IAEN,qBACE,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC;YAAK,UAAU,aAAa;YAAW,WAAU;YAAmB,KAAK;sBACtE,cAAA,8OAAC,2JAAA,CAAA,gBAAa;gBAAC,WAAU;;kCACrB,8OAAC,gIAAA,CAAA,aAAU;wBAAC,WAAU;;0CAClB,8OAAC,gIAAA,CAAA,YAAS;gCAAC,WAAU;;kDACjB,8OAAC,kMAAA,CAAA,OAAI;wCAAC,WAAU;;;;;;oCAAY;;;;;;;4BAE9B,MAAM,iBAAiB,CAAC,aAAa,KAAK,cAAc,MAAM,iBAAiB,CAAC,mBAAmB,KAAK,4BACtG,8OAAC;gCAAE,WAAU;;oCAAiD;kDAAwC,8OAAC;wCAAK,WAAU;kDAAiB,MAAM,iBAAiB,CAAC,YAAY,IAAI;;;;;;oCAAyB;kDAAC,8OAAC;;;;;oCAAI;kDAAsB,8OAAC;wCAAK,WAAU;kDAAU,MAAM,iBAAiB,CAAC,sBAAsB,IAAI,MAAM;;;;;;oCAAsB;;;;;;;4BAE9U,CAAC,MAAM,iBAAiB,CAAC,aAAa,KAAK,gBAAgB,MAAM,iBAAiB,CAAC,aAAa,KAAK,QAAQ,mBAC1G,8OAAC;gCAAE,WAAU;;oCAAiD;oCAAQ,MAAM,iBAAiB,CAAC,aAAa;oCAAC;;;;;;;;;;;;;kCAGrH,8OAAC,gIAAA,CAAA,cAAW;wBAAC,WAAU;;4BAClB,uBAAW,8OAAC,iIAAA,CAAA,QAAK;gCAAC,SAAQ;gCAAc,WAAU;;oCAAO;kDAAC,8OAAC,oNAAA,CAAA,cAAW;wCAAC,WAAU;;;;;;oCAAY;kDAAC,8OAAC,iIAAA,CAAA,aAAU;kDAAC;;;;;;oCAAkB;kDAAC,8OAAC,iIAAA,CAAA,mBAAgB;kDAAE;;;;;;oCAAyB;;;;;;;4BAEzK,6CACG,8OAAC,gIAAA,CAAA,OAAI;gCAAC,OAAO;gCAAc,eAAe,CAAC;oCACvC,MAAM,kBAAkB;oCACxB,gBAAgB;oCAChB,SAAS,gBAAgB,iBAAiB;wCAAE,gBAAgB;oCAAK;gCACrE;gCAAG,WAAU;;kDACT,8OAAC,gIAAA,CAAA,WAAQ;wCAAC,WAAU;;0DAChB,8OAAC,gIAAA,CAAA,cAAW;gDAAC,OAAM;0DAAQ;;;;;;0DAC3B,8OAAC,gIAAA,CAAA,cAAW;gDAAC,OAAM;0DAAO;;;;;;;;;;;;kDAE9B,8OAAC,gIAAA,CAAA,cAAW;wCAAC,OAAM;wCAAQ,WAAU;kDACjC,cAAA,8OAAC,qJAAA,CAAA,qBAAkB;4CAAC,UAAU;4CAAkC,QAAQ;4CAA4B,eAAe,MAAM,iBAAiB,CAAC,aAAa;;;;;;;;;;;kDAE5J,8OAAC,gIAAA,CAAA,cAAW;wCAAC,OAAM;wCAAO,WAAU;kDAChC,cAAA,8OAAC,oJAAA,CAAA,oBAAiB;4CACd,UAAU;4CACV,QAAQ;4CACR,uBAAuB;4CACvB,cAAc;4CACd,aAAa,MAAM;4CACnB,oBAAoB,MAAM;;;;;;;;;;;;;;;;qDAKtC,8OAAC,iIAAA,CAAA,QAAK;;kDACF,8OAAC,kMAAA,CAAA,OAAI;wCAAC,WAAU;;;;;;kDAChB,8OAAC,iIAAA,CAAA,aAAU;kDAAC;;;;;;kDACZ,8OAAC,iIAAA,CAAA,mBAAgB;kDAAC;;;;;;;;;;;;0CAK1B,8OAAC,qIAAA,CAAA,YAAS;;;;;0CAEV,8OAAC;gCAAI,WAAU;;kDACX,8OAAC;wCAAI,WAAU;;0DACX,8OAAC;gDAAG,WAAU;;kEAAkD,8OAAC,kNAAA,CAAA,aAAU;wDAAC,WAAU;;;;;;oDAAW;oDAAiB,MAAM,QAAQ,GAAG,MAAM,OAAO,GAAG,MAAM,MAAM;oDAAC;oDAAI,uHAAA,CAAA,oBAAiB;oDAAC;;;;;;;0DACrL,8OAAC;gDAAE,WAAW,CAAC,oBAAoB,EAAE,aAAa,oBAAmB,IAAI,qBAAsB,oBAAoB,IAAI,mBAAmB,yBAA0B;0DAChK,AAAC,aAAa,oBAAmB,kBAAO,8OAAC;oDAAK,WAAU;;wDAA0B;sEAAC,8OAAC,oNAAA,CAAA,cAAW;4DAAC,WAAU;;;;;;wDAAY;wDAAE;wDAAU;;;;;;2DAC/H,oBAAoB,kBAAM,8OAAC;oDAAK,WAAU;;wDAAyC;sEAAC,8OAAC,2NAAA,CAAA,cAAW;4DAAC,WAAU;;;;;;wDAAY;;;;;;2DACrH,GAAG,gBAAgB,oBAAoB,CAAC;;;;;;;;;;;;kDAGtD,8OAAC;wCAAI,WAAU;;0DACX,8OAAC,sJAAA,CAAA,sBAAmB;gDAChB,OAAM;gDACN,SAAQ;gDACR,OAAO,MAAM,QAAQ;gDACrB,UAAU,CAAC,KAAK,MAAQ,iBAAiB;wDAAC,GAAG,KAAK;wDAAE,CAAC,IAAI,EAAE;oDAAG;gDAC9D,MAAM,6IAAA,CAAA,wBAAqB;gDAC3B,UAAU,gBAAgB;gDAC1B,iBAAiB;;;;;;0DAErB,8OAAC,sJAAA,CAAA,sBAAmB;gDAChB,OAAM;gDACN,SAAQ;gDACR,OAAO,MAAM,OAAO;gDACpB,UAAU,CAAC,KAAK,MAAQ,iBAAiB;wDAAC,GAAG,KAAK;wDAAE,CAAC,IAAI,EAAE;oDAAG;gDAC9D,MAAM,6IAAA,CAAA,uBAAoB;gDAC1B,UAAU,gBAAgB;gDAC1B,iBAAiB;;;;;;0DAErB,8OAAC,sJAAA,CAAA,sBAAmB;gDAChB,OAAM;gDACN,SAAQ;gDACR,OAAO,MAAM,MAAM;gDACnB,UAAU,CAAC,KAAK,MAAQ,iBAAiB;wDAAC,GAAG,KAAK;wDAAE,CAAC,IAAI,EAAE;oDAAG;gDAC9D,MAAM,6IAAA,CAAA,qBAAmB;gDACzB,UAAU,gBAAgB;gDAC1B,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;;kCAMjC,8OAAC,gIAAA,CAAA,aAAU;wBAAC,WAAU;;0CACjB,8OAAC,kIAAA,CAAA,SAAM;gCAAC,MAAK;gCAAS,SAAS;gCAAkB,SAAQ;gCAAU,cAAW;gCAAoB,WAAU;;kDACzG,8OAAC,0MAAA,CAAA,SAAM;wCAAC,WAAU;;;;;;oCAAiB;;;;;;;0CAEvC,8OAAC;gCAAI,WAAU;;kDACX,8OAAC,mIAAA,CAAA,kBAAe;kDACZ,cAAA,8OAAC,mIAAA,CAAA,UAAO;;8DACJ,8OAAC,mIAAA,CAAA,iBAAc;oDAAC,OAAO;8DAClB,cAAA,8OAAC,kIAAA,CAAA,SAAM;wDACJ,MAAK;wDACL,SAAS;wDACT,SAAQ;wDACR,cAAW;wDACX,WAAU;wDACV,UAAU,iBAAiB,gBAAgB,CAAC;;0EAE5C,8OAAC,gNAAA,CAAA,YAAS;gEAAC,WAAW,CAAC,aAAa,EAAE,gBAAgB,iBAAiB,IAAI;;;;;;4DAC1E,gBAAgB,mBAAmB;4DACnC,uCAAyB,8OAAC,2NAAA,CAAA,cAAW;gEAAC,WAAU;;;;;;;;;;;;;;;;;8DAGzD,8OAAC,mIAAA,CAAA,iBAAc;;sEACX,8OAAC;sEAAE;;;;;;wDACF,CAAC,8CAAgC,8OAAC;4DAAE,WAAU;sEAAgC;;;;;;;;;;;;;;;;;;;;;;;kDAI3F,8OAAC,kIAAA,CAAA,SAAM;wCACH,MAAK;wCACL,WAAU;wCACV,UAAU;wCACV,cAAW;;4CAEV,MAAM,iBAAiB,CAAC,aAAa,KAAK,6BAAe,8OAAC,kNAAA,CAAA,aAAU;gDAAC,WAAU;;;;;qEAAmB,8OAAC,kMAAA,CAAA,OAAI;gDAAC,WAAU;;;;;;4CAClH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ7B","debugId":null}},
    {"offset": {"line": 2064, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/components/screens/AdventureSetup.tsx"],"sourcesContent":["\n// src/components/screens/AdventureSetup.tsx\n\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { useGame } from \"../../context/GameContext\";\nimport { Button } from \"../../components/ui/button\";\nimport { Label } from \"../../components/ui/label\";\nimport { Input } from \"../../components/ui/input\";\nimport { Switch } from \"../../components/ui/switch\";\nimport { RadioGroup, RadioGroupItem } from \"../../components/ui/radio-group\";\nimport { CardboardCard, CardContent, CardHeader, CardTitle, CardFooter } from \"../../components/game/CardboardCard\";\nimport { Swords, Dices, Skull, Heart, Play, ArrowLeft, Settings, Globe, ScrollText, ShieldAlert, Sparkles, AlertTriangle, BookOpen, Atom, Drama, Puzzle, Users as UsersIcon, Mic2, UserPlus, UserCheck, Loader2, Lightbulb as LightbulbIcon } from \"lucide-react\";\nimport { useToast } from \"../../hooks/use-toast\";\nimport { Alert, AlertDescription } from \"../../components/ui/alert\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n  } from \"../../components/ui/select\"\nimport type { AdventureSettings, DifficultyLevel, AdventureType, GenreTheme, MagicSystem, TechLevel, DominantTone, CombatFrequency, PuzzleFrequency, SocialFocus } from \"../../types/adventure-types\";\nimport { VALID_ADVENTURE_DIFFICULTY_LEVELS } from \"../../lib/constants\";\nimport { generateCharacterDescription, type GenerateCharacterDescriptionOutput } from \"../../ai/flows/generate-character-description\";\nimport { suggestExistingCharacters } from \"../../ai/flows/suggest-existing-characters\"; \nimport { suggestOriginalCharacterConcepts } from \"../../ai/flows/suggest-original-character-concepts\"; \nimport type { Character, CharacterStats } from \"../../types/character-types\";\nimport { initialCharacterState, initialAdventureSettings as defaultInitialAdventureSettings } from \"../../context/game-initial-state\";\nimport { calculateMaxHealth, calculateMaxActionStamina, calculateMaxMana, getStarterSkillsForClass, calculateXpToNextLevel } from \"../../lib/gameUtils\";\n\n\nexport function AdventureSetup() {\n  const { state, dispatch } = useGame();\n  const { toast } = useToast();\n  \n  const adventureTypeFromContext = state.adventureSettings.adventureType;\n\n  // Common settings\n  const [permanentDeath, setPermanentDeath] = useState<boolean>(state.adventureSettings.permanentDeath ?? defaultInitialAdventureSettings.permanentDeath);\n  const [difficulty, setDifficulty] = useState<DifficultyLevel>(state.adventureSettings.difficulty ?? defaultInitialAdventureSettings.difficulty);\n  \n  // Custom Adventure settings\n  const [worldType, setWorldType] = useState<string>(state.adventureSettings.worldType ?? \"\");\n  const [mainQuestline, setMainQuestline] = useState<string>(state.adventureSettings.mainQuestline ?? \"\");\n  const [genreTheme, setGenreTheme] = useState<GenreTheme>(state.adventureSettings.genreTheme ?? \"\");\n  const [magicSystem, setMagicSystem] = useState<MagicSystem>(state.adventureSettings.magicSystem ?? \"\");\n  const [techLevel, setTechLevel] = useState<TechLevel>(state.adventureSettings.techLevel ?? \"\");\n  const [dominantTone, setDominantTone] = useState<DominantTone>(state.adventureSettings.dominantTone ?? \"\");\n  const [startingSituation, setStartingSituation] = useState<string>(state.adventureSettings.startingSituation ?? \"\");\n  const [combatFrequency, setCombatFrequency] = useState<CombatFrequency>(state.adventureSettings.combatFrequency ?? \"Medium\");\n  const [puzzleFrequency, setPuzzleFrequency] = useState<PuzzleFrequency>(state.adventureSettings.puzzleFrequency ?? \"Medium\");\n  const [socialFocus, setSocialFocus] = useState<SocialFocus>(state.adventureSettings.socialFocus ?? \"Medium\");\n  \n  // Immersed Adventure settings\n  const [universeName, setUniverseName] = useState<string>(state.adventureSettings.universeName ?? \"\");\n  const [playerCharacterConcept, setPlayerCharacterConcept] = useState<string>(state.adventureSettings.playerCharacterConcept ?? \"\");\n  const [characterOriginType, setCharacterOriginType] = useState<'existing' | 'original'>(\n    state.adventureSettings.characterOriginType ?? 'original' \n  );\n  \n  // Component state\n  const [customError, setCustomError] = useState<string | null>(null);\n  const [isLoadingImmersedCharacter, setIsLoadingImmersedCharacter] = useState(false);\n  const [isSuggestingNameLoading, setIsSuggestingNameLoading] = useState(false); \n\n  useEffect(() => {\n    // This effect ensures that local state for settings is in sync with game context\n    // This is useful if the user navigates away and comes back\n    setPermanentDeath(state.adventureSettings.permanentDeath ?? defaultInitialAdventureSettings.permanentDeath);\n    setDifficulty(state.adventureSettings.difficulty ?? defaultInitialAdventureSettings.difficulty);\n\n    if (state.adventureSettings.adventureType === \"Custom\") {\n      setWorldType(state.adventureSettings.worldType ?? \"\");\n      setMainQuestline(state.adventureSettings.mainQuestline ?? \"\");\n      setGenreTheme(state.adventureSettings.genreTheme ?? \"\");\n      setMagicSystem(state.adventureSettings.magicSystem ?? \"\");\n      setTechLevel(state.adventureSettings.techLevel ?? \"\");\n      setDominantTone(state.adventureSettings.dominantTone ?? \"\");\n      setStartingSituation(state.adventureSettings.startingSituation ?? \"\");\n      setCombatFrequency(state.adventureSettings.combatFrequency ?? \"Medium\");\n      setPuzzleFrequency(state.adventureSettings.puzzleFrequency ?? \"Medium\");\n      setSocialFocus(state.adventureSettings.socialFocus ?? \"Medium\");\n    } else if (state.adventureSettings.adventureType === \"Immersed\") {\n      setUniverseName(state.adventureSettings.universeName ?? \"\");\n      setPlayerCharacterConcept(state.adventureSettings.playerCharacterConcept ?? \"\");\n      setCharacterOriginType(state.adventureSettings.characterOriginType ?? 'original');\n    }\n    setCustomError(null); \n  }, [state.adventureSettings]);\n\n  const validateSettings = (): boolean => {\n     if (adventureTypeFromContext === \"Custom\") {\n        if (!worldType.trim()) { setCustomError(\"World Type is required.\"); return false; }\n        if (!mainQuestline.trim()) { setCustomError(\"Main Questline is required.\"); return false; }\n        if (!genreTheme) { setCustomError(\"Genre/Theme is required.\"); return false; }\n        if (!magicSystem) { setCustomError(\"Magic System is required.\"); return false; }\n        if (!techLevel) { setCustomError(\"Technological Level is required.\"); return false; }\n        if (!dominantTone) { setCustomError(\"Dominant Tone is required.\"); return false; }\n        if (!startingSituation.trim()) { setCustomError(\"Starting Situation is required.\"); return false; }\n     } else if (adventureTypeFromContext === \"Immersed\") {\n        if (!universeName.trim()) { setCustomError(\"Universe Name is required.\"); return false; }\n        if (characterOriginType === 'existing' && !playerCharacterConcept.trim()) {\n             setCustomError(\"Existing Character's Name is required.\"); return false;\n        }\n        if (characterOriginType === 'original' && !playerCharacterConcept.trim()) {\n            setCustomError(\"Original Character Concept/Role is required.\"); return false;\n        }\n     }\n     setCustomError(null);\n     return true;\n  };\n\n  const handleSuggestName = async () => {\n    if (!universeName.trim()) {\n      toast({ title: \"Universe Name Required\", description: \"Please enter a universe name to get suggestions.\", variant: \"destructive\" });\n      return;\n    }\n    setIsSuggestingNameLoading(true);\n    setCustomError(null);\n    try {\n      let suggestions: string[] = [];\n      if (characterOriginType === 'existing') {\n        const result = await suggestExistingCharacters({ universeName, userApiKey: state.userGoogleAiApiKey });\n        suggestions = result.suggestedNames || [];\n      } else { // 'original'\n        const result = await suggestOriginalCharacterConcepts({ universeName, userApiKey: state.userGoogleAiApiKey });\n        suggestions = result.suggestedConcepts || [];\n      }\n\n      if (suggestions.length > 0) {\n        let newSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];\n        if (suggestions.length > 1 && newSuggestion === playerCharacterConcept) {\n          const otherSuggestions = suggestions.filter(s => s !== playerCharacterConcept);\n          if (otherSuggestions.length > 0) {\n            newSuggestion = otherSuggestions[Math.floor(Math.random() * otherSuggestions.length)];\n          }\n        }\n        setPlayerCharacterConcept(newSuggestion);\n        toast({ title: \"Suggestion Applied!\", description: `Suggested: ${newSuggestion}` });\n      } else {\n        toast({ title: \"No Suggestions\", description: \"Could not find suggestions for this universe.\", variant: \"default\" });\n      }\n\n    } catch (err) {\n      console.error(\"AdventureSetup: Failed to get name/concept suggestion:\", err);\n      toast({ title: \"Suggestion Error\", description: \"Could not fetch suggestions at this time.\", variant: \"destructive\" });\n    } finally {\n      setIsSuggestingNameLoading(false);\n    }\n  };\n\n  const handleProceed = async () => {\n    setCustomError(null);\n\n    if (!adventureTypeFromContext) {\n        toast({ title: \"Adventure Type Missing\", description: \"Please return to main menu and select an adventure type.\", variant: \"destructive\" });\n        dispatch({ type: \"SET_GAME_STATUS\", payload: \"MainMenu\" });\n        return;\n    }\n\n    if (!validateSettings()) {\n        toast({ title: \"Settings Incomplete\", description: customError || `Please fill all required details for ${adventureTypeFromContext} adventure.`, variant: \"destructive\" });\n        return;\n    }\n\n    const finalDifficulty = VALID_ADVENTURE_DIFFICULTY_LEVELS.includes(difficulty) ? difficulty : \"Normal\";\n    const settingsPayload: Partial<AdventureSettings> = { \n      adventureType: adventureTypeFromContext, permanentDeath, difficulty: finalDifficulty,\n      worldType, mainQuestline, genreTheme, magicSystem, techLevel, dominantTone, startingSituation,\n      combatFrequency, puzzleFrequency, socialFocus, universeName, playerCharacterConcept, characterOriginType\n    };\n    \n    dispatch({ type: \"SET_ADVENTURE_SETTINGS\", payload: settingsPayload });\n\n    // --- FLOW LOGIC ---\n    if (state.character && (adventureTypeFromContext === \"Randomized\" || adventureTypeFromContext === \"Immersed\")) {\n        // Randomized or Immersed with existing character -> START GAMEPLAY\n        dispatch({ type: \"START_GAMEPLAY\" });\n        toast({ title: \"Adventure Starting!\", description: \"The world awaits...\" });\n    } else if (adventureTypeFromContext === \"Custom\") {\n        // Custom flow -> GO TO CHARACTER CREATION\n        dispatch({ type: \"SET_GAME_STATUS\", payload: \"CharacterCreation\" });\n        toast({ title: \"Adventure Setup Complete!\", description: \"Now, create your adventurer.\" });\n    } else if (adventureTypeFromContext === \"Immersed\") {\n        // Immersed flow (original character) -> GENERATE CHARACTER THEN START\n        setIsLoadingImmersedCharacter(true);\n        toast({ title: \"Fetching Character Lore...\", description: `Preparing ${playerCharacterConcept} from ${universeName}...` });\n        try {\n            const aiProfile: GenerateCharacterDescriptionOutput = await generateCharacterDescription({\n                 characterDescription: playerCharacterConcept, \n                 isImmersedMode: true, \n                 universeName: universeName, \n                 playerCharacterConcept: playerCharacterConcept,\n                 userApiKey: state.userGoogleAiApiKey\n            });\n            const baseStats = { ...initialCharacterState.stats }; \n            const randomStr = Math.floor(Math.random() * 5) + 3; \n            const randomSta = Math.floor(Math.random() * 5) + 3; \n            const randomWis = 15 - randomStr - randomSta;       \n            const finalStats: CharacterStats = { strength: randomStr, stamina: randomSta, wisdom: Math.max(1, randomWis) }; \n\n            const newCharacter: Character = {\n                ...initialCharacterState, \n                name: playerCharacterConcept, \n                description: aiProfile.detailedDescription || `Playing as ${playerCharacterConcept} from the universe of ${universeName}.`,\n                class: aiProfile.inferredClass || \"Immersed Protagonist\", \n                traits: aiProfile.inferredTraits || [], knowledge: aiProfile.inferredKnowledge || [],\n                background: aiProfile.inferredBackground || `A character from the universe of ${universeName}.`,\n                stats: finalStats, aiGeneratedDescription: aiProfile.detailedDescription, \n                maxHealth: calculateMaxHealth(finalStats), currentHealth: calculateMaxHealth(finalStats),\n                maxStamina: calculateMaxActionStamina(finalStats), currentStamina: calculateMaxActionStamina(finalStats),\n                maxMana: calculateMaxMana(finalStats, aiProfile.inferredKnowledge || []),\n                currentMana: calculateMaxMana(finalStats, aiProfile.inferredKnowledge || []),\n                learnedSkills: getStarterSkillsForClass(aiProfile.inferredClass || \"Immersed Protagonist\"),\n                xpToNextLevel: calculateXpToNextLevel(1), skillTree: null, skillTreeStage: 0,\n            };\n            \n            dispatch({ type: \"CREATE_CHARACTER\", payload: newCharacter });\n            dispatch({ type: \"START_GAMEPLAY\" });\n            toast({ title: \"Adventure Starting!\", description: `Stepping into the shoes of ${playerCharacterConcept} in the universe of ${universeName}!` });\n\n        } catch (err) {\n            console.error(\"AdventureSetup: Failed to generate immersed character profile:\", err);\n            toast({ title: \"Character Profile Error\", description: \"Could not retrieve character details. Please try again or define an original character.\", variant: \"destructive\" });\n        } finally {\n            setIsLoadingImmersedCharacter(false);\n        }\n    } else {\n        console.error(\"AdventureSetup: Unhandled proceed logic. State:\", state.status, \"AdventureType:\", adventureTypeFromContext, \"Character exists:\", !!state.character);\n        toast({ title: \"Navigation Error\", description: \"Could not determine the next step.\", variant: \"destructive\" });\n    }\n  };\n\n   const handleBack = () => {\n    dispatch({ type: \"RESET_GAME\" }); \n  };\n\n\n  if (!adventureTypeFromContext) {\n    return (\n        <div className=\"flex flex-col items-center justify-center min-h-screen p-4 bg-background\">\n             <CardboardCard className=\"w-full max-w-md text-center\">\n                <CardHeader> <CardTitle className=\"text-2xl flex items-center justify-center gap-2\"><AlertTriangle className=\"w-6 h-6 text-destructive\"/> Error</CardTitle> </CardHeader>\n                <CardContent> <p className=\"text-muted-foreground\">Adventure type not selected. Please return to the main menu and choose an adventure type.</p> </CardContent>\n                <CardFooter> <Button onClick={handleBack} className=\"w-full\"> Back to Main Menu </Button> </CardFooter>\n             </CardboardCard>\n        </div>\n    );\n  }\n\n  const getAdventureTypeIcon = () => {\n    switch(adventureTypeFromContext) {\n        case \"Randomized\": return <Dices className=\"w-5 h-5 text-green-500\"/>;\n        case \"Custom\": return <Swords className=\"w-5 h-5 text-blue-500\"/>;\n        case \"Immersed\": return <Sparkles className=\"w-5 h-5 text-purple-500\"/>;\n        default: return <Settings className=\"w-5 h-5\"/>;\n    }\n  };\n  \n  const proceedButtonText = adventureTypeFromContext === \"Custom\" ? \"Proceed to Character Creation\" : \"Start Adventure\";\n                            \n  const isProceedDisabled = isLoadingImmersedCharacter || isSuggestingNameLoading ||\n                            (adventureTypeFromContext === 'Custom' && (!worldType.trim() || !mainQuestline.trim() || !genreTheme || !magicSystem || !techLevel || !dominantTone || !startingSituation.trim() )) ||\n                            (adventureTypeFromContext === 'Immersed' && (!universeName.trim() || !playerCharacterConcept.trim()));\n\n\n  return (\n    <div className=\"flex flex-col items-center justify-center min-h-screen p-4 bg-background\">\n      <CardboardCard className=\"w-full max-w-2xl shadow-xl border-2 border-foreground/20\">\n        <CardHeader className=\"border-b border-foreground/10 pb-4\">\n          <CardTitle className=\"text-3xl font-bold text-center flex items-center justify-center gap-2\"> <Settings className=\"w-7 h-7\"/> Adventure Setup </CardTitle>\n           <p className=\"text-sm text-muted-foreground text-center flex items-center justify-center gap-1.5 mt-1\"> \n             Selected Type: {getAdventureTypeIcon()} <span className=\"font-medium\">{adventureTypeFromContext}</span> \n           </p>\n        </CardHeader>\n        <CardContent className=\"space-y-6 pt-6\">\n          {customError && ( <Alert variant=\"destructive\"> <AlertDescription>{customError}</AlertDescription> </Alert> )}\n\n          {adventureTypeFromContext === \"Randomized\" && (\n             <div className=\"space-y-4 pt-2 text-center\">\n                 {state.character && <p className=\"text-sm text-foreground\">Character '<span className=\"font-semibold\">{state.character.name}</span>' is ready. Finalize your adventure settings below.</p>}\n                 {!state.character && <p className=\"text-sm text-muted-foreground italic\">A unique world will be generated for your character.</p>}\n             </div>\n          )}\n\n          {adventureTypeFromContext === \"Custom\" && (\n            <div className=\"space-y-4 border-t border-foreground/10 pt-6 mt-0\">\n               <h3 className=\"text-xl font-semibold mb-4 border-b pb-2\">Customize Your Adventure</h3>\n               <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                   <div className=\"space-y-4\">\n                       <div className=\"space-y-2\">\n                           <Label htmlFor=\"worldType\" className=\"flex items-center gap-1\"><Globe className=\"w-4 h-4\"/> World Type</Label>\n                           <Input id=\"worldType\" value={worldType} onChange={(e) => setWorldType(e.target.value)} placeholder=\"e.g., Forgotten Kingdom\" className={customError && !worldType.trim() ? 'border-destructive' : ''} />\n                       </div>\n                       <div className=\"space-y-2\">\n                           <Label htmlFor=\"mainQuestline\" className=\"flex items-center gap-1\"><ScrollText className=\"w-4 h-4\"/> Main Questline (Goal)</Label>\n                           <Input id=\"mainQuestline\" value={mainQuestline} onChange={(e) => setMainQuestline(e.target.value)} placeholder=\"e.g., Find the Lost Artifact\" className={customError && !mainQuestline.trim() ? 'border-destructive' : ''}/>\n                       </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"genreTheme\" className=\"flex items-center gap-1\"><BookOpen className=\"w-4 h-4\"/> Genre/Theme</Label>\n                            <Select value={genreTheme} onValueChange={(v) => setGenreTheme(v as GenreTheme)}>\n                                <SelectTrigger id=\"genreTheme\" className={customError && !genreTheme ? 'border-destructive' : ''}><SelectValue placeholder=\"Select genre...\" /></SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"High Fantasy\">High Fantasy</SelectItem><SelectItem value=\"Dark Fantasy\">Dark Fantasy</SelectItem>\n                                    <SelectItem value=\"Sci-Fi (Cyberpunk)\">Sci-Fi (Cyberpunk)</SelectItem><SelectItem value=\"Sci-Fi (Space Opera)\">Sci-Fi (Space Opera)</SelectItem>\n                                    <SelectItem value=\"Post-Apocalyptic\">Post-Apocalyptic</SelectItem><SelectItem value=\"Horror\">Horror</SelectItem>\n                                    <SelectItem value=\"Mystery\">Mystery</SelectItem><SelectItem value=\"Urban Fantasy\">Urban Fantasy</SelectItem>\n                                </SelectContent>\n                            </Select>\n                       </div>\n                       <div className=\"space-y-2\">\n                            <Label htmlFor=\"magicSystem\" className=\"flex items-center gap-1\"><Sparkles className=\"w-4 h-4\"/> Magic System</Label>\n                            <Select value={magicSystem} onValueChange={(v) => setMagicSystem(v as MagicSystem)}>\n                                <SelectTrigger id=\"magicSystem\" className={customError && !magicSystem ? 'border-destructive' : ''}><SelectValue placeholder=\"Select magic system...\" /></SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"High Magic (Common & Powerful)\">High Magic</SelectItem><SelectItem value=\"Low Magic (Rare & Subtle)\">Low Magic</SelectItem>\n                                    <SelectItem value=\"Elemental Magic\">Elemental Magic</SelectItem><SelectItem value=\"Psionics\">Psionics</SelectItem><SelectItem value=\"No Magic\">No Magic</SelectItem>\n                                </SelectContent>\n                            </Select>\n                       </div>\n                       <div className=\"space-y-2\">\n                            <Label htmlFor=\"startingSituation\" className=\"flex items-center gap-1\"><Play className=\"w-4 h-4\"/> Starting Situation</Label>\n                            <Input id=\"startingSituation\" value={startingSituation} onChange={(e) => setStartingSituation(e.target.value)} placeholder=\"e.g., Waking up with amnesia\" className={customError && !startingSituation.trim() ? 'border-destructive' : ''}/>\n                       </div>\n                   </div>\n                   <div className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"techLevel\" className=\"flex items-center gap-1\"><Atom className=\"w-4 h-4\"/> Technological Level</Label>\n                            <Select value={techLevel} onValueChange={(v) => setTechLevel(v as TechLevel)}>\n                                <SelectTrigger id=\"techLevel\" className={customError && !techLevel ? 'border-destructive' : ''}><SelectValue placeholder=\"Select tech level...\" /></SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"Primitive\">Primitive</SelectItem><SelectItem value=\"Medieval\">Medieval</SelectItem>\n                                    <SelectItem value=\"Renaissance\">Renaissance</SelectItem><SelectItem value=\"Industrial\">Industrial</SelectItem>\n                                    <SelectItem value=\"Modern\">Modern</SelectItem><SelectItem value=\"Futuristic\">Futuristic</SelectItem>\n                                </SelectContent>\n                            </Select>\n                       </div>\n                       <div className=\"space-y-2\">\n                            <Label htmlFor=\"dominantTone\" className=\"flex items-center gap-1\"><Drama className=\"w-4 h-4\"/> Dominant Tone</Label>\n                            <Select value={dominantTone} onValueChange={(v) => setDominantTone(v as DominantTone)}>\n                                <SelectTrigger id=\"dominantTone\" className={customError && !dominantTone ? 'border-destructive' : ''}><SelectValue placeholder=\"Select tone...\" /></SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"Heroic & Optimistic\">Heroic & Optimistic</SelectItem><SelectItem value=\"Grim & Perilous\">Grim & Perilous</SelectItem>\n                                    <SelectItem value=\"Mysterious & Eerie\">Mysterious & Eerie</SelectItem><SelectItem value=\"Comedic & Lighthearted\">Comedic & Lighthearted</SelectItem>\n                                    <SelectItem value=\"Serious & Political\">Serious & Political</SelectItem>\n                                </SelectContent>\n                            </Select>\n                       </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"combatFrequency\" className=\"flex items-center gap-1\"><Swords className=\"w-4 h-4\"/> Combat Frequency</Label>\n                            <Select value={combatFrequency} onValueChange={(v) => setCombatFrequency(v as CombatFrequency)}>\n                                <SelectTrigger id=\"combatFrequency\"><SelectValue placeholder=\"Select combat frequency...\" /></SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"High\">High</SelectItem><SelectItem value=\"Medium\">Medium</SelectItem><SelectItem value=\"Low\">Low</SelectItem>\n                                    <SelectItem value=\"None (Focus on Puzzles/Social)\">None (Focus on Puzzles/Social)</SelectItem>\n                                </SelectContent>\n                            </Select>\n                       </div>\n                       <div className=\"space-y-2\">\n                            <Label htmlFor=\"puzzleFrequency\" className=\"flex items-center gap-1\"><Puzzle className=\"w-4 h-4\"/> Puzzle/Riddle Frequency</Label>\n                            <Select value={puzzleFrequency} onValueChange={(v) => setPuzzleFrequency(v as PuzzleFrequency)}>\n                                <SelectTrigger id=\"puzzleFrequency\"><SelectValue placeholder=\"Select puzzle frequency...\" /></SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"High\">High</SelectItem><SelectItem value=\"Medium\">Medium</SelectItem><SelectItem value=\"Low\">Low</SelectItem>\n                                </SelectContent>\n                            </Select>\n                       </div>\n                       <div className=\"space-y-2\">\n                            <Label htmlFor=\"socialFocus\" className=\"flex items-center gap-1\"><UsersIcon className=\"w-4 h-4\"/> Social Interaction Focus</Label>\n                            <Select value={socialFocus} onValueChange={(v) => setSocialFocus(v as SocialFocus)}>\n                                <SelectTrigger id=\"socialFocus\"><SelectValue placeholder=\"Select social focus...\" /></SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"High (Many NPCs, Dialogue Choices)\">High</SelectItem><SelectItem value=\"Medium\">Medium</SelectItem><SelectItem value=\"Low (More Exploration/Combat)\">Low</SelectItem>\n                                </SelectContent>\n                            </Select>\n                       </div>\n                   </div>\n               </div>\n            </div>\n          )}\n          {adventureTypeFromContext === \"Immersed\" && (\n            <div className=\"space-y-4 border-t border-foreground/10 pt-6 mt-0\">\n               <h3 className=\"text-xl font-semibold mb-4 border-b pb-2\">Immersed Adventure Details</h3>\n               <div className=\"space-y-2\">\n                   <Label htmlFor=\"universeName\" className=\"flex items-center gap-1\"><Sparkles className=\"w-4 h-4\"/> Universe Name</Label>\n                   <Input id=\"universeName\" value={universeName} onChange={(e) => setUniverseName(e.target.value)} placeholder=\"e.g., Star Wars, Lord of the Rings, Hogwarts\" className={customError && !universeName.trim() ? 'border-destructive' : ''}/>\n                </div>\n                \n                <RadioGroup value={characterOriginType} onValueChange={(value) => {\n                    setCharacterOriginType(value as 'existing' | 'original');\n                    setPlayerCharacterConcept(\"\"); \n                }} className=\"space-y-2\">\n                    <Label className=\"text-base font-medium\">Character Origin:</Label>\n                    <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"existing\" id=\"origin-existing\" />\n                        <Label htmlFor=\"origin-existing\" className=\"flex items-center gap-1 cursor-pointer\"><UserCheck className=\"w-4 h-4\"/> Play as Existing Character</Label>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"original\" id=\"origin-original\" />\n                        <Label htmlFor=\"origin-original\" className=\"flex items-center gap-1 cursor-pointer\"><UserPlus className=\"w-4 h-4\"/> Create Original Character</Label>\n                    </div>\n                </RadioGroup>\n\n               <div className=\"space-y-1\">\n                    <Label htmlFor=\"playerCharacterConcept\" className=\"flex items-center gap-1\"><ScrollText className=\"w-4 h-4\"/> \n                        {characterOriginType === 'existing' ? \"Existing Character's Name\" : \"Your Original Character Concept/Role\"}\n                    </Label>\n                    <div className=\"flex items-center gap-2\">\n                       <Input \n                        id=\"playerCharacterConcept\" \n                        value={playerCharacterConcept} \n                        onChange={(e) => setPlayerCharacterConcept(e.target.value)} \n                        placeholder={characterOriginType === 'existing' ? \"e.g., Harry Potter, Luke Skywalker\" : \"e.g., A rebel pilot, a new student at Hogwarts\"} \n                        className={`flex-grow ${customError && !playerCharacterConcept.trim() ? 'border-destructive' : ''}`}/>\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"icon\"\n                          onClick={handleSuggestName}\n                          disabled={isSuggestingNameLoading || !universeName.trim()}\n                          aria-label=\"Suggest Character Name/Concept\"\n                        >\n                          {isSuggestingNameLoading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <LightbulbIcon className=\"h-4 w-4\" />}\n                        </Button>\n                    </div>\n                </div>\n            </div>\n          )}\n          \n           <div className=\"space-y-4 border-t border-foreground/10 pt-6\">\n                <Label htmlFor=\"difficulty-select\" className=\"text-xl font-semibold flex items-center gap-2\"><ShieldAlert className=\"w-5 h-5\"/>Select Difficulty</Label>\n                <Select value={difficulty} onValueChange={(value) => setDifficulty(value as DifficultyLevel)}>\n                    <SelectTrigger id=\"difficulty-select\" className=\"w-full\"><SelectValue placeholder=\"Select difficulty...\" /></SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"Easy\">Easy - Fewer challenges, more forgiving.</SelectItem>\n                        <SelectItem value=\"Normal\">Normal - A balanced experience.</SelectItem>\n                        <SelectItem value=\"Hard\">Hard - Tougher encounters, requires strategy.</SelectItem>\n                        <SelectItem value=\"Nightmare\">Nightmare - Extreme challenge, for veterans.</SelectItem>\n                    </SelectContent>\n                </Select>\n                <p className=\"text-sm text-muted-foreground\">Difficulty affects challenge level, AI behavior, and potential events.</p>\n            </div>\n\n          <div className=\"space-y-4 border-t border-foreground/10 pt-6\">\n            <Label className=\"text-xl font-semibold flex items-center gap-2\"><Skull className=\"w-5 h-5\"/>Choose Challenge Mode</Label>\n            <div className=\"flex items-center justify-between space-x-2 p-4 border-2 rounded-md bg-card/50\">\n              <div className=\"flex flex-col\">\n                 <Label htmlFor=\"permanent-death\" className=\"font-medium flex items-center gap-1 cursor-pointer\"> {permanentDeath ? <Skull className=\"w-4 h-4 text-destructive\"/> : <Heart className=\"w-4 h-4 text-green-600\"/>} {permanentDeath ? \"Permanent Death\" : \"Respawn Enabled\"} </Label>\n                 <p className=\"text-sm text-muted-foreground pr-2\"> {permanentDeath ? \"Your adventure ends permanently if you die.\" : \"You can respawn at a checkpoint before death.\"} </p>\n              </div>\n              <Switch id=\"permanent-death\" checked={permanentDeath} onCheckedChange={setPermanentDeath} aria-label={`Toggle ${permanentDeath ? 'Permanent Death off' : 'Permanent Death on'}`}/>\n            </div>\n          </div>\n        </CardContent>\n        <CardFooter className=\"flex flex-col sm:flex-row justify-between gap-4 pt-6 border-t border-foreground/10\">\n           <Button variant=\"outline\" onClick={handleBack} disabled={isLoadingImmersedCharacter || isSuggestingNameLoading}> <ArrowLeft className=\"mr-2 h-4 w-4\" /> Back to Main Menu </Button>\n           <Button onClick={handleProceed} disabled={isProceedDisabled} className=\"bg-accent hover:bg-accent/90 text-accent-foreground w-full sm:w-auto\"> \n            {(isLoadingImmersedCharacter || isSuggestingNameLoading) && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            {isLoadingImmersedCharacter ? \"Preparing Character...\" : (isSuggestingNameLoading ? \"Suggesting...\" : (proceedButtonText))}\n           </Button>\n        </CardFooter>\n      </CardboardCard>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3991, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/components/screens/Gameplay.tsx"],"sourcesContent":["\n// src/components/screens/Gameplay.tsx\n\"use client\";\n\nimport React, { useState, useCallback, useEffect, useRef } from \"react\";\nimport type { GameState, Character, SkillTree, Reputation, NpcRelationships } from '../../types/game-types';\nimport type { StoryLogEntry, DifficultyLevel as AssessedDifficultyLevel, AdventureSettings } from '../../types/adventure-types';\nimport type { InventoryItem } from '../../types/inventory-types';\nimport type { Skill, CharacterStats } from '../../types/character-types';\nimport { useGame } from \"../../context/GameContext\";\nimport { useToast } from \"../../hooks/use-toast\";\nimport { calculateXpToNextLevel, calculateMaxHealth, calculateMaxActionStamina, calculateMaxMana, getStarterSkillsForClass } from \"../../lib/gameUtils\";\nimport { narrateAdventure, type NarrateAdventureInput, type NarrateAdventureOutput } from \"../../ai/flows/narrate-adventure\";\nimport { summarizeAdventure } from \"../../ai/flows/summarize-adventure\";\nimport { assessActionDifficulty, type AssessActionDifficultyInput } from \"../../ai/flows/assess-action-difficulty\";\nimport { generateSkillTree } from \"../../ai/flows/generate-skill-tree\";\nimport { attemptCrafting, type AttemptCraftingInput, type AttemptCraftingOutput } from \"../../ai/flows/attempt-crafting\";\nimport { updateGameStateString } from \"../../lib/game-state-utils\";\nimport { cn } from \"../../lib/utils\";\n\nimport { Loader2, Settings, ArrowLeft, Skull, Save, Info, Dices, Hammer, BookCopy, CalendarClock, GitBranch, RefreshCw } from \"lucide-react\";\nimport { SettingsPanel } from \"../../components/screens/SettingsPanel\";\nimport { LeftPanel } from \"../../components/game/LeftPanel\";\nimport { NarrationDisplay } from '../../components/gameplay/NarrationDisplay';\nimport { ActionInput } from '../../components/gameplay/ActionInput';\nimport { GameplayActions } from '../../components/gameplay/GameplayActions';\nimport { CraftingDialog } from '../../components/gameplay/CraftingDialog';\nimport { ClassChangeDialog } from '../../components/gameplay/ClassChangeDialog';\nimport { MobileSheet } from '../../components/gameplay/MobileSheet';\nimport { useIsMobile } from \"../../hooks/use-mobile\";\nimport { Button } from '../../components/ui/button';\nimport { Sheet, SheetTrigger, SheetContent, SheetHeader, SheetTitle } from \"../../components/ui/sheet\";\nimport { TooltipProvider } from \"../../components/ui/tooltip\";\nimport { Alert, AlertDescription, AlertTitle } from \"../../components/ui/alert\";\nimport { Skeleton } from \"../../components/ui/skeleton\";\n\n\n// --- Dice Roller Service (Embedded) ---\nconst localRollDie = (sides: number): number => {\n    if (sides < 1) throw new Error(\"Sides must be at least 1.\");\n    return Math.floor(Math.random() * sides) + 1;\n};\nconst localGetDiceRollFunction = (diceType: string): (() => number) | null => {\n    switch (diceType?.toLowerCase()) {\n        case 'd6': return () => localRollDie(6);\n        case 'd10': return () => localRollDie(10);\n        case 'd20': return () => localRollDie(20);\n        case 'd100': return () => localRollDie(100);\n        case 'none': default: return null;\n    }\n};\n// --- End Dice Roller Service ---\n\nconst GENERIC_BRANCHING_CHOICES: NarrateAdventureOutput['branchingChoices'] = [\n    { text: \"Look around more closely.\", consequenceHint: \"May reveal new details.\" },\n    { text: \"Consider your next move carefully.\", consequenceHint: \"Take a moment to think.\" },\n    { text: \"Check your inventory.\", consequenceHint: \"Review your belongings.\" },\n    { text: \"Rest for a moment.\", consequenceHint: \"Conserve your strength.\" }\n];\n\nconst INITIAL_ACTION_STRING = \"Begin the adventure by looking around.\";\n\nexport function Gameplay() {\n    const { state, dispatch } = useGame();\n    const { toast } = useToast();\n    const {\n        character, currentNarration, currentGameStateString, storyLog,\n        adventureSettings, inventory, currentAdventureId,\n        isGeneratingSkillTree: contextIsGeneratingSkillTree,\n        turnCount, userGoogleAiApiKey\n    } = state;\n\n    const [isLoading, setIsLoading] = useState(false); // For subsequent narrations\n    const [isInitialLoading, setIsInitialLoading] = useState(true); // Specifically for the first narration\n    const [isEnding, setIsEnding] = useState(false);\n    const [isSaving, setIsSaving] = useState(false);\n    const [isAssessingDifficulty, setIsAssessingDifficulty] = useState(false);\n    const [isRollingDice, setIsRollingDice] = useState(false);\n    const [isCraftingLoading, setIsCraftingLoading] = useState(false);\n    const [localIsGeneratingSkillTree, setLocalIsGeneratingSkillTree] = useState(false);\n    const [lastPlayerAction, setLastPlayerAction] = useState<string | null>(null);\n\n    const [error, setError] = useState<string | null>(null);\n    const [diceResult, setDiceResult] = useState<number | null>(null);\n    const [diceType, setDiceType] = useState<string>(\"None\");\n    const [pendingClassChange, setPendingClassChange] = useState<string | null>(null);\n    const [branchingChoices, setBranchingChoices] = useState<NarrateAdventureOutput['branchingChoices']>(GENERIC_BRANCHING_CHOICES);\n    const [isCraftingDialogOpen, setIsCraftingDialogOpen] = useState(false);\n    const [isDesktopSettingsOpen, setIsDesktopSettingsOpen] = useState(false);\n    \n    const initialSetupAttemptedRef = useRef<Record<string, boolean>>({});\n    const isMobile = useIsMobile();\n\n    useEffect(() => {\n        if (contextIsGeneratingSkillTree !== localIsGeneratingSkillTree) {\n            setLocalIsGeneratingSkillTree(contextIsGeneratingSkillTree);\n        }\n    }, [contextIsGeneratingSkillTree, localIsGeneratingSkillTree]);\n\n     useEffect(() => {\n         console.log(\"Gameplay: currentAdventureId changed or component mounted. Resetting relevant states. New ID:\", currentAdventureId);\n         setIsInitialLoading(true);\n         setError(null);\n         setLastPlayerAction(null); // Reset last action for new adventure\n         setBranchingChoices(GENERIC_BRANCHING_CHOICES);\n         // Reset the attempted flag for the new adventure\n         if (currentAdventureId) {\n            initialSetupAttemptedRef.current = { [currentAdventureId]: false };\n         } else {\n            initialSetupAttemptedRef.current = {};\n         }\n     }, [currentAdventureId]);\n\n\n    const handleEndAdventure = useCallback(async (finalNarrationEntry?: StoryLogEntry, characterIsDefeated = false) => {\n        if (isLoading || isEnding || isSaving || isAssessingDifficulty || isRollingDice || localIsGeneratingSkillTree || contextIsGeneratingSkillTree || isCraftingLoading) return;\n        console.log(\"Gameplay: Initiating end adventure. Defeated:\", characterIsDefeated);\n        setIsEnding(true);\n        setError(null);\n        toast({ title: characterIsDefeated ? \"Character Defeated\" : \"Ending Adventure\", description: \"Summarizing your tale...\" });\n\n        const finalLogToSummarize = [...storyLog];\n        if (finalNarrationEntry && (!storyLog.length || storyLog[storyLog.length - 1].narration !== finalNarrationEntry.narration)) {\n            finalLogToSummarize.push(finalNarrationEntry);\n        }\n        let summary = characterIsDefeated ? \"Your character has been defeated.\" : \"Your adventure has concluded.\";\n        const hasLog = finalLogToSummarize.length > 0;\n\n        if (hasLog && character) { \n            const fullStory = finalLogToSummarize.map((log, index) => `[Turn ${index + 1}]\\n${log.narration}`).join(\"\\n\\n---\\n\\n\");\n            if (fullStory.trim().length > 0) {\n                try {\n                    const summaryResult = await summarizeAdventure({ story: fullStory, userApiKey: userGoogleAiApiKey });\n                    summary = summaryResult.summary;\n                    toast({ title: \"Summary Generated\", description: \"View your adventure outcome.\" });\n                } catch (summaryError: any) {\n                    console.error(\"Gameplay: Summarize adventure error:\", summaryError);\n                    summary = `Could not generate a summary due to an error: ${summaryError.message || 'Unknown error'}. ${summary}`;\n                    toast({ title: \"Summary Error\", description: \"Failed to generate summary.\", variant: \"destructive\" });\n                }\n            }\n        }\n        dispatch({ type: \"END_ADVENTURE\", payload: { summary, finalNarration: finalNarrationEntry } });\n        setIsEnding(false);\n    }, [isLoading, isEnding, isSaving, isAssessingDifficulty, isRollingDice, localIsGeneratingSkillTree, contextIsGeneratingSkillTree, storyLog, dispatch, toast, character, isCraftingLoading, userGoogleAiApiKey]);\n\n    const handlePlayerAction = useCallback(async (action: string, isInitialAction = false) => {\n        console.log(`Gameplay: handlePlayerAction called. Action: \"${action.substring(0,50)}...\", isInitialAction: ${isInitialAction}`);\n        if (!character) {\n            toast({ title: \"Error\", description: \"Character data is missing.\", variant: \"destructive\" });\n             if (isInitialAction) setIsInitialLoading(false);\n             console.error(\"Gameplay: Character is null in handlePlayerAction.\");\n            return;\n        }\n        \n        setLastPlayerAction(action); // Store the action being processed\n        if (isInitialAction) {\n            setIsInitialLoading(true);\n            console.log(\"Gameplay: handlePlayerAction - Initial action. isInitialLoading set to true.\");\n        } else {\n            setIsLoading(true);\n        }\n        setError(null); setDiceResult(null); setDiceType(\"None\"); \n\n        let actionWithDice = action;\n        let assessedDifficulty: AssessedDifficultyLevel = \"Normal\";\n        let requiresRoll = false;\n        let rollFunction: (() => number) | null = null;\n\n        try {\n            if (character.class === 'admin000') {\n                // Dev commands are now handled synchronously inside Gameplay.tsx to directly dispatch state changes\n                return;\n            }\n\n            const actionLower = action.trim().toLowerCase();\n            const isPassiveAction = [INITIAL_ACTION_STRING.toLowerCase(), \"look\", \"look around\", \"check inventory\", \"check status\", \"check relationships\", \"check reputation\"].includes(actionLower);\n\n            if (!isInitialAction && !isPassiveAction) {\n                setIsAssessingDifficulty(true);\n                toast({ title: \"Assessing Challenge...\", duration: 1000 });\n                await new Promise(resolve => setTimeout(resolve, 150));\n                const repString = character.reputation ? Object.entries(character.reputation).map(([f, s]) => `${f}: ${s}`).join(', ') || 'None' : 'None';\n                const relString = character.npcRelationships ? Object.entries(character.npcRelationships).map(([n, s]) => `${n}: ${s}`).join(', ') || 'None' : 'None';\n                const capabilitiesSummary = `Lvl: ${character.level}. Class: ${character.class}. Stage: ${character.skillTreeStage}. Stats: STR ${character.stats.strength}, STA ${character.stats.stamina}, WIS ${character.stats.wisdom}. Health: ${character.currentHealth}/${character.maxHealth}. Action STA: ${character.currentStamina}/${character.maxStamina}. Mana: ${character.currentMana}/${character.maxMana}. Traits: ${character.traits.join(', ') || 'None'}. Knowledge: ${character.knowledge.join(', ') || 'None'}. Background: ${character.background}. Inventory: ${inventory.map(i => i.name).join(', ') || 'Empty'}. Learned Skills: ${character.learnedSkills.map(s => s.name).join(', ') || 'None'}. Rep: ${repString}. Rel: ${relString}`;\n                const assessmentInput: AssessActionDifficultyInput = {\n                    playerAction: action, characterCapabilities: capabilitiesSummary, characterClass: character.class,\n                    currentSituation: currentNarration?.narration || \"At the beginning of the scene.\",\n                    gameStateSummary: currentGameStateString, gameDifficulty: adventureSettings.difficulty, turnCount: turnCount,\n                    userApiKey: userGoogleAiApiKey,\n                };\n                const assessmentResult = await assessActionDifficulty(assessmentInput);\n                setIsAssessingDifficulty(false);\n                assessedDifficulty = assessmentResult.difficulty;\n                setDiceType(assessmentResult.suggestedDice);\n                rollFunction = localGetDiceRollFunction(assessmentResult.suggestedDice);\n                requiresRoll = assessedDifficulty !== \"Trivial\" && assessedDifficulty !== \"Impossible\" && rollFunction !== null;\n                toast({ title: `Action Difficulty: ${assessedDifficulty}`, description: assessmentResult.reasoning.substring(0, 100), duration: 1500 });\n                await new Promise(resolve => setTimeout(resolve, 200));\n                \n                if ((assessedDifficulty as string) === \"Impossible\") {\n                    const impossibleActionLog: StoryLogEntry = {\n                        narration: `Narrator: Your attempt to \"${action}\" is deemed impossible. ${assessmentResult.reasoning}`,\n                        updatedGameState: currentGameStateString, // No state change for impossible action\n                        timestamp: Date.now(),\n                        branchingChoices: GENERIC_BRANCHING_CHOICES, // Provide generic choices\n                    };\n                    dispatch({ type: \"UPDATE_NARRATION\", payload: impossibleActionLog });\n                    setBranchingChoices(GENERIC_BRANCHING_CHOICES);\n                    toast({ title: \"Action Impossible\", description: assessmentResult.reasoning, variant: \"destructive\", duration: 4000 });\n                    return; // Return early as the action doesn't proceed to narration\n                }\n            } else {\n                requiresRoll = false; assessedDifficulty = \"Trivial\"; setDiceType(\"None\");\n            }\n\n            if (requiresRoll && rollFunction) {\n                setIsRollingDice(true);\n                toast({ title: `Rolling ${diceType}...`, duration: 1000 });\n                await new Promise(resolve => setTimeout(resolve, 200));\n                const roll = rollFunction();\n                setDiceResult(roll);\n                const numericDiceType = parseInt(diceType.substring(1), 10);\n                if (!isNaN(numericDiceType) && numericDiceType > 0) {\n                     actionWithDice += ` (Difficulty: ${assessedDifficulty}, Dice Roll Result: ${roll}/${numericDiceType})`;\n                } else { actionWithDice += ` (Difficulty: ${assessedDifficulty}, Roll: ${roll})`; }\n                await new Promise(resolve => setTimeout(resolve, 100));\n                setIsRollingDice(false);\n                await new Promise(resolve => setTimeout(resolve, 1400)); // Time for user to see dice result\n                setDiceResult(null); // Clear dice result\n            } else if (!isPassiveAction && (assessedDifficulty as string) !== \"Impossible\" && diceType !== 'None') {\n                actionWithDice += ` (Difficulty: ${assessedDifficulty}, No Roll Required)`;\n            }\n\n            let skillTreeSummaryForAI = null;\n            if (character.skillTree && character.skillTreeStage >= 0) {\n                const currentStageData = character.skillTree.stages.find(s => s.stage === character.skillTreeStage);\n                skillTreeSummaryForAI = {\n                    className: character.skillTree.className, stageCount: character.skillTree.stages.length,\n                    availableSkillsAtCurrentStage: currentStageData ? currentStageData.skills.map(s => s.name) : [],\n                };\n            }\n\n            const reputationString = character.reputation ? JSON.stringify(character.reputation) : \"{}\";\n            const npcRelationshipsString = character.npcRelationships ? JSON.stringify(character.npcRelationships) : \"{}\";\n\n            const inputForAI: NarrateAdventureInput = {\n                character: {\n                    name: character.name, class: character.class, description: character.description,\n                    traits: character.traits, knowledge: character.knowledge, background: character.background,\n                    stats: character.stats, currentHealth: character.currentHealth, maxHealth: character.maxHealth,\n                    currentStamina: character.currentStamina, maxStamina: character.maxStamina,\n                    currentMana: character.currentMana, maxMana: character.maxMana,\n                    level: character.level, xp: character.xp, xpToNextLevel: character.xpToNextLevel,\n                    reputationString, npcRelationshipsString, skillTreeSummary: skillTreeSummaryForAI,\n                    skillTreeStage: character.skillTreeStage, learnedSkills: character.learnedSkills.map(s => s.name),\n                    aiGeneratedDescription: character.aiGeneratedDescription,\n                },\n                playerChoice: actionWithDice, gameState: currentGameStateString,\n                previousNarration: storyLog.length > 0 ? storyLog[storyLog.length - 1].narration : undefined,\n                adventureSettings: adventureSettings, turnCount: turnCount,\n                userApiKey: userGoogleAiApiKey,\n            };\n\n            const narrationResult = await narrateAdventure(inputForAI);\n\n            // Fallback handling is now mostly inside narrateAdventureFlow, but we check again\n            if (narrationResult && narrationResult.narration && narrationResult.updatedGameState) {\n                const gainedSkillTyped = narrationResult.gainedSkill ? {\n                    ...narrationResult.gainedSkill,\n                    type: (narrationResult.gainedSkill.type === 'Starter' || narrationResult.gainedSkill.type === 'Learned') \n                        ? (narrationResult.gainedSkill.type as 'Starter' | 'Learned') \n                        : 'Learned' as const\n                } : undefined;\n\n                const logEntryPayload: StoryLogEntry = {\n                    ...narrationResult,\n                    timestamp: Date.now(),\n                    gainedSkill: gainedSkillTyped\n                };\n\n                dispatch({ type: \"UPDATE_NARRATION\", payload: logEntryPayload });\n                setBranchingChoices(narrationResult.branchingChoices ?? GENERIC_BRANCHING_CHOICES);\n                // Toasts for positive feedback\n                if (narrationResult.dynamicEventTriggered) toast({ title: \"Dynamic Event!\", description: narrationResult.dynamicEventTriggered, duration: 4000, className: \"border-purple-500\" });\n                if (narrationResult.xpGained && narrationResult.xpGained > 0) toast({ title: `Gained ${narrationResult.xpGained} XP!`, duration: 3000, className: \"bg-yellow-100 dark:bg-yellow-900 border-yellow-500\" });\n                if (narrationResult.reputationChange) { const { faction, change } = narrationResult.reputationChange; const dir = change > 0 ? 'increased' : 'worsened'; toast({ title: `Reputation with ${faction} ${dir} by ${Math.abs(change)}!`, duration: 3000 }); }\n                if (narrationResult.npcRelationshipChange) { const { npcName, change } = narrationResult.npcRelationshipChange; const dir = change > 0 ? 'improved' : 'worsened'; toast({ title: `Relationship with ${npcName} ${dir} by ${Math.abs(change)}!`, duration: 3000 }); }\n                if (narrationResult.progressedToStage && narrationResult.progressedToStage > character.skillTreeStage) {\n                     const stageName = character.skillTree?.stages.find(s => s.stage === narrationResult!.progressedToStage)?.stageName || `Stage ${narrationResult.progressedToStage}`;\n                     toast({ title: \"Skill Stage Increased!\", description: `You've reached ${stageName} (Stage ${narrationResult.progressedToStage})!`, duration: 4000, className: \"bg-purple-100 dark:bg-purple-900 border-purple-500\" });\n                }\n                 if (narrationResult.gainedSkill) toast({ title: \"Skill Learned!\", description: `You gained: ${narrationResult.gainedSkill.name}!`, duration: 4000 });\n                 if (narrationResult.suggestedClassChange && narrationResult.suggestedClassChange !== character.class && adventureSettings.adventureType !== \"Immersed\") setPendingClassChange(narrationResult.suggestedClassChange);\n\n                const updatedChar = state.character; // This will be updated after dispatch\n                if (narrationResult.isCharacterDefeated && updatedChar && updatedChar.currentHealth <=0) { \n                    if (adventureSettings.permanentDeath) {\n                        await handleEndAdventure(logEntryPayload, true);\n                    } else {\n                        dispatch({ type: \"RESPAWN_CHARACTER\", payload: { narrationMessage: `${character.name} was defeated but managed to escape death's grasp this time!` } });\n                        toast({ title: \"Defeated!\", description: \"You narrowly escaped death! Your health and resources are restored.\", variant: \"destructive\", duration: 5000 });\n                    }\n                }\n            } else {\n                 // This path should ideally not be hit if narrateAdventureFlow has robust fallbacks.\n                 setError(\"Narration failed: AI did not return a valid response. Try a different action or retry.\");\n                 setBranchingChoices(GENERIC_BRANCHING_CHOICES);\n                 toast({title: \"Narration Error\", description: \"AI failed to respond. Please try again.\", variant: \"destructive\"});\n            }\n        } catch (err: any) {\n            console.error(\"Gameplay: Error in handlePlayerAction:\", err);\n            setError(`An unexpected error occurred while processing your action: ${err.message}`);\n            setBranchingChoices(GENERIC_BRANCHING_CHOICES); // Ensure choices are available even on error\n            toast({title: \"Unexpected Error\", description: \"Something went wrong processing your action.\", variant: \"destructive\"});\n        } finally {\n            if (isInitialAction) {\n                console.log(\"Gameplay: handlePlayerAction - Initial action finished, isInitialLoading set to false.\");\n                setIsInitialLoading(false);\n            }\n            setIsLoading(false); \n            if (isAssessingDifficulty) setIsAssessingDifficulty(false);\n            if (isRollingDice) setIsRollingDice(false);\n            console.log(`Gameplay: handlePlayerAction finished. Action: \"${action.substring(0,50)}...\". Loading states reset.`);\n        }\n    }, [\n        character, inventory, isLoading, isEnding, isSaving, isAssessingDifficulty, isRollingDice,\n        localIsGeneratingSkillTree, contextIsGeneratingSkillTree, currentGameStateString, currentNarration, storyLog, adventureSettings, turnCount,\n        dispatch, toast, handleEndAdventure, isCraftingLoading, userGoogleAiApiKey\n    ]);\n\n    const handleRetryNarration = useCallback(() => {\n        let actionToRetry = lastPlayerAction;\n        let isRetryInitial = false;\n\n        if (!actionToRetry && storyLog.length === 0) {\n            actionToRetry = INITIAL_ACTION_STRING;\n            isRetryInitial = true;\n             console.log(\"Gameplay: Retrying initial narration because no last action and story log is empty.\");\n        } else if (actionToRetry === INITIAL_ACTION_STRING) {\n            isRetryInitial = true;\n        }\n        \n        if (actionToRetry) {\n            toast({ title: \"Retrying AI Narration...\", description: `Re-sending action: \"${actionToRetry.substring(0,30)}...\"`});\n            handlePlayerAction(actionToRetry, isRetryInitial);\n        } else {\n            toast({ title: \"Cannot Retry\", description: \"No previous action to retry, and initial narration was already attempted.\", variant: \"destructive\"});\n        }\n    }, [lastPlayerAction, handlePlayerAction, toast, storyLog.length]);\n\n\n    const triggerSkillTreeGeneration = useCallback(async (charClass: string | undefined): Promise<SkillTree | null> => {\n        if (!charClass || adventureSettings.adventureType === \"Immersed\") {\n            if (contextIsGeneratingSkillTree) dispatch({ type: \"SET_SKILL_TREE_GENERATING\", payload: false });\n            setLocalIsGeneratingSkillTree(false);\n            return character?.skillTree || null;\n        }\n         if (character && character.skillTree && character.skillTree.className === charClass) {\n             if (contextIsGeneratingSkillTree) dispatch({ type: \"SET_SKILL_TREE_GENERATING\", payload: false });\n             setLocalIsGeneratingSkillTree(false);\n             return character.skillTree;\n         }\n        \n        dispatch({ type: \"SET_SKILL_TREE_GENERATING\", payload: true });\n        setLocalIsGeneratingSkillTree(true);\n        setError(null);\n        toast({ title: \"Generating Skill Tree...\", description: `Crafting abilities for the ${charClass} class...`, duration: 3000 });\n        \n        try {\n            const skillTreeResult = await generateSkillTree({ characterClass: charClass, userApiKey: userGoogleAiApiKey });\n            if (skillTreeResult && skillTreeResult.stages.length === 5) { \n                dispatch({ type: \"SET_SKILL_TREE\", payload: { class: charClass, skillTree: skillTreeResult } });\n                toast({ title: \"Skill Tree Generated!\", description: `The path of the ${charClass} is set.` });\n                return skillTreeResult;\n            } else {\n                toast({ title: \"Skill Tree Error\", description: \"Using default progression (AI fallback used).\", variant: \"default\" });\n                return skillTreeResult; // Return fallback if AI provided one\n            }\n        } catch (err: any) {\n            setError(`Skill Tree Error: ${err.message}. Using default progression.`);\n            toast({ title: \"Skill Tree Error\", description: \"Could not generate skill tree. Default progression used.\", variant: \"destructive\" });\n            return null; \n        } finally {\n            dispatch({ type: \"SET_SKILL_TREE_GENERATING\", payload: false });\n            setLocalIsGeneratingSkillTree(false);\n        }\n    }, [dispatch, toast, adventureSettings.adventureType, character, contextIsGeneratingSkillTree, userGoogleAiApiKey]);\n\n    useEffect(() => {\n        const performInitialSetup = async () => {\n            if (!character || !currentAdventureId || initialSetupAttemptedRef.current[currentAdventureId]) {\n                if (isInitialLoading) setIsInitialLoading(false); // Stop loading if prerequisites are missing\n                return;\n            }\n            initialSetupAttemptedRef.current[currentAdventureId] = true;\n            console.log(`Gameplay Initial Setup: Starting for adventure ${currentAdventureId}.`);\n\n            // Step 1: Generate Skill Tree if needed\n            let skillTreeReady = adventureSettings.adventureType === \"Immersed\" || !!character.skillTree;\n            if (!skillTreeReady) {\n                console.log(\"Gameplay Initial Setup: Skill tree needed for class:\", character.class);\n                await triggerSkillTreeGeneration(character.class);\n                // Re-check state after dispatch\n                const updatedCharacter = state.character;\n                skillTreeReady = adventureSettings.adventureType === \"Immersed\" || !!updatedCharacter?.skillTree;\n                 console.log(\"Gameplay Initial Setup: Skill tree generation attempt finished. Ready:\", skillTreeReady);\n            }\n\n            // Step 2: Trigger initial narration only after skill tree is ready and if no story exists\n            if (skillTreeReady && storyLog.length === 0) {\n                console.log(\"Gameplay Initial Setup: Conditions met for initial narration. Calling handlePlayerAction.\");\n                await handlePlayerAction(INITIAL_ACTION_STRING, true);\n            } else {\n                // If story log already has entries (e.g., from a loaded game), we don't need initial narration.\n                 console.log(\"Gameplay Initial Setup: Story log has entries or skill tree failed. Skipping initial narration.\");\n                setIsInitialLoading(false);\n            }\n        };\n\n        performInitialSetup().catch(err => {\n            console.error(\"Gameplay: Fatal error during initial setup:\", err);\n            setError(\"A critical error occurred while starting the adventure. Please try again.\");\n            setIsInitialLoading(false);\n        });\n    \n    }, [character, currentAdventureId, adventureSettings.adventureType, triggerSkillTreeGeneration, handlePlayerAction, storyLog.length, state.character, isInitialLoading]);\n    \n\n    const handleSaveGame = useCallback(async () => {\n        if (isLoading || isEnding || isSaving || !currentAdventureId || !character) return;\n        setIsSaving(true); toast({ title: \"Saving Progress...\" }); await new Promise(resolve => setTimeout(resolve, 500));\n        try {\n            dispatch({ type: \"SAVE_CURRENT_ADVENTURE\" });\n            toast({ title: \"Game Saved!\", description: `Progress for \"${character.name}\" saved.`, variant: \"default\" });\n        } catch (err) {\n            toast({ title: \"Save Failed\", description: \"Could not save progress.\", variant: \"destructive\" });\n        } finally { setIsSaving(false); }\n    }, [dispatch, toast, isLoading, isEnding, isSaving, currentAdventureId, character]);\n\n    const handleCrafting = useCallback(async (goal: string, ingredients: string[]) => {\n        if (!character || isCraftingLoading) return;\n        setIsCraftingLoading(true); toast({ title: \"Attempting to craft...\", description: `Trying to make: ${goal}` });\n        const inventoryListNames = inventory.map(item => item.name);\n        const skills = character.learnedSkills.map(s => s.name);\n        const craftingInput: AttemptCraftingInput = {\n            characterKnowledge: character.knowledge, characterSkills: skills, inventoryItems: inventoryListNames,\n            desiredItem: goal, usedIngredients: ingredients,\n        };\n        try {\n            const result: AttemptCraftingOutput = await attemptCrafting(craftingInput);\n            toast({ title: result.success ? \"Crafting Successful!\" : \"Crafting Failed!\", description: result.message, variant: result.success ? \"default\" : \"destructive\", duration: 5000 });\n            let narrationText = `You attempted to craft ${goal} using ${ingredients.join(', ')}. ${result.message}`;\n            if (result.success && result.craftedItem) {\n                narrationText = `You successfully crafted a ${result.craftedItem.quality ? result.craftedItem.quality + ' ' : ''}${result.craftedItem.name}! ${result.message}`;\n            }\n             dispatch({ type: 'UPDATE_CRAFTING_RESULT', payload: { narration: narrationText, consumedItems: result.consumedItems, craftedItem: result.success ? result.craftedItem : null, newGameStateString: currentGameStateString }});\n             setIsCraftingDialogOpen(false);\n        } catch (err: any) {\n             let userFriendlyError = `Crafting attempt failed. Please try again later.`;\n             if (err.message?.includes('400 Bad Request') || err.message?.includes('invalid argument')) userFriendlyError = \"Crafting failed: Invalid materials or combination? The AI was unable to process the request.\";\n             else if (err.message) userFriendlyError = `Crafting Error: ${err.message.substring(0, 100)}`;\n            toast({ title: \"Crafting Error\", description: userFriendlyError, variant: \"destructive\" });\n             setIsCraftingDialogOpen(false);\n        } finally { setIsCraftingLoading(false); }\n    }, [character, inventory, dispatch, toast, currentGameStateString, isCraftingLoading]);\n\n     const handleConfirmClassChange = useCallback(async (newClass: string) => {\n         if (!character || !newClass || localIsGeneratingSkillTree || adventureSettings.adventureType === \"Immersed\") return;\n         setPendingClassChange(null);\n         \n         toast({ title: `Becoming a ${newClass}...`, description: \"Generating new skill path...\", duration: 2000 });\n         let newSkillTreeResult: SkillTree | null = null;\n         try {\n            dispatch({ type: \"SET_SKILL_TREE_GENERATING\", payload: true });\n            setLocalIsGeneratingSkillTree(true);\n             newSkillTreeResult = await generateSkillTree({ characterClass: newClass, userApiKey: userGoogleAiApiKey });\n             if (newSkillTreeResult && newSkillTreeResult.stages.length === 5) { \n                 dispatch({ type: \"CHANGE_CLASS_AND_RESET_SKILLS\", payload: { newClass, newSkillTree: newSkillTreeResult } });\n                 toast({ title: `Class Changed to ${newClass}!`, description: \"Your abilities and progression have been reset.\" });\n             } else {\n                 toast({ title: \"Class Change Failed\", description: `Could not generate skill tree for ${newClass}. Class change aborted.`, variant: \"destructive\" });\n             }\n         } catch (err: any) {\n             toast({ title: \"Class Change Error\", description: `Could not generate skill tree for ${newClass}. Class change aborted.`, variant: \"destructive\" });\n         } finally {\n             dispatch({ type: \"SET_SKILL_TREE_GENERATING\", payload: false });\n             setLocalIsGeneratingSkillTree(false);\n         }\n     }, [character, dispatch, toast, localIsGeneratingSkillTree, adventureSettings.adventureType, userGoogleAiApiKey]);\n\n    const handleGoBack = useCallback(() => {\n        if (isLoading || isEnding || isSaving) return;\n        toast({ title: \"Returning to Main Menu...\", description: \"Abandoning current adventure.\" });\n        dispatch({ type: \"RESET_GAME\" });\n    }, [isLoading, isEnding, isSaving, dispatch, toast]);\n\n    const handleSuggestAction = useCallback(() => {\n        if (isLoading || isEnding || isSaving || !character) return;\n        const learnedSkillNames = character.learnedSkills.map(s => s.name);\n        const baseSuggestions = [\"Look around\", \"Examine surroundings\", \"Check inventory\", \"Check status\", \"Check relationships\", \"Check reputation\", \"Move north\", \"Move east\", \"Move south\", \"Move west\", \"Talk to [NPC Name]\", \"Ask about [Topic]\", \"Examine [Object]\", \"Pick up [Item]\", \"Use [Item]\", \"Drop [Item]\", \"Open [Door/Chest]\", \"Search the area\", \"Rest here\", \"Wait for a while\", \"Attack [Target]\", \"Defend yourself\", \"Flee\"];\n        const skillSuggestions = learnedSkillNames.map(name => `Use skill: ${name}`);\n        const suggestions = [...baseSuggestions, ...skillSuggestions];\n        const suggestion = suggestions[Math.floor(Math.random() * suggestions.length)];\n        toast({ title: \"Suggestion\", description: `Try: \"${suggestion}\"`, duration: 3000 });\n    }, [isLoading, isEnding, isSaving, character, toast]);\n\n    const processDevCommand = useCallback((action: string) => {\n        if (!character) return;\n        \n        let devNarration = `(Developer Mode) Player chose: \"${action}\".`;\n        const command = action.trim().toLowerCase();\n        const parts = command.split(' ');\n        const baseCommand = parts[0];\n        const value = parts.length > 1 ? parts.slice(1).join(' ') : undefined;\n        \n        const updates: Partial<Character> = {};\n        let xpGained: number | undefined;\n\n        if (baseCommand === '/xp' && value) {\n            const amount = parseInt(value, 10);\n            if (!isNaN(amount)) { xpGained = amount; devNarration += ` Granted ${amount} XP.`; }\n            else { devNarration += \" - Invalid XP amount.\"; }\n        } else if (baseCommand === '/stage' && value) {\n            const stageNum = parseInt(value, 10);\n            if (!isNaN(stageNum) && stageNum >= 0 && stageNum <= 4) { updates.skillTreeStage = stageNum; devNarration += ` Set skill stage to ${stageNum}.`; }\n            else { devNarration += \" - Invalid stage number (0-4).\"; }\n        } else if (baseCommand === '/health' && value) {\n            const amount = parseInt(value, 10);\n            if (!isNaN(amount)) {\n                const newHealth = Math.max(0, Math.min(character.maxHealth, character.currentHealth + amount));\n                updates.currentHealth = newHealth;\n                devNarration += ` Adjusted health by ${amount}. New health: ${newHealth}.`;\n            } else { devNarration += \" - Invalid health amount.\"; }\n        } else if (baseCommand === '/stamina' && value) {\n            const amount = parseInt(value, 10);\n            if (!isNaN(amount)) {\n                updates.currentStamina = Math.max(0, Math.min(character.maxStamina, character.currentStamina + amount));\n                devNarration += ` Adjusted action stamina by ${amount}.`;\n            } else { devNarration += \" - Invalid action stamina amount.\"; }\n        } else if (baseCommand === '/mana' && value) {\n            const amount = parseInt(value, 10);\n            if (!isNaN(amount)) {\n                updates.currentMana = Math.max(0, Math.min(character.maxMana, character.currentMana + amount));\n                devNarration += ` Adjusted mana by ${amount}.`;\n            } else { devNarration += \" - Invalid mana amount.\"; }\n        } else if (baseCommand === '/addtrait' && value) {\n            updates.traits = [...character.traits, value];\n            devNarration += ` Added trait: ${value}.`;\n        } else if (baseCommand === '/addknowledge' && value) {\n            updates.knowledge = [...character.knowledge, value];\n            devNarration += ` Added knowledge: ${value}.`;\n        } else if (baseCommand === '/addskill' && value) {\n            updates.learnedSkills = [...character.learnedSkills, { name: value, description: \"Developer added skill\", type: 'Learned' }];\n            devNarration += ` Added skill: ${value}.`;\n        } else {\n            devNarration += \" Action processed. Dev restrictions bypassed.\";\n        }\n\n        if (Object.keys(updates).length > 0) dispatch({ type: \"UPDATE_CHARACTER\", payload: updates });\n        if (xpGained) dispatch({ type: \"GRANT_XP\", payload: xpGained });\n        \n        const devLogEntry: StoryLogEntry = {\n            narration: devNarration,\n            updatedGameState: updateGameStateString(currentGameStateString, character, inventory, turnCount + 1),\n            timestamp: Date.now(),\n            branchingChoices: GENERIC_BRANCHING_CHOICES\n        };\n        \n        dispatch({ type: \"UPDATE_NARRATION\", payload: devLogEntry });\n        setBranchingChoices(GENERIC_BRANCHING_CHOICES);\n\n    }, [character, currentGameStateString, inventory, turnCount, dispatch]);\n\n    // New useEffect to handle dev commands\n    useEffect(() => {\n        if (character?.class === 'admin000' && lastPlayerAction && lastPlayerAction.startsWith('/')) {\n            processDevCommand(lastPlayerAction);\n            setLastPlayerAction(null); // Clear after processing\n        }\n    }, [lastPlayerAction, character, processDevCommand]);\n\n\n    if (!character) {\n        return ( <div className=\"flex flex-col items-center justify-center min-h-screen p-4 gap-4\"> <Loader2 className=\"h-12 w-12 animate-spin text-primary\" /> <p className=\"text-lg text-muted-foreground\">Loading Character Data...</p> <Button onClick={() => dispatch({ type: 'RESET_GAME' })} variant=\"outline\"> Return to Main Menu </Button> </div> );\n    }\n\n     const renderReputation = useCallback((rep: Reputation | undefined) => {\n        if (!rep || Object.keys(rep).length === 0) return <p className=\"text-xs text-muted-foreground italic\">None</p>;\n        return ( <ul className=\"list-none pl-0\"> {Object.entries(rep).map(([faction, score]) => ( <li key={faction} className=\"flex justify-between items-center text-xs\"> <span>{faction}:</span> <span className={`font-medium ${(score as number) > 10 ? 'text-green-600' : (score as number) < -10 ? 'text-destructive' : ''}`}>{score as number}</span> </li> ))} </ul> );\n    }, []);\n\n     const renderNpcRelationships = useCallback((rels: NpcRelationships | undefined) => {\n        if (!rels || Object.keys(rels).length === 0) return <p className=\"text-xs text-muted-foreground italic\">None</p>;\n        return ( <ul className=\"list-none pl-0\"> {Object.entries(rels).map(([npcName, score]) => ( <li key={npcName} className=\"flex justify-between items-center text-xs\"> <span>{npcName}:</span> <span className={`font-medium ${(score as number) > 20 ? 'text-green-600' : (score as number) < -20 ? 'text-destructive' : ''}`}>{score as number}</span> </li> ))} </ul> );\n    }, []);\n\n    const anyLoading = isLoading || isEnding || isSaving || isAssessingDifficulty || isRollingDice || localIsGeneratingSkillTree || contextIsGeneratingSkillTree || isCraftingLoading || isInitialLoading;\n\n    return (\n        <TooltipProvider>\n            <div className=\"flex flex-col md:flex-row min-h-screen overflow-hidden bg-gradient-to-br from-background to-muted/30\">\n                 <LeftPanel character={character} inventory={inventory} isGeneratingSkillTree={localIsGeneratingSkillTree || contextIsGeneratingSkillTree} turnCount={turnCount} renderReputation={renderReputation} renderNpcRelationships={renderNpcRelationships} />\n                <div className=\"flex-1 flex flex-col p-4 overflow-hidden\">\n                     <MobileSheet character={character} inventory={inventory} isGeneratingSkillTree={localIsGeneratingSkillTree || contextIsGeneratingSkillTree} turnCount={turnCount} renderReputation={renderReputation} renderNpcRelationships={renderNpcRelationships} onSettingsOpen={() => setIsDesktopSettingsOpen(true)} />\n                    <NarrationDisplay storyLog={storyLog} isLoading={isLoading} isAssessingDifficulty={isAssessingDifficulty} isRollingDice={isRollingDice} isGeneratingSkillTree={localIsGeneratingSkillTree || contextIsGeneratingSkillTree} isEnding={isEnding} isSaving={isSaving} isCraftingLoading={isCraftingLoading} diceResult={diceResult} diceType={diceType} error={error} branchingChoices={branchingChoices} handlePlayerAction={handlePlayerAction} isInitialLoading={isInitialLoading} onRetryNarration={handleRetryNarration} />\n                    <ActionInput onSubmit={handlePlayerAction} onSuggest={handleSuggestAction} onCraft={() => setIsCraftingDialogOpen(true)} disabled={anyLoading || character.class === 'admin000'} />\n                    <GameplayActions onSave={handleSaveGame} onAbandon={handleGoBack} onEnd={() => handleEndAdventure(undefined, character.currentHealth <= 0)} onSettings={() => setIsDesktopSettingsOpen(true)} disabled={anyLoading} isMobile={isMobile} currentAdventureId={currentAdventureId} />\n                    <ClassChangeDialog isOpen={!!pendingClassChange} onOpenChange={(open) => !open && setPendingClassChange(null)} character={character} pendingClassChange={pendingClassChange} onConfirm={handleConfirmClassChange} />\n                    <CraftingDialog isOpen={isCraftingDialogOpen} onOpenChange={setIsCraftingDialogOpen} inventory={inventory} onCraft={handleCrafting} />\n                    <Sheet open={isDesktopSettingsOpen} onOpenChange={setIsDesktopSettingsOpen}>\n                       <SettingsPanel isOpen={isDesktopSettingsOpen} onOpenChange={setIsDesktopSettingsOpen} />\n                    </Sheet>\n                </div>\n            </div>\n        </TooltipProvider>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5241, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/components/screens/AdventureSummary.tsx"],"sourcesContent":["\n// src/components/screens/AdventureSummary.tsx\n\"use client\";\n\nimport React from \"react\";\nimport { useGame } from \"../../context/GameContext\";\nimport type { StoryLogEntry } from \"../../types/game-types\";\nimport { Button } from \"../../components/ui/button\";\nimport { ScrollArea } from \"../../components/ui/scroll-area\";\nimport { CardboardCard, CardContent, CardHeader, CardTitle, CardFooter } from \"../../components/game/CardboardCard\";\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"../../components/ui/accordion\";\nimport { BookOpen, FileText, Home } from \"lucide-react\";\n\nexport function AdventureSummary() {\n  const { state, dispatch } = useGame();\n  const { adventureSummary, storyLog, character } = state;\n\n  const handleMainMenu = () => {\n    dispatch({ type: \"RESET_GAME\" }); // Reset game state fully\n  };\n\n  // TODO: Implement saving/loading logic if required later\n  // const handleSaveStory = () => { ... }\n  // const handleViewSavedStories = () => { ... }\n\n  return (\n    <div className=\"flex flex-col items-center justify-center min-h-screen p-4 bg-background\">\n      <CardboardCard className=\"w-full max-w-2xl shadow-xl border-2 border-foreground/20\">\n        <CardHeader className=\"border-b border-foreground/10 pb-4\">\n          <CardTitle className=\"text-3xl font-bold text-center flex items-center justify-center gap-2\">\n             <BookOpen className=\"w-7 h-7\"/> Adventure Ended\n             {character && <span className=\"text-xl font-medium text-muted-foreground\"> - {character.name}'s Tale</span>}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6 pt-6\">\n          {/* Summary Section */}\n          <div className=\"space-y-2\">\n            <h3 className=\"text-xl font-semibold flex items-center gap-2\"><FileText className=\"w-5 h-5\"/> Summary of Your Journey</h3>\n            <ScrollArea className=\"h-40 rounded-md border p-3 bg-muted/30 border-foreground/10\">\n                 <p className=\"text-sm whitespace-pre-wrap leading-relaxed\">{adventureSummary || \"No summary was generated for this adventure.\"}</p>\n             </ScrollArea>\n          </div>\n\n          {/* Detailed Story Log Accordion */}\n          <Accordion type=\"single\" collapsible className=\"w-full border-t border-foreground/10 pt-6\">\n            <AccordionItem value=\"detailed-log\" className=\"border-b-0\">\n              <AccordionTrigger className=\"text-xl font-semibold hover:no-underline\">\n                <div className=\"flex items-center gap-2\">\n                    <BookOpen className=\"w-5 h-5\"/> View Full Story Log\n                </div>\n              </AccordionTrigger>\n              <AccordionContent>\n                <ScrollArea className=\"h-64 rounded-md border p-3 bg-muted/30 border-foreground/10\">\n                  {storyLog.length > 0 ? (\n                    storyLog.map((log, index) => (\n                      <div key={log.timestamp ? `log-${log.timestamp}-${index}` : `log-fallback-${index}`} className=\"mb-3 pb-3 border-b border-border/50 last:border-b-0\">\n                        <p className=\"text-sm font-semibold text-muted-foreground\">Turn {index + 1} <span className=\"text-xs\">({new Date(log.timestamp || Date.now()).toLocaleTimeString()})</span></p>\n                        <p className=\"text-sm whitespace-pre-wrap mt-1 leading-relaxed\">{log.narration}</p>\n                         {/* Optional: Show game state changes for debugging */}\n                         {/* <pre className=\"text-xs text-muted-foreground/70 mt-2 italic overflow-auto bg-black/10 p-1 rounded\">State:\\n{log.updatedGameState}</pre> */}\n                      </div>\n                    ))\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground italic\">No detailed story log was recorded for this adventure.</p>\n                  )}\n                </ScrollArea>\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n\n        </CardContent>\n        <CardFooter className=\"flex flex-col sm:flex-row justify-center gap-4 pt-6 border-t border-foreground/10\">\n           {/* Note: Persistent saving (across sessions) is not implemented yet. */}\n           {/* <Button variant=\"secondary\" disabled>Save Story (Coming Soon)</Button> */}\n           <Button onClick={handleMainMenu} className=\"bg-accent hover:bg-accent/90 text-accent-foreground w-full sm:w-auto\">\n              <Home className=\"mr-2 h-4 w-4\" /> Back to Main Menu\n           </Button>\n        </CardFooter>\n      </CardboardCard>\n    </div>\n  );\n}\n"],"names":[],"mappings":"AACA,8CAA8C;;;;;AAI9C;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AATA;;;;;;;;AAWO,SAAS;IACd,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,CAAA,GAAA,8HAAA,CAAA,UAAO,AAAD;IAClC,MAAM,EAAE,gBAAgB,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG;IAElD,MAAM,iBAAiB;QACrB,SAAS;YAAE,MAAM;QAAa,IAAI,yBAAyB;IAC7D;IAEA,yDAAyD;IACzD,wCAAwC;IACxC,+CAA+C;IAE/C,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC,2JAAA,CAAA,gBAAa;YAAC,WAAU;;8BACvB,8OAAC,gIAAA,CAAA,aAAU;oBAAC,WAAU;8BACpB,cAAA,8OAAC,gIAAA,CAAA,YAAS;wBAAC,WAAU;;0CAClB,8OAAC,8MAAA,CAAA,WAAQ;gCAAC,WAAU;;;;;;4BAAW;4BAC9B,2BAAa,8OAAC;gCAAK,WAAU;;oCAA4C;oCAAI,UAAU,IAAI;oCAAC;;;;;;;;;;;;;;;;;;8BAGlG,8OAAC,gIAAA,CAAA,cAAW;oBAAC,WAAU;;sCAErB,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAG,WAAU;;sDAAgD,8OAAC,8MAAA,CAAA,WAAQ;4CAAC,WAAU;;;;;;wCAAW;;;;;;;8CAC7F,8OAAC,0IAAA,CAAA,aAAU;oCAAC,WAAU;8CACjB,cAAA,8OAAC;wCAAE,WAAU;kDAA+C,oBAAoB;;;;;;;;;;;;;;;;;sCAKvF,8OAAC,qIAAA,CAAA,YAAS;4BAAC,MAAK;4BAAS,WAAW;4BAAC,WAAU;sCAC7C,cAAA,8OAAC,qIAAA,CAAA,gBAAa;gCAAC,OAAM;gCAAe,WAAU;;kDAC5C,8OAAC,qIAAA,CAAA,mBAAgB;wCAAC,WAAU;kDAC1B,cAAA,8OAAC;4CAAI,WAAU;;8DACX,8OAAC,8MAAA,CAAA,WAAQ;oDAAC,WAAU;;;;;;gDAAW;;;;;;;;;;;;kDAGrC,8OAAC,qIAAA,CAAA,mBAAgB;kDACf,cAAA,8OAAC,0IAAA,CAAA,aAAU;4CAAC,WAAU;sDACnB,SAAS,MAAM,GAAG,IACjB,SAAS,GAAG,CAAC,CAAC,KAAK,sBACjB,8OAAC;oDAAoF,WAAU;;sEAC7F,8OAAC;4DAAE,WAAU;;gEAA8C;gEAAM,QAAQ;gEAAE;8EAAC,8OAAC;oEAAK,WAAU;;wEAAU;wEAAE,IAAI,KAAK,IAAI,SAAS,IAAI,KAAK,GAAG,IAAI,kBAAkB;wEAAG;;;;;;;;;;;;;sEACnK,8OAAC;4DAAE,WAAU;sEAAoD,IAAI,SAAS;;;;;;;mDAFtE,IAAI,SAAS,GAAG,CAAC,IAAI,EAAE,IAAI,SAAS,CAAC,CAAC,EAAE,OAAO,GAAG,CAAC,aAAa,EAAE,OAAO;;;;0EAQrF,8OAAC;gDAAE,WAAU;0DAAuC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8BAQhE,8OAAC,gIAAA,CAAA,aAAU;oBAAC,WAAU;8BAGnB,cAAA,8OAAC,kIAAA,CAAA,SAAM;wBAAC,SAAS;wBAAgB,WAAU;;0CACxC,8OAAC,mMAAA,CAAA,OAAI;gCAAC,WAAU;;;;;;4BAAiB;;;;;;;;;;;;;;;;;;;;;;;AAM/C","debugId":null}},
    {"offset": {"line": 5513, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Endless-Tales/src/components/screens/SavedAdventuresList.tsx"],"sourcesContent":["\n// src/components/screens/SavedAdventuresList.tsx\n\"use client\";\n\nimport React from \"react\";\nimport { useGame } from \"../../context/GameContext\"; // Import main context hook\nimport type { SavedAdventure, Character, Reputation, NpcRelationships } from \"../../types/game-types\"; // Import types from central location\nimport { Button } from \"../../components/ui/button\";\nimport { ScrollArea } from \"../../components/ui/scroll-area\";\nimport { CardboardCard, CardContent, CardHeader, CardTitle, CardFooter } from \"../../components/game/CardboardCard\";\nimport { Alert, AlertDescription, AlertTitle } from \"../../components/ui/alert\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"../../components/ui/alert-dialog\";\nimport { FolderClock, ArrowLeft, Trash2, Play, Info, BookOpenText, Package, ShieldQuestion, Star, HeartPulse, Zap, ThumbsUp, ThumbsDown, Award, Users } from \"lucide-react\"; // Added Award, Thumbs icons, Users icon\nimport { formatDistanceToNow } from 'date-fns';\nimport { useToast } from \"../../hooks/use-toast\";\n\n// Helper to render reputation summary\nconst renderReputationSummary = (reputation: Reputation | undefined): string => {\n    if (!reputation) return 'None';\n    const entries = Object.entries(reputation);\n    if (entries.length === 0) return 'None';\n    // Show first 2 factions for brevity\n    return entries.slice(0, 2).map(([faction, score]) => `${faction}: ${score}`).join(', ') + (entries.length > 2 ? '...' : '');\n};\n\n// Helper to render NPC relationship summary\nconst renderNpcRelationshipSummary = (relationships: NpcRelationships | undefined): string => {\n    if (!relationships) return 'None';\n    const entries = Object.entries(relationships);\n    if (entries.length === 0) return 'None';\n    // Show first 2 NPCs for brevity\n    return entries.slice(0, 2).map(([npc, score]) => `${npc}: ${score}`).join(', ') + (entries.length > 2 ? '...' : '');\n};\n\n\nexport function SavedAdventuresList() {\n  const { state, dispatch } = useGame();\n  const { savedAdventures } = state;\n  const { toast } = useToast();\n\n  const handleLoad = (adventure: SavedAdventure) => {\n    dispatch({ type: \"LOAD_ADVENTURE\", payload: adventure });\n    toast({ title: \"Loading Adventure...\", description: \"Resuming your journey.\" });\n  };\n\n  const handleDelete = (id: string, characterName: string) => {\n     dispatch({ type: \"DELETE_ADVENTURE\", payload: id });\n     toast({ title: \"Adventure Deleted\", description: `Removed the saved game for ${characterName}.`, variant: \"destructive\" });\n  };\n\n  const handleBack = () => {\n    dispatch({ type: \"SET_GAME_STATUS\", payload: \"MainMenu\" });\n  };\n\n  const sortedAdventures = [...savedAdventures].sort((a, b) => b.saveTimestamp - a.saveTimestamp); // Show newest first\n\n  return (\n    <div className=\"flex flex-col items-center justify-center min-h-screen p-4 bg-background\">\n      <CardboardCard className=\"w-full max-w-2xl shadow-xl border-2 border-foreground/20\">\n        <CardHeader className=\"border-b border-foreground/10 pb-4\">\n          <CardTitle className=\"text-3xl font-bold text-center flex items-center justify-center gap-2\">\n            <FolderClock className=\"w-7 h-7\"/> Saved Adventures\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"pt-6\">\n          {sortedAdventures.length === 0 ? (\n            <Alert>\n              <Info className=\"h-4 w-4\" />\n              <AlertTitle>No Saved Games</AlertTitle>\n              <AlertDescription>\n                You haven't saved any adventures yet. Start a new game and save your progress!\n              </AlertDescription>\n            </Alert>\n          ) : (\n            <ScrollArea className=\"h-[60vh] pr-3\"> {/* Adjust height as needed */}\n              <div className=\"space-y-4\">\n                {sortedAdventures.map((adventure) => {\n                    const char: Character | undefined = adventure.character; // Ensure character exists\n                    const currentStage = char?.skillTreeStage ?? 0;\n                    const stageData = char?.skillTree?.stages[currentStage];\n                    const stageName = stageData?.stageName ?? `Stage ${currentStage}`;\n\n                    return (\n                      <CardboardCard key={adventure.id} className=\"p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 bg-card/60 border border-foreground/10\">\n                        <div className=\"flex-1 min-w-0\">\n                           {/* Character Name and Level */}\n                           <div className=\"flex items-center justify-between\">\n                              <p className=\"text-lg font-semibold truncate\" title={adventure.characterName}>{adventure.characterName}</p>\n                              <span className=\"text-sm font-bold text-primary ml-2 flex-shrink-0\">Lvl {char?.level ?? '?'}</span>\n                           </div>\n\n                          {/* Class, Skill Stage, Resources */}\n                          <div className=\"flex items-center flex-wrap gap-x-3 gap-y-1 text-sm text-muted-foreground mt-1\">\n                                <div className=\"flex items-center gap-1\" title=\"Class\">\n                                    <ShieldQuestion className=\"w-3 h-3\"/> {char?.class || 'Unknown'}\n                                </div>\n                                <div className=\"flex items-center gap-0.5\" title={`Skill Stage: ${stageName}`}>\n                                    <Star className=\"w-3 h-3\"/> {stageName} ({currentStage}/4)\n                                </div>\n                                <div className=\"flex items-center gap-1\" title=\"Stamina\">\n                                    <HeartPulse className=\"w-3 h-3 text-green-600\" /> {char?.currentStamina ?? '?'}/{char?.maxStamina ?? '?'}\n                                </div>\n                                {(char?.maxMana ?? 0) > 0 && (\n                                    <div className=\"flex items-center gap-1\" title=\"Mana\">\n                                        <Zap className=\"w-3 h-3 text-blue-500\" /> {char?.currentMana ?? '?'}/{char?.maxMana ?? '?'}\n                                    </div>\n                                )}\n                          </div>\n\n                          {/* XP, Reputation, and Relationships */}\n                           <div className=\"flex items-center flex-wrap gap-x-3 gap-y-1 text-xs text-muted-foreground mt-1\">\n                                <div className=\"flex items-center gap-1\" title=\"Experience Points\">\n                                    <Award className=\"w-3 h-3 text-yellow-500\" /> {char?.xp ?? '?'}/{char?.xpToNextLevel ?? '?'} XP\n                                </div>\n                                 <div className=\"flex items-center gap-1\" title=\"Reputation\">\n                                    <ThumbsUp className=\"w-3 h-3\" /> Rep: {renderReputationSummary(char?.reputation)}\n                                </div>\n                                <div className=\"flex items-center gap-1\" title=\"NPC Relationships\">\n                                    <Users className=\"w-3 h-3\" /> Rel: {renderNpcRelationshipSummary(char?.npcRelationships)}\n                                </div>\n                            </div>\n\n                           {/* Save Info */}\n                           <p className=\"text-sm text-muted-foreground mt-1\">\n                            Saved {formatDistanceToNow(new Date(adventure.saveTimestamp), { addSuffix: true })}\n                          </p>\n                           <p className=\"text-xs text-muted-foreground mt-1\">\n                            {adventure.statusBeforeSave === 'AdventureSummary' ? 'Finished' : 'In Progress'} | {adventure.adventureSettings.adventureType} ({adventure.adventureSettings.permanentDeath ? 'Permadeath' : 'Respawn'})\n                          </p>\n                            {adventure.inventory && (\n                                <p className=\"text-xs text-muted-foreground mt-1 flex items-center gap-1\">\n                                    <Package className=\"w-3 h-3\"/> {adventure.inventory.length} item(s)\n                                </p>\n                            )}\n                            {adventure.statusBeforeSave === 'AdventureSummary' && adventure.adventureSummary && (\n                                <p className=\"text-xs text-muted-foreground italic mt-1 border-t pt-1 line-clamp-2\">\n                                    Summary: {adventure.adventureSummary}\n                                </p>\n                            )}\n                        </div>\n                        <div className=\"flex gap-2 flex-shrink-0 mt-2 sm:mt-0\">\n                          <Button\n                            variant=\"default\"\n                            size=\"sm\"\n                            onClick={() => handleLoad(adventure)}\n                            className=\"bg-accent hover:bg-accent/90 text-accent-foreground\"\n                          >\n                            {adventure.statusBeforeSave === 'AdventureSummary' ? <BookOpenText className=\"mr-1 h-4 w-4\"/> : <Play className=\"mr-1 h-4 w-4\"/>}\n                            {adventure.statusBeforeSave === 'AdventureSummary' ? 'View' : 'Load'}\n                          </Button>\n                          <AlertDialog>\n                            <AlertDialogTrigger asChild>\n                              <Button variant=\"destructive\" size=\"sm\">\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </AlertDialogTrigger>\n                            <AlertDialogContent>\n                              <AlertDialogHeader>\n                                <AlertDialogTitle>Delete Saved Game?</AlertDialogTitle>\n                                <AlertDialogDescription>\n                                  Are you sure you want to delete the saved adventure for \"{adventure.characterName}\"? This action cannot be undone.\n                                </AlertDialogDescription>\n                              </AlertDialogHeader>\n                              <AlertDialogFooter>\n                                <AlertDialogCancel>Cancel</AlertDialogCancel>\n                                <AlertDialogAction onClick={() => handleDelete(adventure.id, adventure.characterName)} className=\"bg-destructive hover:bg-destructive/90\">\n                                    Delete\n                                </AlertDialogAction>\n                              </AlertDialogFooter>\n                            </AlertDialogContent>\n                          </AlertDialog>\n                        </div>\n                      </CardboardCard>\n                    );\n                })}\n              </div>\n            </ScrollArea>\n          )}\n        </CardContent>\n        <CardFooter className=\"flex justify-start pt-6 border-t border-foreground/10\">\n          <Button variant=\"outline\" onClick={handleBack}>\n            <ArrowLeft className=\"mr-2 h-4 w-4\" /> Back to Main Menu\n          </Button>\n        </CardFooter>\n      </CardboardCard>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}